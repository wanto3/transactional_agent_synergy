"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@x402";
exports.ids = ["vendor-chunks/@x402"];
exports.modules = {

/***/ "(rsc)/./node_modules/@x402/core/dist/esm/chunk-55XTTMLF.mjs":
/*!*************************************************************!*\
  !*** ./node_modules/@x402/core/dist/esm/chunk-55XTTMLF.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   HTTPFacilitatorClient: () => (/* binding */ HTTPFacilitatorClient),\n/* harmony export */   RouteConfigurationError: () => (/* binding */ RouteConfigurationError),\n/* harmony export */   decodePaymentRequiredHeader: () => (/* binding */ decodePaymentRequiredHeader),\n/* harmony export */   decodePaymentResponseHeader: () => (/* binding */ decodePaymentResponseHeader),\n/* harmony export */   decodePaymentSignatureHeader: () => (/* binding */ decodePaymentSignatureHeader),\n/* harmony export */   encodePaymentRequiredHeader: () => (/* binding */ encodePaymentRequiredHeader),\n/* harmony export */   encodePaymentResponseHeader: () => (/* binding */ encodePaymentResponseHeader),\n/* harmony export */   encodePaymentSignatureHeader: () => (/* binding */ encodePaymentSignatureHeader),\n/* harmony export */   x402HTTPClient: () => (/* binding */ x402HTTPClient),\n/* harmony export */   x402HTTPResourceServer: () => (/* binding */ x402HTTPResourceServer)\n/* harmony export */ });\n/* harmony import */ var _chunk_VE37GDG2_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chunk-VE37GDG2.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-VE37GDG2.mjs\");\n/* harmony import */ var _chunk_X4W4S5RB_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./chunk-X4W4S5RB.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-X4W4S5RB.mjs\");\n/* harmony import */ var _chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./chunk-TDLQZ6MP.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-TDLQZ6MP.mjs\");\n/* harmony import */ var _chunk_BJTO5JO5_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./chunk-BJTO5JO5.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-BJTO5JO5.mjs\");\n\n\n\n\n\n// src/http/x402HTTPResourceServer.ts\nvar RouteConfigurationError = class extends Error {\n  /**\n   * Creates a new RouteConfigurationError with the given validation errors.\n   *\n   * @param errors - The validation errors that caused this exception.\n   */\n  constructor(errors) {\n    const message = `x402 Route Configuration Errors:\n${errors.map((e) => `  - ${e.message}`).join(\"\\n\")}`;\n    super(message);\n    this.name = \"RouteConfigurationError\";\n    this.errors = errors;\n  }\n};\nvar x402HTTPResourceServer = class {\n  /**\n   * Creates a new x402HTTPResourceServer instance.\n   *\n   * @param ResourceServer - The core x402ResourceServer instance to use\n   * @param routes - Route configuration for payment-protected endpoints\n   */\n  constructor(ResourceServer, routes) {\n    this.compiledRoutes = [];\n    this.ResourceServer = ResourceServer;\n    this.routesConfig = routes;\n    const normalizedRoutes = typeof routes === \"object\" && !(\"accepts\" in routes) ? routes : { \"*\": routes };\n    for (const [pattern, config] of Object.entries(normalizedRoutes)) {\n      const parsed = this.parseRoutePattern(pattern);\n      this.compiledRoutes.push({\n        verb: parsed.verb,\n        regex: parsed.regex,\n        config\n      });\n    }\n  }\n  /**\n   * Initialize the HTTP resource server.\n   *\n   * This method initializes the underlying resource server (fetching facilitator support)\n   * and then validates that all route payment configurations have corresponding\n   * registered schemes and facilitator support.\n   *\n   * @throws RouteConfigurationError if any route's payment options don't have\n   *         corresponding registered schemes or facilitator support\n   *\n   * @example\n   * ```typescript\n   * const httpServer = new x402HTTPResourceServer(server, routes);\n   * await httpServer.initialize();\n   * ```\n   */\n  async initialize() {\n    await this.ResourceServer.initialize();\n    const errors = this.validateRouteConfiguration();\n    if (errors.length > 0) {\n      throw new RouteConfigurationError(errors);\n    }\n  }\n  /**\n   * Register a custom paywall provider for generating HTML\n   *\n   * @param provider - PaywallProvider instance\n   * @returns This service instance for chaining\n   */\n  registerPaywallProvider(provider) {\n    this.paywallProvider = provider;\n    return this;\n  }\n  /**\n   * Process HTTP request and return response instructions\n   * This is the main entry point for framework middleware\n   *\n   * @param context - HTTP request context\n   * @param paywallConfig - Optional paywall configuration\n   * @returns Process result indicating next action for middleware\n   */\n  async processHTTPRequest(context, paywallConfig) {\n    const { adapter, path, method } = context;\n    const routeConfig = this.getRouteConfig(path, method);\n    if (!routeConfig) {\n      return { type: \"no-payment-required\" };\n    }\n    const paymentOptions = this.normalizePaymentOptions(routeConfig);\n    const paymentPayload = this.extractPayment(adapter);\n    const resourceInfo = {\n      url: routeConfig.resource || context.adapter.getUrl(),\n      description: routeConfig.description || \"\",\n      mimeType: routeConfig.mimeType || \"\"\n    };\n    const requirements = await this.ResourceServer.buildPaymentRequirementsFromOptions(\n      paymentOptions,\n      context\n    );\n    let extensions = routeConfig.extensions;\n    if (extensions) {\n      extensions = this.ResourceServer.enrichExtensions(extensions, context);\n    }\n    const paymentRequired = this.ResourceServer.createPaymentRequiredResponse(\n      requirements,\n      resourceInfo,\n      !paymentPayload ? \"Payment required\" : void 0,\n      extensions\n    );\n    if (!paymentPayload) {\n      const unpaidBody = routeConfig.unpaidResponseBody ? await routeConfig.unpaidResponseBody(context) : void 0;\n      return {\n        type: \"payment-error\",\n        response: this.createHTTPResponse(\n          paymentRequired,\n          this.isWebBrowser(adapter),\n          paywallConfig,\n          routeConfig.customPaywallHtml,\n          unpaidBody\n        )\n      };\n    }\n    try {\n      const matchingRequirements = this.ResourceServer.findMatchingRequirements(\n        paymentRequired.accepts,\n        paymentPayload\n      );\n      if (!matchingRequirements) {\n        const errorResponse = this.ResourceServer.createPaymentRequiredResponse(\n          requirements,\n          resourceInfo,\n          \"No matching payment requirements\",\n          routeConfig.extensions\n        );\n        return {\n          type: \"payment-error\",\n          response: this.createHTTPResponse(errorResponse, false, paywallConfig)\n        };\n      }\n      const verifyResult = await this.ResourceServer.verifyPayment(\n        paymentPayload,\n        matchingRequirements\n      );\n      if (!verifyResult.isValid) {\n        const errorResponse = this.ResourceServer.createPaymentRequiredResponse(\n          requirements,\n          resourceInfo,\n          verifyResult.invalidReason,\n          routeConfig.extensions\n        );\n        return {\n          type: \"payment-error\",\n          response: this.createHTTPResponse(errorResponse, false, paywallConfig)\n        };\n      }\n      return {\n        type: \"payment-verified\",\n        paymentPayload,\n        paymentRequirements: matchingRequirements\n      };\n    } catch (error) {\n      const errorResponse = this.ResourceServer.createPaymentRequiredResponse(\n        requirements,\n        resourceInfo,\n        error instanceof Error ? error.message : \"Payment verification failed\",\n        routeConfig.extensions\n      );\n      return {\n        type: \"payment-error\",\n        response: this.createHTTPResponse(errorResponse, false, paywallConfig)\n      };\n    }\n  }\n  /**\n   * Process settlement after successful response\n   *\n   * @param paymentPayload - The verified payment payload\n   * @param requirements - The matching payment requirements\n   * @returns ProcessSettleResultResponse - SettleResponse with headers if success or errorReason if failure\n   */\n  async processSettlement(paymentPayload, requirements) {\n    try {\n      const settleResponse = await this.ResourceServer.settlePayment(paymentPayload, requirements);\n      if (!settleResponse.success) {\n        return {\n          ...settleResponse,\n          success: false,\n          errorReason: settleResponse.errorReason || \"Settlement failed\"\n        };\n      }\n      return {\n        ...settleResponse,\n        success: true,\n        headers: this.createSettlementHeaders(settleResponse),\n        requirements\n      };\n    } catch (error) {\n      if (error instanceof _chunk_X4W4S5RB_mjs__WEBPACK_IMPORTED_MODULE_1__.SettleError) {\n        return {\n          success: false,\n          errorReason: error.errorReason || error.message,\n          payer: error.payer,\n          network: error.network,\n          transaction: error.transaction\n        };\n      }\n      return {\n        success: false,\n        errorReason: error instanceof Error ? error.message : \"Settlement failed\",\n        network: requirements.network,\n        transaction: \"\"\n      };\n    }\n  }\n  /**\n   * Check if a request requires payment based on route configuration\n   *\n   * @param context - HTTP request context\n   * @returns True if the route requires payment, false otherwise\n   */\n  requiresPayment(context) {\n    const routeConfig = this.getRouteConfig(context.path, context.method);\n    return routeConfig !== void 0;\n  }\n  /**\n   * Normalizes a RouteConfig's accepts field into an array of PaymentOptions\n   * Handles both single PaymentOption and array formats\n   *\n   * @param routeConfig - Route configuration\n   * @returns Array of payment options\n   */\n  normalizePaymentOptions(routeConfig) {\n    return Array.isArray(routeConfig.accepts) ? routeConfig.accepts : [routeConfig.accepts];\n  }\n  /**\n   * Validates that all payment options in routes have corresponding registered schemes\n   * and facilitator support.\n   *\n   * @returns Array of validation errors (empty if all routes are valid)\n   */\n  validateRouteConfiguration() {\n    const errors = [];\n    const normalizedRoutes = typeof this.routesConfig === \"object\" && !(\"accepts\" in this.routesConfig) ? Object.entries(this.routesConfig) : [[\"*\", this.routesConfig]];\n    for (const [pattern, config] of normalizedRoutes) {\n      const paymentOptions = this.normalizePaymentOptions(config);\n      for (const option of paymentOptions) {\n        if (!this.ResourceServer.hasRegisteredScheme(option.network, option.scheme)) {\n          errors.push({\n            routePattern: pattern,\n            scheme: option.scheme,\n            network: option.network,\n            reason: \"missing_scheme\",\n            message: `Route \"${pattern}\": No scheme implementation registered for \"${option.scheme}\" on network \"${option.network}\"`\n          });\n          continue;\n        }\n        const supportedKind = this.ResourceServer.getSupportedKind(\n          _chunk_VE37GDG2_mjs__WEBPACK_IMPORTED_MODULE_0__.x402Version,\n          option.network,\n          option.scheme\n        );\n        if (!supportedKind) {\n          errors.push({\n            routePattern: pattern,\n            scheme: option.scheme,\n            network: option.network,\n            reason: \"missing_facilitator\",\n            message: `Route \"${pattern}\": Facilitator does not support scheme \"${option.scheme}\" on network \"${option.network}\"`\n          });\n        }\n      }\n    }\n    return errors;\n  }\n  /**\n   * Get route configuration for a request\n   *\n   * @param path - Request path\n   * @param method - HTTP method\n   * @returns Route configuration or undefined if no match\n   */\n  getRouteConfig(path, method) {\n    const normalizedPath = this.normalizePath(path);\n    const upperMethod = method.toUpperCase();\n    const matchingRoute = this.compiledRoutes.find(\n      (route) => route.regex.test(normalizedPath) && (route.verb === \"*\" || route.verb === upperMethod)\n    );\n    return matchingRoute?.config;\n  }\n  /**\n   * Extract payment from HTTP headers (handles v1 and v2)\n   *\n   * @param adapter - HTTP adapter\n   * @returns Decoded payment payload or null\n   */\n  extractPayment(adapter) {\n    const header = adapter.getHeader(\"payment-signature\") || adapter.getHeader(\"PAYMENT-SIGNATURE\");\n    if (header) {\n      try {\n        return decodePaymentSignatureHeader(header);\n      } catch (error) {\n        console.warn(\"Failed to decode PAYMENT-SIGNATURE header:\", error);\n      }\n    }\n    return null;\n  }\n  /**\n   * Check if request is from a web browser\n   *\n   * @param adapter - HTTP adapter\n   * @returns True if request appears to be from a browser\n   */\n  isWebBrowser(adapter) {\n    const accept = adapter.getAcceptHeader();\n    const userAgent = adapter.getUserAgent();\n    return accept.includes(\"text/html\") && userAgent.includes(\"Mozilla\");\n  }\n  /**\n   * Create HTTP response instructions from payment required\n   *\n   * @param paymentRequired - Payment requirements\n   * @param isWebBrowser - Whether request is from browser\n   * @param paywallConfig - Paywall configuration\n   * @param customHtml - Custom HTML template\n   * @param unpaidResponse - Optional custom response (content type and body) for unpaid API requests\n   * @returns Response instructions\n   */\n  createHTTPResponse(paymentRequired, isWebBrowser, paywallConfig, customHtml, unpaidResponse) {\n    if (isWebBrowser) {\n      const html = this.generatePaywallHTML(paymentRequired, paywallConfig, customHtml);\n      return {\n        status: 402,\n        headers: { \"Content-Type\": \"text/html\" },\n        body: html,\n        isHtml: true\n      };\n    }\n    const response = this.createHTTPPaymentRequiredResponse(paymentRequired);\n    const contentType = unpaidResponse ? unpaidResponse.contentType : \"application/json\";\n    const body = unpaidResponse ? unpaidResponse.body : {};\n    return {\n      status: 402,\n      headers: {\n        \"Content-Type\": contentType,\n        ...response.headers\n      },\n      body\n    };\n  }\n  /**\n   * Create HTTP payment required response (v1 puts in body, v2 puts in header)\n   *\n   * @param paymentRequired - Payment required object\n   * @returns Headers and body for the HTTP response\n   */\n  createHTTPPaymentRequiredResponse(paymentRequired) {\n    return {\n      headers: {\n        \"PAYMENT-REQUIRED\": encodePaymentRequiredHeader(paymentRequired)\n      }\n    };\n  }\n  /**\n   * Create settlement response headers\n   *\n   * @param settleResponse - Settlement response\n   * @returns Headers to add to response\n   */\n  createSettlementHeaders(settleResponse) {\n    const encoded = encodePaymentResponseHeader(settleResponse);\n    return { \"PAYMENT-RESPONSE\": encoded };\n  }\n  /**\n   * Parse route pattern into verb and regex\n   *\n   * @param pattern - Route pattern like \"GET /api/*\" or \"/api/[id]\"\n   * @returns Parsed pattern with verb and regex\n   */\n  parseRoutePattern(pattern) {\n    const [verb, path] = pattern.includes(\" \") ? pattern.split(/\\s+/) : [\"*\", pattern];\n    const regex = new RegExp(\n      `^${path.replace(/[$()+.?^{|}]/g, \"\\\\$&\").replace(/\\*/g, \".*?\").replace(/\\[([^\\]]+)\\]/g, \"[^/]+\").replace(/\\//g, \"\\\\/\")}$`,\n      \"i\"\n    );\n    return { verb: verb.toUpperCase(), regex };\n  }\n  /**\n   * Normalize path for matching\n   *\n   * @param path - Raw path from request\n   * @returns Normalized path\n   */\n  normalizePath(path) {\n    try {\n      const pathWithoutQuery = path.split(/[?#]/)[0];\n      const decodedPath = decodeURIComponent(pathWithoutQuery);\n      return decodedPath.replace(/\\\\/g, \"/\").replace(/\\/+/g, \"/\").replace(/(.+?)\\/+$/, \"$1\");\n    } catch {\n      return path;\n    }\n  }\n  /**\n   * Generate paywall HTML for browser requests\n   *\n   * @param paymentRequired - Payment required response\n   * @param paywallConfig - Optional paywall configuration\n   * @param customHtml - Optional custom HTML template\n   * @returns HTML string\n   */\n  generatePaywallHTML(paymentRequired, paywallConfig, customHtml) {\n    if (customHtml) {\n      return customHtml;\n    }\n    if (this.paywallProvider) {\n      return this.paywallProvider.generateHtml(paymentRequired, paywallConfig);\n    }\n    try {\n      const paywall = (0,_chunk_BJTO5JO5_mjs__WEBPACK_IMPORTED_MODULE_3__.__require)(\"@x402/paywall\");\n      const displayAmount2 = this.getDisplayAmount(paymentRequired);\n      const resource2 = paymentRequired.resource;\n      return paywall.getPaywallHtml({\n        amount: displayAmount2,\n        paymentRequired,\n        currentUrl: resource2?.url || paywallConfig?.currentUrl || \"\",\n        testnet: paywallConfig?.testnet ?? true,\n        appName: paywallConfig?.appName,\n        appLogo: paywallConfig?.appLogo,\n        sessionTokenEndpoint: paywallConfig?.sessionTokenEndpoint\n      });\n    } catch {\n    }\n    const resource = paymentRequired.resource;\n    const displayAmount = this.getDisplayAmount(paymentRequired);\n    return `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>Payment Required</title>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n        </head>\n        <body>\n          <div style=\"max-width: 600px; margin: 50px auto; padding: 20px; font-family: system-ui, -apple-system, sans-serif;\">\n            ${paywallConfig?.appLogo ? `<img src=\"${paywallConfig.appLogo}\" alt=\"${paywallConfig.appName || \"App\"}\" style=\"max-width: 200px; margin-bottom: 20px;\">` : \"\"}\n            <h1>Payment Required</h1>\n            ${resource ? `<p><strong>Resource:</strong> ${resource.description || resource.url}</p>` : \"\"}\n            <p><strong>Amount:</strong> $${displayAmount.toFixed(2)} USDC</p>\n            <div id=\"payment-widget\" \n                 data-requirements='${JSON.stringify(paymentRequired)}'\n                 data-app-name=\"${paywallConfig?.appName || \"\"}\"\n                 data-testnet=\"${paywallConfig?.testnet || false}\">\n              <!-- Install @x402/paywall for full wallet integration -->\n              <p style=\"margin-top: 2rem; padding: 1rem; background: #fef3c7; border-radius: 0.5rem;\">\n                <strong>Note:</strong> Install <code>@x402/paywall</code> for full wallet connection and payment UI.\n              </p>\n            </div>\n          </div>\n        </body>\n      </html>\n    `;\n  }\n  /**\n   * Extract display amount from payment requirements.\n   *\n   * @param paymentRequired - The payment required object\n   * @returns The display amount in decimal format\n   */\n  getDisplayAmount(paymentRequired) {\n    const accepts = paymentRequired.accepts;\n    if (accepts && accepts.length > 0) {\n      const firstReq = accepts[0];\n      if (\"amount\" in firstReq) {\n        return parseFloat(firstReq.amount) / 1e6;\n      }\n    }\n    return 0;\n  }\n};\n\n// src/http/httpFacilitatorClient.ts\nvar DEFAULT_FACILITATOR_URL = \"https://x402.org/facilitator\";\nvar HTTPFacilitatorClient = class {\n  /**\n   * Creates a new HTTPFacilitatorClient instance.\n   *\n   * @param config - Configuration options for the facilitator client\n   */\n  constructor(config) {\n    this.url = config?.url || DEFAULT_FACILITATOR_URL;\n    this._createAuthHeaders = config?.createAuthHeaders;\n  }\n  /**\n   * Verify a payment with the facilitator\n   *\n   * @param paymentPayload - The payment to verify\n   * @param paymentRequirements - The requirements to verify against\n   * @returns Verification response\n   */\n  async verify(paymentPayload, paymentRequirements) {\n    let headers = {\n      \"Content-Type\": \"application/json\"\n    };\n    if (this._createAuthHeaders) {\n      const authHeaders = await this.createAuthHeaders(\"verify\");\n      headers = { ...headers, ...authHeaders.headers };\n    }\n    const response = await fetch(`${this.url}/verify`, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({\n        x402Version: paymentPayload.x402Version,\n        paymentPayload: this.toJsonSafe(paymentPayload),\n        paymentRequirements: this.toJsonSafe(paymentRequirements)\n      })\n    });\n    const data = await response.json();\n    if (typeof data === \"object\" && data !== null && \"isValid\" in data) {\n      const verifyResponse = data;\n      if (!response.ok) {\n        throw new _chunk_X4W4S5RB_mjs__WEBPACK_IMPORTED_MODULE_1__.VerifyError(response.status, verifyResponse);\n      }\n      return verifyResponse;\n    }\n    throw new Error(`Facilitator verify failed (${response.status}): ${JSON.stringify(data)}`);\n  }\n  /**\n   * Settle a payment with the facilitator\n   *\n   * @param paymentPayload - The payment to settle\n   * @param paymentRequirements - The requirements for settlement\n   * @returns Settlement response\n   */\n  async settle(paymentPayload, paymentRequirements) {\n    let headers = {\n      \"Content-Type\": \"application/json\"\n    };\n    if (this._createAuthHeaders) {\n      const authHeaders = await this.createAuthHeaders(\"settle\");\n      headers = { ...headers, ...authHeaders.headers };\n    }\n    const response = await fetch(`${this.url}/settle`, {\n      method: \"POST\",\n      headers,\n      body: JSON.stringify({\n        x402Version: paymentPayload.x402Version,\n        paymentPayload: this.toJsonSafe(paymentPayload),\n        paymentRequirements: this.toJsonSafe(paymentRequirements)\n      })\n    });\n    const data = await response.json();\n    if (typeof data === \"object\" && data !== null && \"success\" in data) {\n      const settleResponse = data;\n      if (!response.ok) {\n        throw new _chunk_X4W4S5RB_mjs__WEBPACK_IMPORTED_MODULE_1__.SettleError(response.status, settleResponse);\n      }\n      return settleResponse;\n    }\n    throw new Error(`Facilitator settle failed (${response.status}): ${JSON.stringify(data)}`);\n  }\n  /**\n   * Get supported payment kinds and extensions from the facilitator\n   *\n   * @returns Supported payment kinds and extensions\n   */\n  async getSupported() {\n    let headers = {\n      \"Content-Type\": \"application/json\"\n    };\n    if (this._createAuthHeaders) {\n      const authHeaders = await this.createAuthHeaders(\"supported\");\n      headers = { ...headers, ...authHeaders.headers };\n    }\n    const response = await fetch(`${this.url}/supported`, {\n      method: \"GET\",\n      headers\n    });\n    if (!response.ok) {\n      const errorText = await response.text().catch(() => response.statusText);\n      throw new Error(`Facilitator getSupported failed (${response.status}): ${errorText}`);\n    }\n    return await response.json();\n  }\n  /**\n   * Creates authentication headers for a specific path.\n   *\n   * @param path - The path to create authentication headers for (e.g., \"verify\", \"settle\", \"supported\")\n   * @returns An object containing the authentication headers for the specified path\n   */\n  async createAuthHeaders(path) {\n    if (this._createAuthHeaders) {\n      const authHeaders = await this._createAuthHeaders();\n      return {\n        headers: authHeaders[path] ?? {}\n      };\n    }\n    return {\n      headers: {}\n    };\n  }\n  /**\n   * Helper to convert objects to JSON-safe format.\n   * Handles BigInt and other non-JSON types.\n   *\n   * @param obj - The object to convert\n   * @returns The JSON-safe representation of the object\n   */\n  toJsonSafe(obj) {\n    return JSON.parse(\n      JSON.stringify(obj, (_, value) => typeof value === \"bigint\" ? value.toString() : value)\n    );\n  }\n};\n\n// src/http/x402HTTPClient.ts\nvar x402HTTPClient = class {\n  /**\n   * Creates a new x402HTTPClient instance.\n   *\n   * @param client - The underlying x402Client for payment logic\n   */\n  constructor(client) {\n    this.client = client;\n  }\n  /**\n   * Encodes a payment payload into appropriate HTTP headers based on version.\n   *\n   * @param paymentPayload - The payment payload to encode\n   * @returns HTTP headers containing the encoded payment signature\n   */\n  encodePaymentSignatureHeader(paymentPayload) {\n    switch (paymentPayload.x402Version) {\n      case 2:\n        return {\n          \"PAYMENT-SIGNATURE\": encodePaymentSignatureHeader(paymentPayload)\n        };\n      case 1:\n        return {\n          \"X-PAYMENT\": encodePaymentSignatureHeader(paymentPayload)\n        };\n      default:\n        throw new Error(\n          `Unsupported x402 version: ${paymentPayload.x402Version}`\n        );\n    }\n  }\n  /**\n   * Extracts payment required information from HTTP response.\n   *\n   * @param getHeader - Function to retrieve header value by name (case-insensitive)\n   * @param body - Optional response body for v1 compatibility\n   * @returns The payment required object\n   */\n  getPaymentRequiredResponse(getHeader, body) {\n    const paymentRequired = getHeader(\"PAYMENT-REQUIRED\");\n    if (paymentRequired) {\n      return decodePaymentRequiredHeader(paymentRequired);\n    }\n    if (body && body instanceof Object && \"x402Version\" in body && body.x402Version === 1) {\n      return body;\n    }\n    throw new Error(\"Invalid payment required response\");\n  }\n  /**\n   * Extracts payment settlement response from HTTP headers.\n   *\n   * @param getHeader - Function to retrieve header value by name (case-insensitive)\n   * @returns The settlement response object\n   */\n  getPaymentSettleResponse(getHeader) {\n    const paymentResponse = getHeader(\"PAYMENT-RESPONSE\");\n    if (paymentResponse) {\n      return decodePaymentResponseHeader(paymentResponse);\n    }\n    const xPaymentResponse = getHeader(\"X-PAYMENT-RESPONSE\");\n    if (xPaymentResponse) {\n      return decodePaymentResponseHeader(xPaymentResponse);\n    }\n    throw new Error(\"Payment response header not found\");\n  }\n  /**\n   * Creates a payment payload for the given payment requirements.\n   * Delegates to the underlying x402Client.\n   *\n   * @param paymentRequired - The payment required response from the server\n   * @returns Promise resolving to the payment payload\n   */\n  async createPaymentPayload(paymentRequired) {\n    return this.client.createPaymentPayload(paymentRequired);\n  }\n};\n\n// src/http/index.ts\nfunction encodePaymentSignatureHeader(paymentPayload) {\n  return (0,_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.safeBase64Encode)(JSON.stringify(paymentPayload));\n}\nfunction decodePaymentSignatureHeader(paymentSignatureHeader) {\n  if (!_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.Base64EncodedRegex.test(paymentSignatureHeader)) {\n    throw new Error(\"Invalid payment signature header\");\n  }\n  return JSON.parse((0,_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.safeBase64Decode)(paymentSignatureHeader));\n}\nfunction encodePaymentRequiredHeader(paymentRequired) {\n  return (0,_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.safeBase64Encode)(JSON.stringify(paymentRequired));\n}\nfunction decodePaymentRequiredHeader(paymentRequiredHeader) {\n  if (!_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.Base64EncodedRegex.test(paymentRequiredHeader)) {\n    throw new Error(\"Invalid payment required header\");\n  }\n  return JSON.parse((0,_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.safeBase64Decode)(paymentRequiredHeader));\n}\nfunction encodePaymentResponseHeader(paymentResponse) {\n  return (0,_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.safeBase64Encode)(JSON.stringify(paymentResponse));\n}\nfunction decodePaymentResponseHeader(paymentResponseHeader) {\n  if (!_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.Base64EncodedRegex.test(paymentResponseHeader)) {\n    throw new Error(\"Invalid payment response header\");\n  }\n  return JSON.parse((0,_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_2__.safeBase64Decode)(paymentResponseHeader));\n}\n\n\n//# sourceMappingURL=chunk-55XTTMLF.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jaHVuay01NVhUVE1MRi5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFOEI7QUFJQTtBQUtBO0FBR0E7O0FBRTlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUUseUJBQXlCLFVBQVUsY0FBYztBQUNuRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtGQUErRjtBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksd0JBQXdCO0FBQ3BDO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTiwyQkFBMkIsNERBQVc7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFFBQVEsOENBQThDLGNBQWMsZ0JBQWdCLGVBQWU7QUFDbEksV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBLFVBQVUsNERBQVc7QUFDckI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCLFFBQVEsMENBQTBDLGNBQWMsZ0JBQWdCLGVBQWU7QUFDOUgsV0FBVztBQUNYO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLDZCQUE2QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSx1QkFBdUIsRUFBRSwyRkFBMkY7QUFDOUg7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0IsOERBQVM7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxtQkFBbUIsZUFBZSxrREFBa0Q7QUFDNUgsY0FBYyxzQ0FBc0Msc0JBQXNCLFNBQVMsK0JBQStCLDJCQUEyQixvQkFBb0I7QUFDaks7QUFDQSxjQUFjLDRDQUE0QyxxQ0FBcUM7QUFDL0YsMkNBQTJDLDBCQUEwQjtBQUNyRTtBQUNBLHNDQUFzQyxnQ0FBZ0M7QUFDdEUsa0NBQWtDLDZCQUE2QjtBQUMvRCxpQ0FBaUMsZ0NBQWdDO0FBQ2pFO0FBQ0EsMENBQTBDLGVBQWUscUJBQXFCLHNCQUFzQjtBQUNwRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBLG9DQUFvQyxTQUFTO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IsNERBQVc7QUFDN0I7QUFDQTtBQUNBO0FBQ0Esa0RBQWtELGdCQUFnQixLQUFLLHFCQUFxQjtBQUM1RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCO0FBQ2xCO0FBQ0Esb0NBQW9DLFNBQVM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQiw0REFBVztBQUM3QjtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsZ0JBQWdCLEtBQUsscUJBQXFCO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBLG9DQUFvQyxTQUFTO0FBQzdDO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDBEQUEwRCxnQkFBZ0IsS0FBSyxVQUFVO0FBQ3pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1QywyQkFBMkI7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTLHFFQUFnQjtBQUN6QjtBQUNBO0FBQ0EsT0FBTyxtRUFBa0I7QUFDekI7QUFDQTtBQUNBLG9CQUFvQixxRUFBZ0I7QUFDcEM7QUFDQTtBQUNBLFNBQVMscUVBQWdCO0FBQ3pCO0FBQ0E7QUFDQSxPQUFPLG1FQUFrQjtBQUN6QjtBQUNBO0FBQ0Esb0JBQW9CLHFFQUFnQjtBQUNwQztBQUNBO0FBQ0EsU0FBUyxxRUFBZ0I7QUFDekI7QUFDQTtBQUNBLE9BQU8sbUVBQWtCO0FBQ3pCO0FBQ0E7QUFDQSxvQkFBb0IscUVBQWdCO0FBQ3BDOztBQWFFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmFuc2FjdGlvbmFsX2FnZW50Ly4vbm9kZV9tb2R1bGVzL0B4NDAyL2NvcmUvZGlzdC9lc20vY2h1bmstNTVYVFRNTEYubWpzPzEzODIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgeDQwMlZlcnNpb25cbn0gZnJvbSBcIi4vY2h1bmstVkUzN0dERzIubWpzXCI7XG5pbXBvcnQge1xuICBTZXR0bGVFcnJvcixcbiAgVmVyaWZ5RXJyb3Jcbn0gZnJvbSBcIi4vY2h1bmstWDRXNFM1UkIubWpzXCI7XG5pbXBvcnQge1xuICBCYXNlNjRFbmNvZGVkUmVnZXgsXG4gIHNhZmVCYXNlNjREZWNvZGUsXG4gIHNhZmVCYXNlNjRFbmNvZGVcbn0gZnJvbSBcIi4vY2h1bmstVERMUVo2TVAubWpzXCI7XG5pbXBvcnQge1xuICBfX3JlcXVpcmVcbn0gZnJvbSBcIi4vY2h1bmstQkpUTzVKTzUubWpzXCI7XG5cbi8vIHNyYy9odHRwL3g0MDJIVFRQUmVzb3VyY2VTZXJ2ZXIudHNcbnZhciBSb3V0ZUNvbmZpZ3VyYXRpb25FcnJvciA9IGNsYXNzIGV4dGVuZHMgRXJyb3Ige1xuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBSb3V0ZUNvbmZpZ3VyYXRpb25FcnJvciB3aXRoIHRoZSBnaXZlbiB2YWxpZGF0aW9uIGVycm9ycy5cbiAgICpcbiAgICogQHBhcmFtIGVycm9ycyAtIFRoZSB2YWxpZGF0aW9uIGVycm9ycyB0aGF0IGNhdXNlZCB0aGlzIGV4Y2VwdGlvbi5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGVycm9ycykge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSBgeDQwMiBSb3V0ZSBDb25maWd1cmF0aW9uIEVycm9yczpcbiR7ZXJyb3JzLm1hcCgoZSkgPT4gYCAgLSAke2UubWVzc2FnZX1gKS5qb2luKFwiXFxuXCIpfWA7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gICAgdGhpcy5uYW1lID0gXCJSb3V0ZUNvbmZpZ3VyYXRpb25FcnJvclwiO1xuICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzO1xuICB9XG59O1xudmFyIHg0MDJIVFRQUmVzb3VyY2VTZXJ2ZXIgPSBjbGFzcyB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHg0MDJIVFRQUmVzb3VyY2VTZXJ2ZXIgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwYXJhbSBSZXNvdXJjZVNlcnZlciAtIFRoZSBjb3JlIHg0MDJSZXNvdXJjZVNlcnZlciBpbnN0YW5jZSB0byB1c2VcbiAgICogQHBhcmFtIHJvdXRlcyAtIFJvdXRlIGNvbmZpZ3VyYXRpb24gZm9yIHBheW1lbnQtcHJvdGVjdGVkIGVuZHBvaW50c1xuICAgKi9cbiAgY29uc3RydWN0b3IoUmVzb3VyY2VTZXJ2ZXIsIHJvdXRlcykge1xuICAgIHRoaXMuY29tcGlsZWRSb3V0ZXMgPSBbXTtcbiAgICB0aGlzLlJlc291cmNlU2VydmVyID0gUmVzb3VyY2VTZXJ2ZXI7XG4gICAgdGhpcy5yb3V0ZXNDb25maWcgPSByb3V0ZXM7XG4gICAgY29uc3Qgbm9ybWFsaXplZFJvdXRlcyA9IHR5cGVvZiByb3V0ZXMgPT09IFwib2JqZWN0XCIgJiYgIShcImFjY2VwdHNcIiBpbiByb3V0ZXMpID8gcm91dGVzIDogeyBcIipcIjogcm91dGVzIH07XG4gICAgZm9yIChjb25zdCBbcGF0dGVybiwgY29uZmlnXSBvZiBPYmplY3QuZW50cmllcyhub3JtYWxpemVkUm91dGVzKSkge1xuICAgICAgY29uc3QgcGFyc2VkID0gdGhpcy5wYXJzZVJvdXRlUGF0dGVybihwYXR0ZXJuKTtcbiAgICAgIHRoaXMuY29tcGlsZWRSb3V0ZXMucHVzaCh7XG4gICAgICAgIHZlcmI6IHBhcnNlZC52ZXJiLFxuICAgICAgICByZWdleDogcGFyc2VkLnJlZ2V4LFxuICAgICAgICBjb25maWdcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgSFRUUCByZXNvdXJjZSBzZXJ2ZXIuXG4gICAqXG4gICAqIFRoaXMgbWV0aG9kIGluaXRpYWxpemVzIHRoZSB1bmRlcmx5aW5nIHJlc291cmNlIHNlcnZlciAoZmV0Y2hpbmcgZmFjaWxpdGF0b3Igc3VwcG9ydClcbiAgICogYW5kIHRoZW4gdmFsaWRhdGVzIHRoYXQgYWxsIHJvdXRlIHBheW1lbnQgY29uZmlndXJhdGlvbnMgaGF2ZSBjb3JyZXNwb25kaW5nXG4gICAqIHJlZ2lzdGVyZWQgc2NoZW1lcyBhbmQgZmFjaWxpdGF0b3Igc3VwcG9ydC5cbiAgICpcbiAgICogQHRocm93cyBSb3V0ZUNvbmZpZ3VyYXRpb25FcnJvciBpZiBhbnkgcm91dGUncyBwYXltZW50IG9wdGlvbnMgZG9uJ3QgaGF2ZVxuICAgKiAgICAgICAgIGNvcnJlc3BvbmRpbmcgcmVnaXN0ZXJlZCBzY2hlbWVzIG9yIGZhY2lsaXRhdG9yIHN1cHBvcnRcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiBjb25zdCBodHRwU2VydmVyID0gbmV3IHg0MDJIVFRQUmVzb3VyY2VTZXJ2ZXIoc2VydmVyLCByb3V0ZXMpO1xuICAgKiBhd2FpdCBodHRwU2VydmVyLmluaXRpYWxpemUoKTtcbiAgICogYGBgXG4gICAqL1xuICBhc3luYyBpbml0aWFsaXplKCkge1xuICAgIGF3YWl0IHRoaXMuUmVzb3VyY2VTZXJ2ZXIuaW5pdGlhbGl6ZSgpO1xuICAgIGNvbnN0IGVycm9ycyA9IHRoaXMudmFsaWRhdGVSb3V0ZUNvbmZpZ3VyYXRpb24oKTtcbiAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRocm93IG5ldyBSb3V0ZUNvbmZpZ3VyYXRpb25FcnJvcihlcnJvcnMpO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBjdXN0b20gcGF5d2FsbCBwcm92aWRlciBmb3IgZ2VuZXJhdGluZyBIVE1MXG4gICAqXG4gICAqIEBwYXJhbSBwcm92aWRlciAtIFBheXdhbGxQcm92aWRlciBpbnN0YW5jZVxuICAgKiBAcmV0dXJucyBUaGlzIHNlcnZpY2UgaW5zdGFuY2UgZm9yIGNoYWluaW5nXG4gICAqL1xuICByZWdpc3RlclBheXdhbGxQcm92aWRlcihwcm92aWRlcikge1xuICAgIHRoaXMucGF5d2FsbFByb3ZpZGVyID0gcHJvdmlkZXI7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgLyoqXG4gICAqIFByb2Nlc3MgSFRUUCByZXF1ZXN0IGFuZCByZXR1cm4gcmVzcG9uc2UgaW5zdHJ1Y3Rpb25zXG4gICAqIFRoaXMgaXMgdGhlIG1haW4gZW50cnkgcG9pbnQgZm9yIGZyYW1ld29yayBtaWRkbGV3YXJlXG4gICAqXG4gICAqIEBwYXJhbSBjb250ZXh0IC0gSFRUUCByZXF1ZXN0IGNvbnRleHRcbiAgICogQHBhcmFtIHBheXdhbGxDb25maWcgLSBPcHRpb25hbCBwYXl3YWxsIGNvbmZpZ3VyYXRpb25cbiAgICogQHJldHVybnMgUHJvY2VzcyByZXN1bHQgaW5kaWNhdGluZyBuZXh0IGFjdGlvbiBmb3IgbWlkZGxld2FyZVxuICAgKi9cbiAgYXN5bmMgcHJvY2Vzc0hUVFBSZXF1ZXN0KGNvbnRleHQsIHBheXdhbGxDb25maWcpIHtcbiAgICBjb25zdCB7IGFkYXB0ZXIsIHBhdGgsIG1ldGhvZCB9ID0gY29udGV4dDtcbiAgICBjb25zdCByb3V0ZUNvbmZpZyA9IHRoaXMuZ2V0Um91dGVDb25maWcocGF0aCwgbWV0aG9kKTtcbiAgICBpZiAoIXJvdXRlQ29uZmlnKSB7XG4gICAgICByZXR1cm4geyB0eXBlOiBcIm5vLXBheW1lbnQtcmVxdWlyZWRcIiB9O1xuICAgIH1cbiAgICBjb25zdCBwYXltZW50T3B0aW9ucyA9IHRoaXMubm9ybWFsaXplUGF5bWVudE9wdGlvbnMocm91dGVDb25maWcpO1xuICAgIGNvbnN0IHBheW1lbnRQYXlsb2FkID0gdGhpcy5leHRyYWN0UGF5bWVudChhZGFwdGVyKTtcbiAgICBjb25zdCByZXNvdXJjZUluZm8gPSB7XG4gICAgICB1cmw6IHJvdXRlQ29uZmlnLnJlc291cmNlIHx8IGNvbnRleHQuYWRhcHRlci5nZXRVcmwoKSxcbiAgICAgIGRlc2NyaXB0aW9uOiByb3V0ZUNvbmZpZy5kZXNjcmlwdGlvbiB8fCBcIlwiLFxuICAgICAgbWltZVR5cGU6IHJvdXRlQ29uZmlnLm1pbWVUeXBlIHx8IFwiXCJcbiAgICB9O1xuICAgIGNvbnN0IHJlcXVpcmVtZW50cyA9IGF3YWl0IHRoaXMuUmVzb3VyY2VTZXJ2ZXIuYnVpbGRQYXltZW50UmVxdWlyZW1lbnRzRnJvbU9wdGlvbnMoXG4gICAgICBwYXltZW50T3B0aW9ucyxcbiAgICAgIGNvbnRleHRcbiAgICApO1xuICAgIGxldCBleHRlbnNpb25zID0gcm91dGVDb25maWcuZXh0ZW5zaW9ucztcbiAgICBpZiAoZXh0ZW5zaW9ucykge1xuICAgICAgZXh0ZW5zaW9ucyA9IHRoaXMuUmVzb3VyY2VTZXJ2ZXIuZW5yaWNoRXh0ZW5zaW9ucyhleHRlbnNpb25zLCBjb250ZXh0KTtcbiAgICB9XG4gICAgY29uc3QgcGF5bWVudFJlcXVpcmVkID0gdGhpcy5SZXNvdXJjZVNlcnZlci5jcmVhdGVQYXltZW50UmVxdWlyZWRSZXNwb25zZShcbiAgICAgIHJlcXVpcmVtZW50cyxcbiAgICAgIHJlc291cmNlSW5mbyxcbiAgICAgICFwYXltZW50UGF5bG9hZCA/IFwiUGF5bWVudCByZXF1aXJlZFwiIDogdm9pZCAwLFxuICAgICAgZXh0ZW5zaW9uc1xuICAgICk7XG4gICAgaWYgKCFwYXltZW50UGF5bG9hZCkge1xuICAgICAgY29uc3QgdW5wYWlkQm9keSA9IHJvdXRlQ29uZmlnLnVucGFpZFJlc3BvbnNlQm9keSA/IGF3YWl0IHJvdXRlQ29uZmlnLnVucGFpZFJlc3BvbnNlQm9keShjb250ZXh0KSA6IHZvaWQgMDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwicGF5bWVudC1lcnJvclwiLFxuICAgICAgICByZXNwb25zZTogdGhpcy5jcmVhdGVIVFRQUmVzcG9uc2UoXG4gICAgICAgICAgcGF5bWVudFJlcXVpcmVkLFxuICAgICAgICAgIHRoaXMuaXNXZWJCcm93c2VyKGFkYXB0ZXIpLFxuICAgICAgICAgIHBheXdhbGxDb25maWcsXG4gICAgICAgICAgcm91dGVDb25maWcuY3VzdG9tUGF5d2FsbEh0bWwsXG4gICAgICAgICAgdW5wYWlkQm9keVxuICAgICAgICApXG4gICAgICB9O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgbWF0Y2hpbmdSZXF1aXJlbWVudHMgPSB0aGlzLlJlc291cmNlU2VydmVyLmZpbmRNYXRjaGluZ1JlcXVpcmVtZW50cyhcbiAgICAgICAgcGF5bWVudFJlcXVpcmVkLmFjY2VwdHMsXG4gICAgICAgIHBheW1lbnRQYXlsb2FkXG4gICAgICApO1xuICAgICAgaWYgKCFtYXRjaGluZ1JlcXVpcmVtZW50cykge1xuICAgICAgICBjb25zdCBlcnJvclJlc3BvbnNlID0gdGhpcy5SZXNvdXJjZVNlcnZlci5jcmVhdGVQYXltZW50UmVxdWlyZWRSZXNwb25zZShcbiAgICAgICAgICByZXF1aXJlbWVudHMsXG4gICAgICAgICAgcmVzb3VyY2VJbmZvLFxuICAgICAgICAgIFwiTm8gbWF0Y2hpbmcgcGF5bWVudCByZXF1aXJlbWVudHNcIixcbiAgICAgICAgICByb3V0ZUNvbmZpZy5leHRlbnNpb25zXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdHlwZTogXCJwYXltZW50LWVycm9yXCIsXG4gICAgICAgICAgcmVzcG9uc2U6IHRoaXMuY3JlYXRlSFRUUFJlc3BvbnNlKGVycm9yUmVzcG9uc2UsIGZhbHNlLCBwYXl3YWxsQ29uZmlnKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgY29uc3QgdmVyaWZ5UmVzdWx0ID0gYXdhaXQgdGhpcy5SZXNvdXJjZVNlcnZlci52ZXJpZnlQYXltZW50KFxuICAgICAgICBwYXltZW50UGF5bG9hZCxcbiAgICAgICAgbWF0Y2hpbmdSZXF1aXJlbWVudHNcbiAgICAgICk7XG4gICAgICBpZiAoIXZlcmlmeVJlc3VsdC5pc1ZhbGlkKSB7XG4gICAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2UgPSB0aGlzLlJlc291cmNlU2VydmVyLmNyZWF0ZVBheW1lbnRSZXF1aXJlZFJlc3BvbnNlKFxuICAgICAgICAgIHJlcXVpcmVtZW50cyxcbiAgICAgICAgICByZXNvdXJjZUluZm8sXG4gICAgICAgICAgdmVyaWZ5UmVzdWx0LmludmFsaWRSZWFzb24sXG4gICAgICAgICAgcm91dGVDb25maWcuZXh0ZW5zaW9uc1xuICAgICAgICApO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHR5cGU6IFwicGF5bWVudC1lcnJvclwiLFxuICAgICAgICAgIHJlc3BvbnNlOiB0aGlzLmNyZWF0ZUhUVFBSZXNwb25zZShlcnJvclJlc3BvbnNlLCBmYWxzZSwgcGF5d2FsbENvbmZpZylcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwicGF5bWVudC12ZXJpZmllZFwiLFxuICAgICAgICBwYXltZW50UGF5bG9hZCxcbiAgICAgICAgcGF5bWVudFJlcXVpcmVtZW50czogbWF0Y2hpbmdSZXF1aXJlbWVudHNcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGVycm9yUmVzcG9uc2UgPSB0aGlzLlJlc291cmNlU2VydmVyLmNyZWF0ZVBheW1lbnRSZXF1aXJlZFJlc3BvbnNlKFxuICAgICAgICByZXF1aXJlbWVudHMsXG4gICAgICAgIHJlc291cmNlSW5mbyxcbiAgICAgICAgZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBcIlBheW1lbnQgdmVyaWZpY2F0aW9uIGZhaWxlZFwiLFxuICAgICAgICByb3V0ZUNvbmZpZy5leHRlbnNpb25zXG4gICAgICApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogXCJwYXltZW50LWVycm9yXCIsXG4gICAgICAgIHJlc3BvbnNlOiB0aGlzLmNyZWF0ZUhUVFBSZXNwb25zZShlcnJvclJlc3BvbnNlLCBmYWxzZSwgcGF5d2FsbENvbmZpZylcbiAgICAgIH07XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBQcm9jZXNzIHNldHRsZW1lbnQgYWZ0ZXIgc3VjY2Vzc2Z1bCByZXNwb25zZVxuICAgKlxuICAgKiBAcGFyYW0gcGF5bWVudFBheWxvYWQgLSBUaGUgdmVyaWZpZWQgcGF5bWVudCBwYXlsb2FkXG4gICAqIEBwYXJhbSByZXF1aXJlbWVudHMgLSBUaGUgbWF0Y2hpbmcgcGF5bWVudCByZXF1aXJlbWVudHNcbiAgICogQHJldHVybnMgUHJvY2Vzc1NldHRsZVJlc3VsdFJlc3BvbnNlIC0gU2V0dGxlUmVzcG9uc2Ugd2l0aCBoZWFkZXJzIGlmIHN1Y2Nlc3Mgb3IgZXJyb3JSZWFzb24gaWYgZmFpbHVyZVxuICAgKi9cbiAgYXN5bmMgcHJvY2Vzc1NldHRsZW1lbnQocGF5bWVudFBheWxvYWQsIHJlcXVpcmVtZW50cykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZXR0bGVSZXNwb25zZSA9IGF3YWl0IHRoaXMuUmVzb3VyY2VTZXJ2ZXIuc2V0dGxlUGF5bWVudChwYXltZW50UGF5bG9hZCwgcmVxdWlyZW1lbnRzKTtcbiAgICAgIGlmICghc2V0dGxlUmVzcG9uc2Uuc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLnNldHRsZVJlc3BvbnNlLFxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yUmVhc29uOiBzZXR0bGVSZXNwb25zZS5lcnJvclJlYXNvbiB8fCBcIlNldHRsZW1lbnQgZmFpbGVkXCJcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnNldHRsZVJlc3BvbnNlLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBoZWFkZXJzOiB0aGlzLmNyZWF0ZVNldHRsZW1lbnRIZWFkZXJzKHNldHRsZVJlc3BvbnNlKSxcbiAgICAgICAgcmVxdWlyZW1lbnRzXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBTZXR0bGVFcnJvcikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIGVycm9yUmVhc29uOiBlcnJvci5lcnJvclJlYXNvbiB8fCBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIHBheWVyOiBlcnJvci5wYXllcixcbiAgICAgICAgICBuZXR3b3JrOiBlcnJvci5uZXR3b3JrLFxuICAgICAgICAgIHRyYW5zYWN0aW9uOiBlcnJvci50cmFuc2FjdGlvblxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yUmVhc29uOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiU2V0dGxlbWVudCBmYWlsZWRcIixcbiAgICAgICAgbmV0d29yazogcmVxdWlyZW1lbnRzLm5ldHdvcmssXG4gICAgICAgIHRyYW5zYWN0aW9uOiBcIlwiXG4gICAgICB9O1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogQ2hlY2sgaWYgYSByZXF1ZXN0IHJlcXVpcmVzIHBheW1lbnQgYmFzZWQgb24gcm91dGUgY29uZmlndXJhdGlvblxuICAgKlxuICAgKiBAcGFyYW0gY29udGV4dCAtIEhUVFAgcmVxdWVzdCBjb250ZXh0XG4gICAqIEByZXR1cm5zIFRydWUgaWYgdGhlIHJvdXRlIHJlcXVpcmVzIHBheW1lbnQsIGZhbHNlIG90aGVyd2lzZVxuICAgKi9cbiAgcmVxdWlyZXNQYXltZW50KGNvbnRleHQpIHtcbiAgICBjb25zdCByb3V0ZUNvbmZpZyA9IHRoaXMuZ2V0Um91dGVDb25maWcoY29udGV4dC5wYXRoLCBjb250ZXh0Lm1ldGhvZCk7XG4gICAgcmV0dXJuIHJvdXRlQ29uZmlnICE9PSB2b2lkIDA7XG4gIH1cbiAgLyoqXG4gICAqIE5vcm1hbGl6ZXMgYSBSb3V0ZUNvbmZpZydzIGFjY2VwdHMgZmllbGQgaW50byBhbiBhcnJheSBvZiBQYXltZW50T3B0aW9uc1xuICAgKiBIYW5kbGVzIGJvdGggc2luZ2xlIFBheW1lbnRPcHRpb24gYW5kIGFycmF5IGZvcm1hdHNcbiAgICpcbiAgICogQHBhcmFtIHJvdXRlQ29uZmlnIC0gUm91dGUgY29uZmlndXJhdGlvblxuICAgKiBAcmV0dXJucyBBcnJheSBvZiBwYXltZW50IG9wdGlvbnNcbiAgICovXG4gIG5vcm1hbGl6ZVBheW1lbnRPcHRpb25zKHJvdXRlQ29uZmlnKSB7XG4gICAgcmV0dXJuIEFycmF5LmlzQXJyYXkocm91dGVDb25maWcuYWNjZXB0cykgPyByb3V0ZUNvbmZpZy5hY2NlcHRzIDogW3JvdXRlQ29uZmlnLmFjY2VwdHNdO1xuICB9XG4gIC8qKlxuICAgKiBWYWxpZGF0ZXMgdGhhdCBhbGwgcGF5bWVudCBvcHRpb25zIGluIHJvdXRlcyBoYXZlIGNvcnJlc3BvbmRpbmcgcmVnaXN0ZXJlZCBzY2hlbWVzXG4gICAqIGFuZCBmYWNpbGl0YXRvciBzdXBwb3J0LlxuICAgKlxuICAgKiBAcmV0dXJucyBBcnJheSBvZiB2YWxpZGF0aW9uIGVycm9ycyAoZW1wdHkgaWYgYWxsIHJvdXRlcyBhcmUgdmFsaWQpXG4gICAqL1xuICB2YWxpZGF0ZVJvdXRlQ29uZmlndXJhdGlvbigpIHtcbiAgICBjb25zdCBlcnJvcnMgPSBbXTtcbiAgICBjb25zdCBub3JtYWxpemVkUm91dGVzID0gdHlwZW9mIHRoaXMucm91dGVzQ29uZmlnID09PSBcIm9iamVjdFwiICYmICEoXCJhY2NlcHRzXCIgaW4gdGhpcy5yb3V0ZXNDb25maWcpID8gT2JqZWN0LmVudHJpZXModGhpcy5yb3V0ZXNDb25maWcpIDogW1tcIipcIiwgdGhpcy5yb3V0ZXNDb25maWddXTtcbiAgICBmb3IgKGNvbnN0IFtwYXR0ZXJuLCBjb25maWddIG9mIG5vcm1hbGl6ZWRSb3V0ZXMpIHtcbiAgICAgIGNvbnN0IHBheW1lbnRPcHRpb25zID0gdGhpcy5ub3JtYWxpemVQYXltZW50T3B0aW9ucyhjb25maWcpO1xuICAgICAgZm9yIChjb25zdCBvcHRpb24gb2YgcGF5bWVudE9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCF0aGlzLlJlc291cmNlU2VydmVyLmhhc1JlZ2lzdGVyZWRTY2hlbWUob3B0aW9uLm5ldHdvcmssIG9wdGlvbi5zY2hlbWUpKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goe1xuICAgICAgICAgICAgcm91dGVQYXR0ZXJuOiBwYXR0ZXJuLFxuICAgICAgICAgICAgc2NoZW1lOiBvcHRpb24uc2NoZW1lLFxuICAgICAgICAgICAgbmV0d29yazogb3B0aW9uLm5ldHdvcmssXG4gICAgICAgICAgICByZWFzb246IFwibWlzc2luZ19zY2hlbWVcIixcbiAgICAgICAgICAgIG1lc3NhZ2U6IGBSb3V0ZSBcIiR7cGF0dGVybn1cIjogTm8gc2NoZW1lIGltcGxlbWVudGF0aW9uIHJlZ2lzdGVyZWQgZm9yIFwiJHtvcHRpb24uc2NoZW1lfVwiIG9uIG5ldHdvcmsgXCIke29wdGlvbi5uZXR3b3JrfVwiYFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN1cHBvcnRlZEtpbmQgPSB0aGlzLlJlc291cmNlU2VydmVyLmdldFN1cHBvcnRlZEtpbmQoXG4gICAgICAgICAgeDQwMlZlcnNpb24sXG4gICAgICAgICAgb3B0aW9uLm5ldHdvcmssXG4gICAgICAgICAgb3B0aW9uLnNjaGVtZVxuICAgICAgICApO1xuICAgICAgICBpZiAoIXN1cHBvcnRlZEtpbmQpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaCh7XG4gICAgICAgICAgICByb3V0ZVBhdHRlcm46IHBhdHRlcm4sXG4gICAgICAgICAgICBzY2hlbWU6IG9wdGlvbi5zY2hlbWUsXG4gICAgICAgICAgICBuZXR3b3JrOiBvcHRpb24ubmV0d29yayxcbiAgICAgICAgICAgIHJlYXNvbjogXCJtaXNzaW5nX2ZhY2lsaXRhdG9yXCIsXG4gICAgICAgICAgICBtZXNzYWdlOiBgUm91dGUgXCIke3BhdHRlcm59XCI6IEZhY2lsaXRhdG9yIGRvZXMgbm90IHN1cHBvcnQgc2NoZW1lIFwiJHtvcHRpb24uc2NoZW1lfVwiIG9uIG5ldHdvcmsgXCIke29wdGlvbi5uZXR3b3JrfVwiYFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBlcnJvcnM7XG4gIH1cbiAgLyoqXG4gICAqIEdldCByb3V0ZSBjb25maWd1cmF0aW9uIGZvciBhIHJlcXVlc3RcbiAgICpcbiAgICogQHBhcmFtIHBhdGggLSBSZXF1ZXN0IHBhdGhcbiAgICogQHBhcmFtIG1ldGhvZCAtIEhUVFAgbWV0aG9kXG4gICAqIEByZXR1cm5zIFJvdXRlIGNvbmZpZ3VyYXRpb24gb3IgdW5kZWZpbmVkIGlmIG5vIG1hdGNoXG4gICAqL1xuICBnZXRSb3V0ZUNvbmZpZyhwYXRoLCBtZXRob2QpIHtcbiAgICBjb25zdCBub3JtYWxpemVkUGF0aCA9IHRoaXMubm9ybWFsaXplUGF0aChwYXRoKTtcbiAgICBjb25zdCB1cHBlck1ldGhvZCA9IG1ldGhvZC50b1VwcGVyQ2FzZSgpO1xuICAgIGNvbnN0IG1hdGNoaW5nUm91dGUgPSB0aGlzLmNvbXBpbGVkUm91dGVzLmZpbmQoXG4gICAgICAocm91dGUpID0+IHJvdXRlLnJlZ2V4LnRlc3Qobm9ybWFsaXplZFBhdGgpICYmIChyb3V0ZS52ZXJiID09PSBcIipcIiB8fCByb3V0ZS52ZXJiID09PSB1cHBlck1ldGhvZClcbiAgICApO1xuICAgIHJldHVybiBtYXRjaGluZ1JvdXRlPy5jb25maWc7XG4gIH1cbiAgLyoqXG4gICAqIEV4dHJhY3QgcGF5bWVudCBmcm9tIEhUVFAgaGVhZGVycyAoaGFuZGxlcyB2MSBhbmQgdjIpXG4gICAqXG4gICAqIEBwYXJhbSBhZGFwdGVyIC0gSFRUUCBhZGFwdGVyXG4gICAqIEByZXR1cm5zIERlY29kZWQgcGF5bWVudCBwYXlsb2FkIG9yIG51bGxcbiAgICovXG4gIGV4dHJhY3RQYXltZW50KGFkYXB0ZXIpIHtcbiAgICBjb25zdCBoZWFkZXIgPSBhZGFwdGVyLmdldEhlYWRlcihcInBheW1lbnQtc2lnbmF0dXJlXCIpIHx8IGFkYXB0ZXIuZ2V0SGVhZGVyKFwiUEFZTUVOVC1TSUdOQVRVUkVcIik7XG4gICAgaWYgKGhlYWRlcikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGRlY29kZVBheW1lbnRTaWduYXR1cmVIZWFkZXIoaGVhZGVyKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIkZhaWxlZCB0byBkZWNvZGUgUEFZTUVOVC1TSUdOQVRVUkUgaGVhZGVyOlwiLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIC8qKlxuICAgKiBDaGVjayBpZiByZXF1ZXN0IGlzIGZyb20gYSB3ZWIgYnJvd3NlclxuICAgKlxuICAgKiBAcGFyYW0gYWRhcHRlciAtIEhUVFAgYWRhcHRlclxuICAgKiBAcmV0dXJucyBUcnVlIGlmIHJlcXVlc3QgYXBwZWFycyB0byBiZSBmcm9tIGEgYnJvd3NlclxuICAgKi9cbiAgaXNXZWJCcm93c2VyKGFkYXB0ZXIpIHtcbiAgICBjb25zdCBhY2NlcHQgPSBhZGFwdGVyLmdldEFjY2VwdEhlYWRlcigpO1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9IGFkYXB0ZXIuZ2V0VXNlckFnZW50KCk7XG4gICAgcmV0dXJuIGFjY2VwdC5pbmNsdWRlcyhcInRleHQvaHRtbFwiKSAmJiB1c2VyQWdlbnQuaW5jbHVkZXMoXCJNb3ppbGxhXCIpO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGUgSFRUUCByZXNwb25zZSBpbnN0cnVjdGlvbnMgZnJvbSBwYXltZW50IHJlcXVpcmVkXG4gICAqXG4gICAqIEBwYXJhbSBwYXltZW50UmVxdWlyZWQgLSBQYXltZW50IHJlcXVpcmVtZW50c1xuICAgKiBAcGFyYW0gaXNXZWJCcm93c2VyIC0gV2hldGhlciByZXF1ZXN0IGlzIGZyb20gYnJvd3NlclxuICAgKiBAcGFyYW0gcGF5d2FsbENvbmZpZyAtIFBheXdhbGwgY29uZmlndXJhdGlvblxuICAgKiBAcGFyYW0gY3VzdG9tSHRtbCAtIEN1c3RvbSBIVE1MIHRlbXBsYXRlXG4gICAqIEBwYXJhbSB1bnBhaWRSZXNwb25zZSAtIE9wdGlvbmFsIGN1c3RvbSByZXNwb25zZSAoY29udGVudCB0eXBlIGFuZCBib2R5KSBmb3IgdW5wYWlkIEFQSSByZXF1ZXN0c1xuICAgKiBAcmV0dXJucyBSZXNwb25zZSBpbnN0cnVjdGlvbnNcbiAgICovXG4gIGNyZWF0ZUhUVFBSZXNwb25zZShwYXltZW50UmVxdWlyZWQsIGlzV2ViQnJvd3NlciwgcGF5d2FsbENvbmZpZywgY3VzdG9tSHRtbCwgdW5wYWlkUmVzcG9uc2UpIHtcbiAgICBpZiAoaXNXZWJCcm93c2VyKSB7XG4gICAgICBjb25zdCBodG1sID0gdGhpcy5nZW5lcmF0ZVBheXdhbGxIVE1MKHBheW1lbnRSZXF1aXJlZCwgcGF5d2FsbENvbmZpZywgY3VzdG9tSHRtbCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXM6IDQwMixcbiAgICAgICAgaGVhZGVyczogeyBcIkNvbnRlbnQtVHlwZVwiOiBcInRleHQvaHRtbFwiIH0sXG4gICAgICAgIGJvZHk6IGh0bWwsXG4gICAgICAgIGlzSHRtbDogdHJ1ZVxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSB0aGlzLmNyZWF0ZUhUVFBQYXltZW50UmVxdWlyZWRSZXNwb25zZShwYXltZW50UmVxdWlyZWQpO1xuICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gdW5wYWlkUmVzcG9uc2UgPyB1bnBhaWRSZXNwb25zZS5jb250ZW50VHlwZSA6IFwiYXBwbGljYXRpb24vanNvblwiO1xuICAgIGNvbnN0IGJvZHkgPSB1bnBhaWRSZXNwb25zZSA/IHVucGFpZFJlc3BvbnNlLmJvZHkgOiB7fTtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdHVzOiA0MDIsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IGNvbnRlbnRUeXBlLFxuICAgICAgICAuLi5yZXNwb25zZS5oZWFkZXJzXG4gICAgICB9LFxuICAgICAgYm9keVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIENyZWF0ZSBIVFRQIHBheW1lbnQgcmVxdWlyZWQgcmVzcG9uc2UgKHYxIHB1dHMgaW4gYm9keSwgdjIgcHV0cyBpbiBoZWFkZXIpXG4gICAqXG4gICAqIEBwYXJhbSBwYXltZW50UmVxdWlyZWQgLSBQYXltZW50IHJlcXVpcmVkIG9iamVjdFxuICAgKiBAcmV0dXJucyBIZWFkZXJzIGFuZCBib2R5IGZvciB0aGUgSFRUUCByZXNwb25zZVxuICAgKi9cbiAgY3JlYXRlSFRUUFBheW1lbnRSZXF1aXJlZFJlc3BvbnNlKHBheW1lbnRSZXF1aXJlZCkge1xuICAgIHJldHVybiB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiUEFZTUVOVC1SRVFVSVJFRFwiOiBlbmNvZGVQYXltZW50UmVxdWlyZWRIZWFkZXIocGF5bWVudFJlcXVpcmVkKVxuICAgICAgfVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIENyZWF0ZSBzZXR0bGVtZW50IHJlc3BvbnNlIGhlYWRlcnNcbiAgICpcbiAgICogQHBhcmFtIHNldHRsZVJlc3BvbnNlIC0gU2V0dGxlbWVudCByZXNwb25zZVxuICAgKiBAcmV0dXJucyBIZWFkZXJzIHRvIGFkZCB0byByZXNwb25zZVxuICAgKi9cbiAgY3JlYXRlU2V0dGxlbWVudEhlYWRlcnMoc2V0dGxlUmVzcG9uc2UpIHtcbiAgICBjb25zdCBlbmNvZGVkID0gZW5jb2RlUGF5bWVudFJlc3BvbnNlSGVhZGVyKHNldHRsZVJlc3BvbnNlKTtcbiAgICByZXR1cm4geyBcIlBBWU1FTlQtUkVTUE9OU0VcIjogZW5jb2RlZCB9O1xuICB9XG4gIC8qKlxuICAgKiBQYXJzZSByb3V0ZSBwYXR0ZXJuIGludG8gdmVyYiBhbmQgcmVnZXhcbiAgICpcbiAgICogQHBhcmFtIHBhdHRlcm4gLSBSb3V0ZSBwYXR0ZXJuIGxpa2UgXCJHRVQgL2FwaS8qXCIgb3IgXCIvYXBpL1tpZF1cIlxuICAgKiBAcmV0dXJucyBQYXJzZWQgcGF0dGVybiB3aXRoIHZlcmIgYW5kIHJlZ2V4XG4gICAqL1xuICBwYXJzZVJvdXRlUGF0dGVybihwYXR0ZXJuKSB7XG4gICAgY29uc3QgW3ZlcmIsIHBhdGhdID0gcGF0dGVybi5pbmNsdWRlcyhcIiBcIikgPyBwYXR0ZXJuLnNwbGl0KC9cXHMrLykgOiBbXCIqXCIsIHBhdHRlcm5dO1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChcbiAgICAgIGBeJHtwYXRoLnJlcGxhY2UoL1skKCkrLj9ee3x9XS9nLCBcIlxcXFwkJlwiKS5yZXBsYWNlKC9cXCovZywgXCIuKj9cIikucmVwbGFjZSgvXFxbKFteXFxdXSspXFxdL2csIFwiW14vXStcIikucmVwbGFjZSgvXFwvL2csIFwiXFxcXC9cIil9JGAsXG4gICAgICBcImlcIlxuICAgICk7XG4gICAgcmV0dXJuIHsgdmVyYjogdmVyYi50b1VwcGVyQ2FzZSgpLCByZWdleCB9O1xuICB9XG4gIC8qKlxuICAgKiBOb3JtYWxpemUgcGF0aCBmb3IgbWF0Y2hpbmdcbiAgICpcbiAgICogQHBhcmFtIHBhdGggLSBSYXcgcGF0aCBmcm9tIHJlcXVlc3RcbiAgICogQHJldHVybnMgTm9ybWFsaXplZCBwYXRoXG4gICAqL1xuICBub3JtYWxpemVQYXRoKHBhdGgpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGF0aFdpdGhvdXRRdWVyeSA9IHBhdGguc3BsaXQoL1s/I10vKVswXTtcbiAgICAgIGNvbnN0IGRlY29kZWRQYXRoID0gZGVjb2RlVVJJQ29tcG9uZW50KHBhdGhXaXRob3V0UXVlcnkpO1xuICAgICAgcmV0dXJuIGRlY29kZWRQYXRoLnJlcGxhY2UoL1xcXFwvZywgXCIvXCIpLnJlcGxhY2UoL1xcLysvZywgXCIvXCIpLnJlcGxhY2UoLyguKz8pXFwvKyQvLCBcIiQxXCIpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIHBhdGg7XG4gICAgfVxuICB9XG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBwYXl3YWxsIEhUTUwgZm9yIGJyb3dzZXIgcmVxdWVzdHNcbiAgICpcbiAgICogQHBhcmFtIHBheW1lbnRSZXF1aXJlZCAtIFBheW1lbnQgcmVxdWlyZWQgcmVzcG9uc2VcbiAgICogQHBhcmFtIHBheXdhbGxDb25maWcgLSBPcHRpb25hbCBwYXl3YWxsIGNvbmZpZ3VyYXRpb25cbiAgICogQHBhcmFtIGN1c3RvbUh0bWwgLSBPcHRpb25hbCBjdXN0b20gSFRNTCB0ZW1wbGF0ZVxuICAgKiBAcmV0dXJucyBIVE1MIHN0cmluZ1xuICAgKi9cbiAgZ2VuZXJhdGVQYXl3YWxsSFRNTChwYXltZW50UmVxdWlyZWQsIHBheXdhbGxDb25maWcsIGN1c3RvbUh0bWwpIHtcbiAgICBpZiAoY3VzdG9tSHRtbCkge1xuICAgICAgcmV0dXJuIGN1c3RvbUh0bWw7XG4gICAgfVxuICAgIGlmICh0aGlzLnBheXdhbGxQcm92aWRlcikge1xuICAgICAgcmV0dXJuIHRoaXMucGF5d2FsbFByb3ZpZGVyLmdlbmVyYXRlSHRtbChwYXltZW50UmVxdWlyZWQsIHBheXdhbGxDb25maWcpO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgcGF5d2FsbCA9IF9fcmVxdWlyZShcIkB4NDAyL3BheXdhbGxcIik7XG4gICAgICBjb25zdCBkaXNwbGF5QW1vdW50MiA9IHRoaXMuZ2V0RGlzcGxheUFtb3VudChwYXltZW50UmVxdWlyZWQpO1xuICAgICAgY29uc3QgcmVzb3VyY2UyID0gcGF5bWVudFJlcXVpcmVkLnJlc291cmNlO1xuICAgICAgcmV0dXJuIHBheXdhbGwuZ2V0UGF5d2FsbEh0bWwoe1xuICAgICAgICBhbW91bnQ6IGRpc3BsYXlBbW91bnQyLFxuICAgICAgICBwYXltZW50UmVxdWlyZWQsXG4gICAgICAgIGN1cnJlbnRVcmw6IHJlc291cmNlMj8udXJsIHx8IHBheXdhbGxDb25maWc/LmN1cnJlbnRVcmwgfHwgXCJcIixcbiAgICAgICAgdGVzdG5ldDogcGF5d2FsbENvbmZpZz8udGVzdG5ldCA/PyB0cnVlLFxuICAgICAgICBhcHBOYW1lOiBwYXl3YWxsQ29uZmlnPy5hcHBOYW1lLFxuICAgICAgICBhcHBMb2dvOiBwYXl3YWxsQ29uZmlnPy5hcHBMb2dvLFxuICAgICAgICBzZXNzaW9uVG9rZW5FbmRwb2ludDogcGF5d2FsbENvbmZpZz8uc2Vzc2lvblRva2VuRW5kcG9pbnRcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2gge1xuICAgIH1cbiAgICBjb25zdCByZXNvdXJjZSA9IHBheW1lbnRSZXF1aXJlZC5yZXNvdXJjZTtcbiAgICBjb25zdCBkaXNwbGF5QW1vdW50ID0gdGhpcy5nZXREaXNwbGF5QW1vdW50KHBheW1lbnRSZXF1aXJlZCk7XG4gICAgcmV0dXJuIGBcbiAgICAgIDwhRE9DVFlQRSBodG1sPlxuICAgICAgPGh0bWw+XG4gICAgICAgIDxoZWFkPlxuICAgICAgICAgIDx0aXRsZT5QYXltZW50IFJlcXVpcmVkPC90aXRsZT5cbiAgICAgICAgICA8bWV0YSBjaGFyc2V0PVwiVVRGLThcIj5cbiAgICAgICAgICA8bWV0YSBuYW1lPVwidmlld3BvcnRcIiBjb250ZW50PVwid2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMFwiPlxuICAgICAgICA8L2hlYWQ+XG4gICAgICAgIDxib2R5PlxuICAgICAgICAgIDxkaXYgc3R5bGU9XCJtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDUwcHggYXV0bzsgcGFkZGluZzogMjBweDsgZm9udC1mYW1pbHk6IHN5c3RlbS11aSwgLWFwcGxlLXN5c3RlbSwgc2Fucy1zZXJpZjtcIj5cbiAgICAgICAgICAgICR7cGF5d2FsbENvbmZpZz8uYXBwTG9nbyA/IGA8aW1nIHNyYz1cIiR7cGF5d2FsbENvbmZpZy5hcHBMb2dvfVwiIGFsdD1cIiR7cGF5d2FsbENvbmZpZy5hcHBOYW1lIHx8IFwiQXBwXCJ9XCIgc3R5bGU9XCJtYXgtd2lkdGg6IDIwMHB4OyBtYXJnaW4tYm90dG9tOiAyMHB4O1wiPmAgOiBcIlwifVxuICAgICAgICAgICAgPGgxPlBheW1lbnQgUmVxdWlyZWQ8L2gxPlxuICAgICAgICAgICAgJHtyZXNvdXJjZSA/IGA8cD48c3Ryb25nPlJlc291cmNlOjwvc3Ryb25nPiAke3Jlc291cmNlLmRlc2NyaXB0aW9uIHx8IHJlc291cmNlLnVybH08L3A+YCA6IFwiXCJ9XG4gICAgICAgICAgICA8cD48c3Ryb25nPkFtb3VudDo8L3N0cm9uZz4gJCR7ZGlzcGxheUFtb3VudC50b0ZpeGVkKDIpfSBVU0RDPC9wPlxuICAgICAgICAgICAgPGRpdiBpZD1cInBheW1lbnQtd2lkZ2V0XCIgXG4gICAgICAgICAgICAgICAgIGRhdGEtcmVxdWlyZW1lbnRzPScke0pTT04uc3RyaW5naWZ5KHBheW1lbnRSZXF1aXJlZCl9J1xuICAgICAgICAgICAgICAgICBkYXRhLWFwcC1uYW1lPVwiJHtwYXl3YWxsQ29uZmlnPy5hcHBOYW1lIHx8IFwiXCJ9XCJcbiAgICAgICAgICAgICAgICAgZGF0YS10ZXN0bmV0PVwiJHtwYXl3YWxsQ29uZmlnPy50ZXN0bmV0IHx8IGZhbHNlfVwiPlxuICAgICAgICAgICAgICA8IS0tIEluc3RhbGwgQHg0MDIvcGF5d2FsbCBmb3IgZnVsbCB3YWxsZXQgaW50ZWdyYXRpb24gLS0+XG4gICAgICAgICAgICAgIDxwIHN0eWxlPVwibWFyZ2luLXRvcDogMnJlbTsgcGFkZGluZzogMXJlbTsgYmFja2dyb3VuZDogI2ZlZjNjNzsgYm9yZGVyLXJhZGl1czogMC41cmVtO1wiPlxuICAgICAgICAgICAgICAgIDxzdHJvbmc+Tm90ZTo8L3N0cm9uZz4gSW5zdGFsbCA8Y29kZT5AeDQwMi9wYXl3YWxsPC9jb2RlPiBmb3IgZnVsbCB3YWxsZXQgY29ubmVjdGlvbiBhbmQgcGF5bWVudCBVSS5cbiAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvYm9keT5cbiAgICAgIDwvaHRtbD5cbiAgICBgO1xuICB9XG4gIC8qKlxuICAgKiBFeHRyYWN0IGRpc3BsYXkgYW1vdW50IGZyb20gcGF5bWVudCByZXF1aXJlbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSBwYXltZW50UmVxdWlyZWQgLSBUaGUgcGF5bWVudCByZXF1aXJlZCBvYmplY3RcbiAgICogQHJldHVybnMgVGhlIGRpc3BsYXkgYW1vdW50IGluIGRlY2ltYWwgZm9ybWF0XG4gICAqL1xuICBnZXREaXNwbGF5QW1vdW50KHBheW1lbnRSZXF1aXJlZCkge1xuICAgIGNvbnN0IGFjY2VwdHMgPSBwYXltZW50UmVxdWlyZWQuYWNjZXB0cztcbiAgICBpZiAoYWNjZXB0cyAmJiBhY2NlcHRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGZpcnN0UmVxID0gYWNjZXB0c1swXTtcbiAgICAgIGlmIChcImFtb3VudFwiIGluIGZpcnN0UmVxKSB7XG4gICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGZpcnN0UmVxLmFtb3VudCkgLyAxZTY7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9XG59O1xuXG4vLyBzcmMvaHR0cC9odHRwRmFjaWxpdGF0b3JDbGllbnQudHNcbnZhciBERUZBVUxUX0ZBQ0lMSVRBVE9SX1VSTCA9IFwiaHR0cHM6Ly94NDAyLm9yZy9mYWNpbGl0YXRvclwiO1xudmFyIEhUVFBGYWNpbGl0YXRvckNsaWVudCA9IGNsYXNzIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgSFRUUEZhY2lsaXRhdG9yQ2xpZW50IGluc3RhbmNlLlxuICAgKlxuICAgKiBAcGFyYW0gY29uZmlnIC0gQ29uZmlndXJhdGlvbiBvcHRpb25zIGZvciB0aGUgZmFjaWxpdGF0b3IgY2xpZW50XG4gICAqL1xuICBjb25zdHJ1Y3Rvcihjb25maWcpIHtcbiAgICB0aGlzLnVybCA9IGNvbmZpZz8udXJsIHx8IERFRkFVTFRfRkFDSUxJVEFUT1JfVVJMO1xuICAgIHRoaXMuX2NyZWF0ZUF1dGhIZWFkZXJzID0gY29uZmlnPy5jcmVhdGVBdXRoSGVhZGVycztcbiAgfVxuICAvKipcbiAgICogVmVyaWZ5IGEgcGF5bWVudCB3aXRoIHRoZSBmYWNpbGl0YXRvclxuICAgKlxuICAgKiBAcGFyYW0gcGF5bWVudFBheWxvYWQgLSBUaGUgcGF5bWVudCB0byB2ZXJpZnlcbiAgICogQHBhcmFtIHBheW1lbnRSZXF1aXJlbWVudHMgLSBUaGUgcmVxdWlyZW1lbnRzIHRvIHZlcmlmeSBhZ2FpbnN0XG4gICAqIEByZXR1cm5zIFZlcmlmaWNhdGlvbiByZXNwb25zZVxuICAgKi9cbiAgYXN5bmMgdmVyaWZ5KHBheW1lbnRQYXlsb2FkLCBwYXltZW50UmVxdWlyZW1lbnRzKSB7XG4gICAgbGV0IGhlYWRlcnMgPSB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgIH07XG4gICAgaWYgKHRoaXMuX2NyZWF0ZUF1dGhIZWFkZXJzKSB7XG4gICAgICBjb25zdCBhdXRoSGVhZGVycyA9IGF3YWl0IHRoaXMuY3JlYXRlQXV0aEhlYWRlcnMoXCJ2ZXJpZnlcIik7XG4gICAgICBoZWFkZXJzID0geyAuLi5oZWFkZXJzLCAuLi5hdXRoSGVhZGVycy5oZWFkZXJzIH07XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy51cmx9L3ZlcmlmeWAsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB4NDAyVmVyc2lvbjogcGF5bWVudFBheWxvYWQueDQwMlZlcnNpb24sXG4gICAgICAgIHBheW1lbnRQYXlsb2FkOiB0aGlzLnRvSnNvblNhZmUocGF5bWVudFBheWxvYWQpLFxuICAgICAgICBwYXltZW50UmVxdWlyZW1lbnRzOiB0aGlzLnRvSnNvblNhZmUocGF5bWVudFJlcXVpcmVtZW50cylcbiAgICAgIH0pXG4gICAgfSk7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBpZiAodHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIgJiYgZGF0YSAhPT0gbnVsbCAmJiBcImlzVmFsaWRcIiBpbiBkYXRhKSB7XG4gICAgICBjb25zdCB2ZXJpZnlSZXNwb25zZSA9IGRhdGE7XG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBWZXJpZnlFcnJvcihyZXNwb25zZS5zdGF0dXMsIHZlcmlmeVJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2ZXJpZnlSZXNwb25zZTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWNpbGl0YXRvciB2ZXJpZnkgZmFpbGVkICgke3Jlc3BvbnNlLnN0YXR1c30pOiAke0pTT04uc3RyaW5naWZ5KGRhdGEpfWApO1xuICB9XG4gIC8qKlxuICAgKiBTZXR0bGUgYSBwYXltZW50IHdpdGggdGhlIGZhY2lsaXRhdG9yXG4gICAqXG4gICAqIEBwYXJhbSBwYXltZW50UGF5bG9hZCAtIFRoZSBwYXltZW50IHRvIHNldHRsZVxuICAgKiBAcGFyYW0gcGF5bWVudFJlcXVpcmVtZW50cyAtIFRoZSByZXF1aXJlbWVudHMgZm9yIHNldHRsZW1lbnRcbiAgICogQHJldHVybnMgU2V0dGxlbWVudCByZXNwb25zZVxuICAgKi9cbiAgYXN5bmMgc2V0dGxlKHBheW1lbnRQYXlsb2FkLCBwYXltZW50UmVxdWlyZW1lbnRzKSB7XG4gICAgbGV0IGhlYWRlcnMgPSB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgIH07XG4gICAgaWYgKHRoaXMuX2NyZWF0ZUF1dGhIZWFkZXJzKSB7XG4gICAgICBjb25zdCBhdXRoSGVhZGVycyA9IGF3YWl0IHRoaXMuY3JlYXRlQXV0aEhlYWRlcnMoXCJzZXR0bGVcIik7XG4gICAgICBoZWFkZXJzID0geyAuLi5oZWFkZXJzLCAuLi5hdXRoSGVhZGVycy5oZWFkZXJzIH07XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7dGhpcy51cmx9L3NldHRsZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB4NDAyVmVyc2lvbjogcGF5bWVudFBheWxvYWQueDQwMlZlcnNpb24sXG4gICAgICAgIHBheW1lbnRQYXlsb2FkOiB0aGlzLnRvSnNvblNhZmUocGF5bWVudFBheWxvYWQpLFxuICAgICAgICBwYXltZW50UmVxdWlyZW1lbnRzOiB0aGlzLnRvSnNvblNhZmUocGF5bWVudFJlcXVpcmVtZW50cylcbiAgICAgIH0pXG4gICAgfSk7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBpZiAodHlwZW9mIGRhdGEgPT09IFwib2JqZWN0XCIgJiYgZGF0YSAhPT0gbnVsbCAmJiBcInN1Y2Nlc3NcIiBpbiBkYXRhKSB7XG4gICAgICBjb25zdCBzZXR0bGVSZXNwb25zZSA9IGRhdGE7XG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBTZXR0bGVFcnJvcihyZXNwb25zZS5zdGF0dXMsIHNldHRsZVJlc3BvbnNlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzZXR0bGVSZXNwb25zZTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWNpbGl0YXRvciBzZXR0bGUgZmFpbGVkICgke3Jlc3BvbnNlLnN0YXR1c30pOiAke0pTT04uc3RyaW5naWZ5KGRhdGEpfWApO1xuICB9XG4gIC8qKlxuICAgKiBHZXQgc3VwcG9ydGVkIHBheW1lbnQga2luZHMgYW5kIGV4dGVuc2lvbnMgZnJvbSB0aGUgZmFjaWxpdGF0b3JcbiAgICpcbiAgICogQHJldHVybnMgU3VwcG9ydGVkIHBheW1lbnQga2luZHMgYW5kIGV4dGVuc2lvbnNcbiAgICovXG4gIGFzeW5jIGdldFN1cHBvcnRlZCgpIHtcbiAgICBsZXQgaGVhZGVycyA9IHtcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXG4gICAgfTtcbiAgICBpZiAodGhpcy5fY3JlYXRlQXV0aEhlYWRlcnMpIHtcbiAgICAgIGNvbnN0IGF1dGhIZWFkZXJzID0gYXdhaXQgdGhpcy5jcmVhdGVBdXRoSGVhZGVycyhcInN1cHBvcnRlZFwiKTtcbiAgICAgIGhlYWRlcnMgPSB7IC4uLmhlYWRlcnMsIC4uLmF1dGhIZWFkZXJzLmhlYWRlcnMgfTtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt0aGlzLnVybH0vc3VwcG9ydGVkYCwge1xuICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgaGVhZGVyc1xuICAgIH0pO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKS5jYXRjaCgoKSA9PiByZXNwb25zZS5zdGF0dXNUZXh0KTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFjaWxpdGF0b3IgZ2V0U3VwcG9ydGVkIGZhaWxlZCAoJHtyZXNwb25zZS5zdGF0dXN9KTogJHtlcnJvclRleHR9YCk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gIH1cbiAgLyoqXG4gICAqIENyZWF0ZXMgYXV0aGVudGljYXRpb24gaGVhZGVycyBmb3IgYSBzcGVjaWZpYyBwYXRoLlxuICAgKlxuICAgKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIGNyZWF0ZSBhdXRoZW50aWNhdGlvbiBoZWFkZXJzIGZvciAoZS5nLiwgXCJ2ZXJpZnlcIiwgXCJzZXR0bGVcIiwgXCJzdXBwb3J0ZWRcIilcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIGF1dGhlbnRpY2F0aW9uIGhlYWRlcnMgZm9yIHRoZSBzcGVjaWZpZWQgcGF0aFxuICAgKi9cbiAgYXN5bmMgY3JlYXRlQXV0aEhlYWRlcnMocGF0aCkge1xuICAgIGlmICh0aGlzLl9jcmVhdGVBdXRoSGVhZGVycykge1xuICAgICAgY29uc3QgYXV0aEhlYWRlcnMgPSBhd2FpdCB0aGlzLl9jcmVhdGVBdXRoSGVhZGVycygpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGVhZGVyczogYXV0aEhlYWRlcnNbcGF0aF0gPz8ge31cbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBoZWFkZXJzOiB7fVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIEhlbHBlciB0byBjb252ZXJ0IG9iamVjdHMgdG8gSlNPTi1zYWZlIGZvcm1hdC5cbiAgICogSGFuZGxlcyBCaWdJbnQgYW5kIG90aGVyIG5vbi1KU09OIHR5cGVzLlxuICAgKlxuICAgKiBAcGFyYW0gb2JqIC0gVGhlIG9iamVjdCB0byBjb252ZXJ0XG4gICAqIEByZXR1cm5zIFRoZSBKU09OLXNhZmUgcmVwcmVzZW50YXRpb24gb2YgdGhlIG9iamVjdFxuICAgKi9cbiAgdG9Kc29uU2FmZShvYmopIHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShcbiAgICAgIEpTT04uc3RyaW5naWZ5KG9iaiwgKF8sIHZhbHVlKSA9PiB0eXBlb2YgdmFsdWUgPT09IFwiYmlnaW50XCIgPyB2YWx1ZS50b1N0cmluZygpIDogdmFsdWUpXG4gICAgKTtcbiAgfVxufTtcblxuLy8gc3JjL2h0dHAveDQwMkhUVFBDbGllbnQudHNcbnZhciB4NDAySFRUUENsaWVudCA9IGNsYXNzIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgeDQwMkhUVFBDbGllbnQgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwYXJhbSBjbGllbnQgLSBUaGUgdW5kZXJseWluZyB4NDAyQ2xpZW50IGZvciBwYXltZW50IGxvZ2ljXG4gICAqL1xuICBjb25zdHJ1Y3RvcihjbGllbnQpIHtcbiAgICB0aGlzLmNsaWVudCA9IGNsaWVudDtcbiAgfVxuICAvKipcbiAgICogRW5jb2RlcyBhIHBheW1lbnQgcGF5bG9hZCBpbnRvIGFwcHJvcHJpYXRlIEhUVFAgaGVhZGVycyBiYXNlZCBvbiB2ZXJzaW9uLlxuICAgKlxuICAgKiBAcGFyYW0gcGF5bWVudFBheWxvYWQgLSBUaGUgcGF5bWVudCBwYXlsb2FkIHRvIGVuY29kZVxuICAgKiBAcmV0dXJucyBIVFRQIGhlYWRlcnMgY29udGFpbmluZyB0aGUgZW5jb2RlZCBwYXltZW50IHNpZ25hdHVyZVxuICAgKi9cbiAgZW5jb2RlUGF5bWVudFNpZ25hdHVyZUhlYWRlcihwYXltZW50UGF5bG9hZCkge1xuICAgIHN3aXRjaCAocGF5bWVudFBheWxvYWQueDQwMlZlcnNpb24pIHtcbiAgICAgIGNhc2UgMjpcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBcIlBBWU1FTlQtU0lHTkFUVVJFXCI6IGVuY29kZVBheW1lbnRTaWduYXR1cmVIZWFkZXIocGF5bWVudFBheWxvYWQpXG4gICAgICAgIH07XG4gICAgICBjYXNlIDE6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgXCJYLVBBWU1FTlRcIjogZW5jb2RlUGF5bWVudFNpZ25hdHVyZUhlYWRlcihwYXltZW50UGF5bG9hZClcbiAgICAgICAgfTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgVW5zdXBwb3J0ZWQgeDQwMiB2ZXJzaW9uOiAke3BheW1lbnRQYXlsb2FkLng0MDJWZXJzaW9ufWBcbiAgICAgICAgKTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIEV4dHJhY3RzIHBheW1lbnQgcmVxdWlyZWQgaW5mb3JtYXRpb24gZnJvbSBIVFRQIHJlc3BvbnNlLlxuICAgKlxuICAgKiBAcGFyYW0gZ2V0SGVhZGVyIC0gRnVuY3Rpb24gdG8gcmV0cmlldmUgaGVhZGVyIHZhbHVlIGJ5IG5hbWUgKGNhc2UtaW5zZW5zaXRpdmUpXG4gICAqIEBwYXJhbSBib2R5IC0gT3B0aW9uYWwgcmVzcG9uc2UgYm9keSBmb3IgdjEgY29tcGF0aWJpbGl0eVxuICAgKiBAcmV0dXJucyBUaGUgcGF5bWVudCByZXF1aXJlZCBvYmplY3RcbiAgICovXG4gIGdldFBheW1lbnRSZXF1aXJlZFJlc3BvbnNlKGdldEhlYWRlciwgYm9keSkge1xuICAgIGNvbnN0IHBheW1lbnRSZXF1aXJlZCA9IGdldEhlYWRlcihcIlBBWU1FTlQtUkVRVUlSRURcIik7XG4gICAgaWYgKHBheW1lbnRSZXF1aXJlZCkge1xuICAgICAgcmV0dXJuIGRlY29kZVBheW1lbnRSZXF1aXJlZEhlYWRlcihwYXltZW50UmVxdWlyZWQpO1xuICAgIH1cbiAgICBpZiAoYm9keSAmJiBib2R5IGluc3RhbmNlb2YgT2JqZWN0ICYmIFwieDQwMlZlcnNpb25cIiBpbiBib2R5ICYmIGJvZHkueDQwMlZlcnNpb24gPT09IDEpIHtcbiAgICAgIHJldHVybiBib2R5O1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHBheW1lbnQgcmVxdWlyZWQgcmVzcG9uc2VcIik7XG4gIH1cbiAgLyoqXG4gICAqIEV4dHJhY3RzIHBheW1lbnQgc2V0dGxlbWVudCByZXNwb25zZSBmcm9tIEhUVFAgaGVhZGVycy5cbiAgICpcbiAgICogQHBhcmFtIGdldEhlYWRlciAtIEZ1bmN0aW9uIHRvIHJldHJpZXZlIGhlYWRlciB2YWx1ZSBieSBuYW1lIChjYXNlLWluc2Vuc2l0aXZlKVxuICAgKiBAcmV0dXJucyBUaGUgc2V0dGxlbWVudCByZXNwb25zZSBvYmplY3RcbiAgICovXG4gIGdldFBheW1lbnRTZXR0bGVSZXNwb25zZShnZXRIZWFkZXIpIHtcbiAgICBjb25zdCBwYXltZW50UmVzcG9uc2UgPSBnZXRIZWFkZXIoXCJQQVlNRU5ULVJFU1BPTlNFXCIpO1xuICAgIGlmIChwYXltZW50UmVzcG9uc2UpIHtcbiAgICAgIHJldHVybiBkZWNvZGVQYXltZW50UmVzcG9uc2VIZWFkZXIocGF5bWVudFJlc3BvbnNlKTtcbiAgICB9XG4gICAgY29uc3QgeFBheW1lbnRSZXNwb25zZSA9IGdldEhlYWRlcihcIlgtUEFZTUVOVC1SRVNQT05TRVwiKTtcbiAgICBpZiAoeFBheW1lbnRSZXNwb25zZSkge1xuICAgICAgcmV0dXJuIGRlY29kZVBheW1lbnRSZXNwb25zZUhlYWRlcih4UGF5bWVudFJlc3BvbnNlKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiUGF5bWVudCByZXNwb25zZSBoZWFkZXIgbm90IGZvdW5kXCIpO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgcGF5bWVudCBwYXlsb2FkIGZvciB0aGUgZ2l2ZW4gcGF5bWVudCByZXF1aXJlbWVudHMuXG4gICAqIERlbGVnYXRlcyB0byB0aGUgdW5kZXJseWluZyB4NDAyQ2xpZW50LlxuICAgKlxuICAgKiBAcGFyYW0gcGF5bWVudFJlcXVpcmVkIC0gVGhlIHBheW1lbnQgcmVxdWlyZWQgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyXG4gICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRoZSBwYXltZW50IHBheWxvYWRcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBheW1lbnRQYXlsb2FkKHBheW1lbnRSZXF1aXJlZCkge1xuICAgIHJldHVybiB0aGlzLmNsaWVudC5jcmVhdGVQYXltZW50UGF5bG9hZChwYXltZW50UmVxdWlyZWQpO1xuICB9XG59O1xuXG4vLyBzcmMvaHR0cC9pbmRleC50c1xuZnVuY3Rpb24gZW5jb2RlUGF5bWVudFNpZ25hdHVyZUhlYWRlcihwYXltZW50UGF5bG9hZCkge1xuICByZXR1cm4gc2FmZUJhc2U2NEVuY29kZShKU09OLnN0cmluZ2lmeShwYXltZW50UGF5bG9hZCkpO1xufVxuZnVuY3Rpb24gZGVjb2RlUGF5bWVudFNpZ25hdHVyZUhlYWRlcihwYXltZW50U2lnbmF0dXJlSGVhZGVyKSB7XG4gIGlmICghQmFzZTY0RW5jb2RlZFJlZ2V4LnRlc3QocGF5bWVudFNpZ25hdHVyZUhlYWRlcikpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHBheW1lbnQgc2lnbmF0dXJlIGhlYWRlclwiKTtcbiAgfVxuICByZXR1cm4gSlNPTi5wYXJzZShzYWZlQmFzZTY0RGVjb2RlKHBheW1lbnRTaWduYXR1cmVIZWFkZXIpKTtcbn1cbmZ1bmN0aW9uIGVuY29kZVBheW1lbnRSZXF1aXJlZEhlYWRlcihwYXltZW50UmVxdWlyZWQpIHtcbiAgcmV0dXJuIHNhZmVCYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocGF5bWVudFJlcXVpcmVkKSk7XG59XG5mdW5jdGlvbiBkZWNvZGVQYXltZW50UmVxdWlyZWRIZWFkZXIocGF5bWVudFJlcXVpcmVkSGVhZGVyKSB7XG4gIGlmICghQmFzZTY0RW5jb2RlZFJlZ2V4LnRlc3QocGF5bWVudFJlcXVpcmVkSGVhZGVyKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGF5bWVudCByZXF1aXJlZCBoZWFkZXJcIik7XG4gIH1cbiAgcmV0dXJuIEpTT04ucGFyc2Uoc2FmZUJhc2U2NERlY29kZShwYXltZW50UmVxdWlyZWRIZWFkZXIpKTtcbn1cbmZ1bmN0aW9uIGVuY29kZVBheW1lbnRSZXNwb25zZUhlYWRlcihwYXltZW50UmVzcG9uc2UpIHtcbiAgcmV0dXJuIHNhZmVCYXNlNjRFbmNvZGUoSlNPTi5zdHJpbmdpZnkocGF5bWVudFJlc3BvbnNlKSk7XG59XG5mdW5jdGlvbiBkZWNvZGVQYXltZW50UmVzcG9uc2VIZWFkZXIocGF5bWVudFJlc3BvbnNlSGVhZGVyKSB7XG4gIGlmICghQmFzZTY0RW5jb2RlZFJlZ2V4LnRlc3QocGF5bWVudFJlc3BvbnNlSGVhZGVyKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcGF5bWVudCByZXNwb25zZSBoZWFkZXJcIik7XG4gIH1cbiAgcmV0dXJuIEpTT04ucGFyc2Uoc2FmZUJhc2U2NERlY29kZShwYXltZW50UmVzcG9uc2VIZWFkZXIpKTtcbn1cblxuZXhwb3J0IHtcbiAgUm91dGVDb25maWd1cmF0aW9uRXJyb3IsXG4gIHg0MDJIVFRQUmVzb3VyY2VTZXJ2ZXIsXG4gIEhUVFBGYWNpbGl0YXRvckNsaWVudCxcbiAgZW5jb2RlUGF5bWVudFNpZ25hdHVyZUhlYWRlcixcbiAgZGVjb2RlUGF5bWVudFNpZ25hdHVyZUhlYWRlcixcbiAgZW5jb2RlUGF5bWVudFJlcXVpcmVkSGVhZGVyLFxuICBkZWNvZGVQYXltZW50UmVxdWlyZWRIZWFkZXIsXG4gIGVuY29kZVBheW1lbnRSZXNwb25zZUhlYWRlcixcbiAgZGVjb2RlUGF5bWVudFJlc3BvbnNlSGVhZGVyLFxuICB4NDAySFRUUENsaWVudFxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNodW5rLTU1WFRUTUxGLm1qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/core/dist/esm/chunk-55XTTMLF.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/core/dist/esm/chunk-BJTO5JO5.mjs":
/*!*************************************************************!*\
  !*** ./node_modules/@x402/core/dist/esm/chunk-BJTO5JO5.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   __require: () => (/* binding */ __require)\n/* harmony export */ });\nvar __require = /* @__PURE__ */ ((x) => typeof require !== \"undefined\" ? require : typeof Proxy !== \"undefined\" ? new Proxy(x, {\n  get: (a, b) => (typeof require !== \"undefined\" ? require : a)[b]\n}) : x)(function(x) {\n  if (typeof require !== \"undefined\") return require.apply(this, arguments);\n  throw Error('Dynamic require of \"' + x + '\" is not supported');\n});\n\n\n//# sourceMappingURL=chunk-BJTO5JO5.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jaHVuay1CSlRPNUpPNS5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBLENBQUM7O0FBSUM7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3RyYW5zYWN0aW9uYWxfYWdlbnQvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jaHVuay1CSlRPNUpPNS5tanM/ZTEzNSJdLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX19yZXF1aXJlID0gLyogQF9fUFVSRV9fICovICgoeCkgPT4gdHlwZW9mIHJlcXVpcmUgIT09IFwidW5kZWZpbmVkXCIgPyByZXF1aXJlIDogdHlwZW9mIFByb3h5ICE9PSBcInVuZGVmaW5lZFwiID8gbmV3IFByb3h5KHgsIHtcbiAgZ2V0OiAoYSwgYikgPT4gKHR5cGVvZiByZXF1aXJlICE9PSBcInVuZGVmaW5lZFwiID8gcmVxdWlyZSA6IGEpW2JdXG59KSA6IHgpKGZ1bmN0aW9uKHgpIHtcbiAgaWYgKHR5cGVvZiByZXF1aXJlICE9PSBcInVuZGVmaW5lZFwiKSByZXR1cm4gcmVxdWlyZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB0aHJvdyBFcnJvcignRHluYW1pYyByZXF1aXJlIG9mIFwiJyArIHggKyAnXCIgaXMgbm90IHN1cHBvcnRlZCcpO1xufSk7XG5cbmV4cG9ydCB7XG4gIF9fcmVxdWlyZVxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNodW5rLUJKVE81Sk81Lm1qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/core/dist/esm/chunk-BJTO5JO5.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/core/dist/esm/chunk-TDLQZ6MP.mjs":
/*!*************************************************************!*\
  !*** ./node_modules/@x402/core/dist/esm/chunk-TDLQZ6MP.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Base64EncodedRegex: () => (/* binding */ Base64EncodedRegex),\n/* harmony export */   deepEqual: () => (/* binding */ deepEqual),\n/* harmony export */   findByNetworkAndScheme: () => (/* binding */ findByNetworkAndScheme),\n/* harmony export */   findFacilitatorBySchemeAndNetwork: () => (/* binding */ findFacilitatorBySchemeAndNetwork),\n/* harmony export */   findSchemesByNetwork: () => (/* binding */ findSchemesByNetwork),\n/* harmony export */   safeBase64Decode: () => (/* binding */ safeBase64Decode),\n/* harmony export */   safeBase64Encode: () => (/* binding */ safeBase64Encode)\n/* harmony export */ });\n// src/utils/index.ts\nvar findSchemesByNetwork = (map, network) => {\n  let implementationsByScheme = map.get(network);\n  if (!implementationsByScheme) {\n    for (const [registeredNetworkPattern, implementations] of map.entries()) {\n      const pattern = registeredNetworkPattern.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\").replace(/\\\\\\*/g, \".*\");\n      const regex = new RegExp(`^${pattern}$`);\n      if (regex.test(network)) {\n        implementationsByScheme = implementations;\n        break;\n      }\n    }\n  }\n  return implementationsByScheme;\n};\nvar findByNetworkAndScheme = (map, scheme, network) => {\n  return findSchemesByNetwork(map, network)?.get(scheme);\n};\nvar findFacilitatorBySchemeAndNetwork = (schemeMap, scheme, network) => {\n  const schemeData = schemeMap.get(scheme);\n  if (!schemeData) return void 0;\n  if (schemeData.networks.has(network)) {\n    return schemeData.facilitator;\n  }\n  const patternRegex = new RegExp(\"^\" + schemeData.pattern.replace(\"*\", \".*\") + \"$\");\n  if (patternRegex.test(network)) {\n    return schemeData.facilitator;\n  }\n  return void 0;\n};\nvar Base64EncodedRegex = /^[A-Za-z0-9+/]*={0,2}$/;\nfunction safeBase64Encode(data) {\n  if (typeof globalThis !== \"undefined\" && typeof globalThis.btoa === \"function\") {\n    const bytes = new TextEncoder().encode(data);\n    const binaryString = Array.from(bytes, (byte) => String.fromCharCode(byte)).join(\"\");\n    return globalThis.btoa(binaryString);\n  }\n  return Buffer.from(data, \"utf8\").toString(\"base64\");\n}\nfunction safeBase64Decode(data) {\n  if (typeof globalThis !== \"undefined\" && typeof globalThis.atob === \"function\") {\n    const binaryString = globalThis.atob(data);\n    const bytes = new Uint8Array(binaryString.length);\n    for (let i = 0; i < binaryString.length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n    const decoder = new TextDecoder(\"utf-8\");\n    return decoder.decode(bytes);\n  }\n  return Buffer.from(data, \"base64\").toString(\"utf-8\");\n}\nfunction deepEqual(obj1, obj2) {\n  const normalize = (obj) => {\n    if (obj === null || obj === void 0) return JSON.stringify(obj);\n    if (typeof obj !== \"object\") return JSON.stringify(obj);\n    if (Array.isArray(obj)) {\n      return JSON.stringify(\n        obj.map(\n          (item) => typeof item === \"object\" && item !== null ? JSON.parse(normalize(item)) : item\n        )\n      );\n    }\n    const sorted = {};\n    Object.keys(obj).sort().forEach((key) => {\n      const value = obj[key];\n      sorted[key] = typeof value === \"object\" && value !== null ? JSON.parse(normalize(value)) : value;\n    });\n    return JSON.stringify(sorted);\n  };\n  try {\n    return normalize(obj1) === normalize(obj2);\n  } catch {\n    return JSON.stringify(obj1) === JSON.stringify(obj2);\n  }\n}\n\n\n//# sourceMappingURL=chunk-TDLQZ6MP.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jaHVuay1URExRWjZNUC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpRUFBaUU7QUFDakUsbUNBQW1DLFFBQVE7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxJQUFJO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQix5QkFBeUI7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQVVFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmFuc2FjdGlvbmFsX2FnZW50Ly4vbm9kZV9tb2R1bGVzL0B4NDAyL2NvcmUvZGlzdC9lc20vY2h1bmstVERMUVo2TVAubWpzPzIzN2YiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL3V0aWxzL2luZGV4LnRzXG52YXIgZmluZFNjaGVtZXNCeU5ldHdvcmsgPSAobWFwLCBuZXR3b3JrKSA9PiB7XG4gIGxldCBpbXBsZW1lbnRhdGlvbnNCeVNjaGVtZSA9IG1hcC5nZXQobmV0d29yayk7XG4gIGlmICghaW1wbGVtZW50YXRpb25zQnlTY2hlbWUpIHtcbiAgICBmb3IgKGNvbnN0IFtyZWdpc3RlcmVkTmV0d29ya1BhdHRlcm4sIGltcGxlbWVudGF0aW9uc10gb2YgbWFwLmVudHJpZXMoKSkge1xuICAgICAgY29uc3QgcGF0dGVybiA9IHJlZ2lzdGVyZWROZXR3b3JrUGF0dGVybi5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIikucmVwbGFjZSgvXFxcXFxcKi9nLCBcIi4qXCIpO1xuICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGBeJHtwYXR0ZXJufSRgKTtcbiAgICAgIGlmIChyZWdleC50ZXN0KG5ldHdvcmspKSB7XG4gICAgICAgIGltcGxlbWVudGF0aW9uc0J5U2NoZW1lID0gaW1wbGVtZW50YXRpb25zO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGltcGxlbWVudGF0aW9uc0J5U2NoZW1lO1xufTtcbnZhciBmaW5kQnlOZXR3b3JrQW5kU2NoZW1lID0gKG1hcCwgc2NoZW1lLCBuZXR3b3JrKSA9PiB7XG4gIHJldHVybiBmaW5kU2NoZW1lc0J5TmV0d29yayhtYXAsIG5ldHdvcmspPy5nZXQoc2NoZW1lKTtcbn07XG52YXIgZmluZEZhY2lsaXRhdG9yQnlTY2hlbWVBbmROZXR3b3JrID0gKHNjaGVtZU1hcCwgc2NoZW1lLCBuZXR3b3JrKSA9PiB7XG4gIGNvbnN0IHNjaGVtZURhdGEgPSBzY2hlbWVNYXAuZ2V0KHNjaGVtZSk7XG4gIGlmICghc2NoZW1lRGF0YSkgcmV0dXJuIHZvaWQgMDtcbiAgaWYgKHNjaGVtZURhdGEubmV0d29ya3MuaGFzKG5ldHdvcmspKSB7XG4gICAgcmV0dXJuIHNjaGVtZURhdGEuZmFjaWxpdGF0b3I7XG4gIH1cbiAgY29uc3QgcGF0dGVyblJlZ2V4ID0gbmV3IFJlZ0V4cChcIl5cIiArIHNjaGVtZURhdGEucGF0dGVybi5yZXBsYWNlKFwiKlwiLCBcIi4qXCIpICsgXCIkXCIpO1xuICBpZiAocGF0dGVyblJlZ2V4LnRlc3QobmV0d29yaykpIHtcbiAgICByZXR1cm4gc2NoZW1lRGF0YS5mYWNpbGl0YXRvcjtcbiAgfVxuICByZXR1cm4gdm9pZCAwO1xufTtcbnZhciBCYXNlNjRFbmNvZGVkUmVnZXggPSAvXltBLVphLXowLTkrL10qPXswLDJ9JC87XG5mdW5jdGlvbiBzYWZlQmFzZTY0RW5jb2RlKGRhdGEpIHtcbiAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBnbG9iYWxUaGlzLmJ0b2EgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGNvbnN0IGJ5dGVzID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKGRhdGEpO1xuICAgIGNvbnN0IGJpbmFyeVN0cmluZyA9IEFycmF5LmZyb20oYnl0ZXMsIChieXRlKSA9PiBTdHJpbmcuZnJvbUNoYXJDb2RlKGJ5dGUpKS5qb2luKFwiXCIpO1xuICAgIHJldHVybiBnbG9iYWxUaGlzLmJ0b2EoYmluYXJ5U3RyaW5nKTtcbiAgfVxuICByZXR1cm4gQnVmZmVyLmZyb20oZGF0YSwgXCJ1dGY4XCIpLnRvU3RyaW5nKFwiYmFzZTY0XCIpO1xufVxuZnVuY3Rpb24gc2FmZUJhc2U2NERlY29kZShkYXRhKSB7XG4gIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gXCJ1bmRlZmluZWRcIiAmJiB0eXBlb2YgZ2xvYmFsVGhpcy5hdG9iID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBjb25zdCBiaW5hcnlTdHJpbmcgPSBnbG9iYWxUaGlzLmF0b2IoZGF0YSk7XG4gICAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShiaW5hcnlTdHJpbmcubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJpbmFyeVN0cmluZy5sZW5ndGg7IGkrKykge1xuICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlTdHJpbmcuY2hhckNvZGVBdChpKTtcbiAgICB9XG4gICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcihcInV0Zi04XCIpO1xuICAgIHJldHVybiBkZWNvZGVyLmRlY29kZShieXRlcyk7XG4gIH1cbiAgcmV0dXJuIEJ1ZmZlci5mcm9tKGRhdGEsIFwiYmFzZTY0XCIpLnRvU3RyaW5nKFwidXRmLThcIik7XG59XG5mdW5jdGlvbiBkZWVwRXF1YWwob2JqMSwgb2JqMikge1xuICBjb25zdCBub3JtYWxpemUgPSAob2JqKSA9PiB7XG4gICAgaWYgKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHZvaWQgMCkgcmV0dXJuIEpTT04uc3RyaW5naWZ5KG9iaik7XG4gICAgaWYgKHR5cGVvZiBvYmogIT09IFwib2JqZWN0XCIpIHJldHVybiBKU09OLnN0cmluZ2lmeShvYmopO1xuICAgIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHtcbiAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShcbiAgICAgICAgb2JqLm1hcChcbiAgICAgICAgICAoaXRlbSkgPT4gdHlwZW9mIGl0ZW0gPT09IFwib2JqZWN0XCIgJiYgaXRlbSAhPT0gbnVsbCA/IEpTT04ucGFyc2Uobm9ybWFsaXplKGl0ZW0pKSA6IGl0ZW1cbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3Qgc29ydGVkID0ge307XG4gICAgT2JqZWN0LmtleXMob2JqKS5zb3J0KCkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBjb25zdCB2YWx1ZSA9IG9ialtrZXldO1xuICAgICAgc29ydGVkW2tleV0gPSB0eXBlb2YgdmFsdWUgPT09IFwib2JqZWN0XCIgJiYgdmFsdWUgIT09IG51bGwgPyBKU09OLnBhcnNlKG5vcm1hbGl6ZSh2YWx1ZSkpIDogdmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHNvcnRlZCk7XG4gIH07XG4gIHRyeSB7XG4gICAgcmV0dXJuIG5vcm1hbGl6ZShvYmoxKSA9PT0gbm9ybWFsaXplKG9iajIpO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkob2JqMSkgPT09IEpTT04uc3RyaW5naWZ5KG9iajIpO1xuICB9XG59XG5cbmV4cG9ydCB7XG4gIGZpbmRTY2hlbWVzQnlOZXR3b3JrLFxuICBmaW5kQnlOZXR3b3JrQW5kU2NoZW1lLFxuICBmaW5kRmFjaWxpdGF0b3JCeVNjaGVtZUFuZE5ldHdvcmssXG4gIEJhc2U2NEVuY29kZWRSZWdleCxcbiAgc2FmZUJhc2U2NEVuY29kZSxcbiAgc2FmZUJhc2U2NERlY29kZSxcbiAgZGVlcEVxdWFsXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2h1bmstVERMUVo2TVAubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/core/dist/esm/chunk-TDLQZ6MP.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/core/dist/esm/chunk-VE37GDG2.mjs":
/*!*************************************************************!*\
  !*** ./node_modules/@x402/core/dist/esm/chunk-VE37GDG2.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   x402Version: () => (/* binding */ x402Version)\n/* harmony export */ });\n// src/index.ts\nvar x402Version = 2;\n\n\n//# sourceMappingURL=chunk-VE37GDG2.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jaHVuay1WRTM3R0RHMi5tanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7O0FBSUU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3RyYW5zYWN0aW9uYWxfYWdlbnQvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jaHVuay1WRTM3R0RHMi5tanM/Nzc4ZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvaW5kZXgudHNcbnZhciB4NDAyVmVyc2lvbiA9IDI7XG5cbmV4cG9ydCB7XG4gIHg0MDJWZXJzaW9uXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2h1bmstVkUzN0dERzIubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/core/dist/esm/chunk-VE37GDG2.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/core/dist/esm/chunk-X4W4S5RB.mjs":
/*!*************************************************************!*\
  !*** ./node_modules/@x402/core/dist/esm/chunk-X4W4S5RB.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SettleError: () => (/* binding */ SettleError),\n/* harmony export */   VerifyError: () => (/* binding */ VerifyError)\n/* harmony export */ });\n// src/types/facilitator.ts\nvar VerifyError = class extends Error {\n  /**\n   * Creates a VerifyError from a failed verification response.\n   *\n   * @param statusCode - HTTP status code from the facilitator\n   * @param response - The verify response containing error details\n   */\n  constructor(statusCode, response) {\n    super(`verification failed: ${response.invalidReason || \"unknown reason\"}`);\n    this.name = \"VerifyError\";\n    this.statusCode = statusCode;\n    this.invalidReason = response.invalidReason;\n    this.payer = response.payer;\n  }\n};\nvar SettleError = class extends Error {\n  /**\n   * Creates a SettleError from a failed settlement response.\n   *\n   * @param statusCode - HTTP status code from the facilitator\n   * @param response - The settle response containing error details\n   */\n  constructor(statusCode, response) {\n    super(`settlement failed: ${response.errorReason || \"unknown reason\"}`);\n    this.name = \"SettleError\";\n    this.statusCode = statusCode;\n    this.errorReason = response.errorReason;\n    this.payer = response.payer;\n    this.transaction = response.transaction;\n    this.network = response.network;\n  }\n};\n\n\n//# sourceMappingURL=chunk-X4W4S5RB.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jaHVuay1YNFc0UzVSQi5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsMkNBQTJDO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MseUNBQXlDO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBS0U7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3RyYW5zYWN0aW9uYWxfYWdlbnQvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jaHVuay1YNFc0UzVSQi5tanM/ZDJkMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvdHlwZXMvZmFjaWxpdGF0b3IudHNcbnZhciBWZXJpZnlFcnJvciA9IGNsYXNzIGV4dGVuZHMgRXJyb3Ige1xuICAvKipcbiAgICogQ3JlYXRlcyBhIFZlcmlmeUVycm9yIGZyb20gYSBmYWlsZWQgdmVyaWZpY2F0aW9uIHJlc3BvbnNlLlxuICAgKlxuICAgKiBAcGFyYW0gc3RhdHVzQ29kZSAtIEhUVFAgc3RhdHVzIGNvZGUgZnJvbSB0aGUgZmFjaWxpdGF0b3JcbiAgICogQHBhcmFtIHJlc3BvbnNlIC0gVGhlIHZlcmlmeSByZXNwb25zZSBjb250YWluaW5nIGVycm9yIGRldGFpbHNcbiAgICovXG4gIGNvbnN0cnVjdG9yKHN0YXR1c0NvZGUsIHJlc3BvbnNlKSB7XG4gICAgc3VwZXIoYHZlcmlmaWNhdGlvbiBmYWlsZWQ6ICR7cmVzcG9uc2UuaW52YWxpZFJlYXNvbiB8fCBcInVua25vd24gcmVhc29uXCJ9YCk7XG4gICAgdGhpcy5uYW1lID0gXCJWZXJpZnlFcnJvclwiO1xuICAgIHRoaXMuc3RhdHVzQ29kZSA9IHN0YXR1c0NvZGU7XG4gICAgdGhpcy5pbnZhbGlkUmVhc29uID0gcmVzcG9uc2UuaW52YWxpZFJlYXNvbjtcbiAgICB0aGlzLnBheWVyID0gcmVzcG9uc2UucGF5ZXI7XG4gIH1cbn07XG52YXIgU2V0dGxlRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBTZXR0bGVFcnJvciBmcm9tIGEgZmFpbGVkIHNldHRsZW1lbnQgcmVzcG9uc2UuXG4gICAqXG4gICAqIEBwYXJhbSBzdGF0dXNDb2RlIC0gSFRUUCBzdGF0dXMgY29kZSBmcm9tIHRoZSBmYWNpbGl0YXRvclxuICAgKiBAcGFyYW0gcmVzcG9uc2UgLSBUaGUgc2V0dGxlIHJlc3BvbnNlIGNvbnRhaW5pbmcgZXJyb3IgZGV0YWlsc1xuICAgKi9cbiAgY29uc3RydWN0b3Ioc3RhdHVzQ29kZSwgcmVzcG9uc2UpIHtcbiAgICBzdXBlcihgc2V0dGxlbWVudCBmYWlsZWQ6ICR7cmVzcG9uc2UuZXJyb3JSZWFzb24gfHwgXCJ1bmtub3duIHJlYXNvblwifWApO1xuICAgIHRoaXMubmFtZSA9IFwiU2V0dGxlRXJyb3JcIjtcbiAgICB0aGlzLnN0YXR1c0NvZGUgPSBzdGF0dXNDb2RlO1xuICAgIHRoaXMuZXJyb3JSZWFzb24gPSByZXNwb25zZS5lcnJvclJlYXNvbjtcbiAgICB0aGlzLnBheWVyID0gcmVzcG9uc2UucGF5ZXI7XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IHJlc3BvbnNlLnRyYW5zYWN0aW9uO1xuICAgIHRoaXMubmV0d29yayA9IHJlc3BvbnNlLm5ldHdvcms7XG4gIH1cbn07XG5cbmV4cG9ydCB7XG4gIFZlcmlmeUVycm9yLFxuICBTZXR0bGVFcnJvclxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNodW5rLVg0VzRTNVJCLm1qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/core/dist/esm/chunk-X4W4S5RB.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/core/dist/esm/client/index.mjs":
/*!***********************************************************!*\
  !*** ./node_modules/@x402/core/dist/esm/client/index.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   x402Client: () => (/* binding */ x402Client),\n/* harmony export */   x402HTTPClient: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.x402HTTPClient)\n/* harmony export */ });\n/* harmony import */ var _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../chunk-55XTTMLF.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-55XTTMLF.mjs\");\n/* harmony import */ var _chunk_VE37GDG2_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../chunk-VE37GDG2.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-VE37GDG2.mjs\");\n/* harmony import */ var _chunk_X4W4S5RB_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../chunk-X4W4S5RB.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-X4W4S5RB.mjs\");\n/* harmony import */ var _chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../chunk-TDLQZ6MP.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-TDLQZ6MP.mjs\");\n/* harmony import */ var _chunk_BJTO5JO5_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../chunk-BJTO5JO5.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-BJTO5JO5.mjs\");\n\n\n\n\n\n\n// src/client/x402Client.ts\nvar x402Client = class _x402Client {\n  /**\n   * Creates a new x402Client instance.\n   *\n   * @param paymentRequirementsSelector - Function to select payment requirements from available options\n   */\n  constructor(paymentRequirementsSelector) {\n    this.registeredClientSchemes = /* @__PURE__ */ new Map();\n    this.policies = [];\n    this.beforePaymentCreationHooks = [];\n    this.afterPaymentCreationHooks = [];\n    this.onPaymentCreationFailureHooks = [];\n    this.paymentRequirementsSelector = paymentRequirementsSelector || ((x402Version2, accepts) => accepts[0]);\n  }\n  /**\n   * Creates a new x402Client instance from a configuration object.\n   *\n   * @param config - The client configuration including schemes, policies, and payment requirements selector\n   * @returns A configured x402Client instance\n   */\n  static fromConfig(config) {\n    const client = new _x402Client(config.paymentRequirementsSelector);\n    config.schemes.forEach((scheme) => {\n      if (scheme.x402Version === 1) {\n        client.registerV1(scheme.network, scheme.client);\n      } else {\n        client.register(scheme.network, scheme.client);\n      }\n    });\n    config.policies?.forEach((policy) => {\n      client.registerPolicy(policy);\n    });\n    return client;\n  }\n  /**\n   * Registers a scheme client for the current x402 version.\n   *\n   * @param network - The network to register the client for\n   * @param client - The scheme network client to register\n   * @returns The x402Client instance for chaining\n   */\n  register(network, client) {\n    return this._registerScheme(_chunk_VE37GDG2_mjs__WEBPACK_IMPORTED_MODULE_1__.x402Version, network, client);\n  }\n  /**\n   * Registers a scheme client for x402 version 1.\n   *\n   * @param network - The v1 network identifier (e.g., 'base-sepolia', 'solana-devnet')\n   * @param client - The scheme network client to register\n   * @returns The x402Client instance for chaining\n   */\n  registerV1(network, client) {\n    return this._registerScheme(1, network, client);\n  }\n  /**\n   * Registers a policy to filter or transform payment requirements.\n   *\n   * Policies are applied in order after filtering by registered schemes\n   * and before the selector chooses the final payment requirement.\n   *\n   * @param policy - Function to filter/transform payment requirements\n   * @returns The x402Client instance for chaining\n   *\n   * @example\n   * ```typescript\n   * // Prefer cheaper options\n   * client.registerPolicy((version, reqs) =>\n   *   reqs.filter(r => BigInt(r.value) < BigInt('1000000'))\n   * );\n   *\n   * // Prefer specific networks\n   * client.registerPolicy((version, reqs) =>\n   *   reqs.filter(r => r.network.startsWith('eip155:'))\n   * );\n   * ```\n   */\n  registerPolicy(policy) {\n    this.policies.push(policy);\n    return this;\n  }\n  /**\n   * Register a hook to execute before payment payload creation.\n   * Can abort creation by returning { abort: true, reason: string }\n   *\n   * @param hook - The hook function to register\n   * @returns The x402Client instance for chaining\n   */\n  onBeforePaymentCreation(hook) {\n    this.beforePaymentCreationHooks.push(hook);\n    return this;\n  }\n  /**\n   * Register a hook to execute after successful payment payload creation.\n   *\n   * @param hook - The hook function to register\n   * @returns The x402Client instance for chaining\n   */\n  onAfterPaymentCreation(hook) {\n    this.afterPaymentCreationHooks.push(hook);\n    return this;\n  }\n  /**\n   * Register a hook to execute when payment payload creation fails.\n   * Can recover from failure by returning { recovered: true, payload: PaymentPayload }\n   *\n   * @param hook - The hook function to register\n   * @returns The x402Client instance for chaining\n   */\n  onPaymentCreationFailure(hook) {\n    this.onPaymentCreationFailureHooks.push(hook);\n    return this;\n  }\n  /**\n   * Creates a payment payload based on a PaymentRequired response.\n   *\n   * Automatically extracts x402Version, resource, and extensions from the PaymentRequired\n   * response and constructs a complete PaymentPayload with the accepted requirements.\n   *\n   * @param paymentRequired - The PaymentRequired response from the server\n   * @returns Promise resolving to the complete payment payload\n   */\n  async createPaymentPayload(paymentRequired) {\n    const clientSchemesByNetwork = this.registeredClientSchemes.get(paymentRequired.x402Version);\n    if (!clientSchemesByNetwork) {\n      throw new Error(`No client registered for x402 version: ${paymentRequired.x402Version}`);\n    }\n    const requirements = this.selectPaymentRequirements(paymentRequired.x402Version, paymentRequired.accepts);\n    const context = {\n      paymentRequired,\n      selectedRequirements: requirements\n    };\n    for (const hook of this.beforePaymentCreationHooks) {\n      const result = await hook(context);\n      if (result && \"abort\" in result && result.abort) {\n        throw new Error(`Payment creation aborted: ${result.reason}`);\n      }\n    }\n    try {\n      const schemeNetworkClient = (0,_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_3__.findByNetworkAndScheme)(clientSchemesByNetwork, requirements.scheme, requirements.network);\n      if (!schemeNetworkClient) {\n        throw new Error(`No client registered for scheme: ${requirements.scheme} and network: ${requirements.network}`);\n      }\n      const partialPayload = await schemeNetworkClient.createPaymentPayload(paymentRequired.x402Version, requirements);\n      let paymentPayload;\n      if (partialPayload.x402Version == 1) {\n        paymentPayload = partialPayload;\n      } else {\n        paymentPayload = {\n          ...partialPayload,\n          extensions: paymentRequired.extensions,\n          resource: paymentRequired.resource,\n          accepted: requirements\n        };\n      }\n      const createdContext = {\n        ...context,\n        paymentPayload\n      };\n      for (const hook of this.afterPaymentCreationHooks) {\n        await hook(createdContext);\n      }\n      return paymentPayload;\n    } catch (error) {\n      const failureContext = {\n        ...context,\n        error\n      };\n      for (const hook of this.onPaymentCreationFailureHooks) {\n        const result = await hook(failureContext);\n        if (result && \"recovered\" in result && result.recovered) {\n          return result.payload;\n        }\n      }\n      throw error;\n    }\n  }\n  /**\n   * Selects appropriate payment requirements based on registered clients and policies.\n   *\n   * Selection process:\n   * 1. Filter by registered schemes (network + scheme support)\n   * 2. Apply all registered policies in order\n   * 3. Use selector to choose final requirement\n   *\n   * @param x402Version - The x402 protocol version\n   * @param paymentRequirements - Array of available payment requirements\n   * @returns The selected payment requirements\n   */\n  selectPaymentRequirements(x402Version2, paymentRequirements) {\n    const clientSchemesByNetwork = this.registeredClientSchemes.get(x402Version2);\n    if (!clientSchemesByNetwork) {\n      throw new Error(`No client registered for x402 version: ${x402Version2}`);\n    }\n    const supportedPaymentRequirements = paymentRequirements.filter((requirement) => {\n      let clientSchemes = (0,_chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_3__.findSchemesByNetwork)(clientSchemesByNetwork, requirement.network);\n      if (!clientSchemes) {\n        return false;\n      }\n      return clientSchemes.has(requirement.scheme);\n    });\n    if (supportedPaymentRequirements.length === 0) {\n      throw new Error(`No network/scheme registered for x402 version: ${x402Version2} which comply with the payment requirements. ${JSON.stringify({\n        x402Version: x402Version2,\n        paymentRequirements,\n        x402Versions: Array.from(this.registeredClientSchemes.keys()),\n        networks: Array.from(clientSchemesByNetwork.keys()),\n        schemes: Array.from(clientSchemesByNetwork.values()).map((schemes) => Array.from(schemes.keys())).flat()\n      })}`);\n    }\n    let filteredRequirements = supportedPaymentRequirements;\n    for (const policy of this.policies) {\n      filteredRequirements = policy(x402Version2, filteredRequirements);\n      if (filteredRequirements.length === 0) {\n        throw new Error(`All payment requirements were filtered out by policies for x402 version: ${x402Version2}`);\n      }\n    }\n    return this.paymentRequirementsSelector(x402Version2, filteredRequirements);\n  }\n  /**\n   * Internal method to register a scheme client.\n   *\n   * @param x402Version - The x402 protocol version\n   * @param network - The network to register the client for\n   * @param client - The scheme network client to register\n   * @returns The x402Client instance for chaining\n   */\n  _registerScheme(x402Version2, network, client) {\n    if (!this.registeredClientSchemes.has(x402Version2)) {\n      this.registeredClientSchemes.set(x402Version2, /* @__PURE__ */ new Map());\n    }\n    const clientSchemesByNetwork = this.registeredClientSchemes.get(x402Version2);\n    if (!clientSchemesByNetwork.has(network)) {\n      clientSchemesByNetwork.set(network, /* @__PURE__ */ new Map());\n    }\n    const clientByScheme = clientSchemesByNetwork.get(network);\n    if (!clientByScheme.has(client.scheme)) {\n      clientByScheme.set(client.scheme, client);\n    }\n    return this;\n  }\n};\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9jbGllbnQvaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFFK0I7QUFHQTtBQUNBO0FBSUE7QUFDQTs7QUFFL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0MsNERBQVc7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdFQUFnRSw0QkFBNEI7QUFDNUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscURBQXFELGNBQWM7QUFDbkU7QUFDQTtBQUNBO0FBQ0Esa0NBQWtDLDJFQUFzQjtBQUN4RDtBQUNBLDREQUE0RCxxQkFBcUIsZUFBZSxxQkFBcUI7QUFDckg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0UsYUFBYTtBQUM3RTtBQUNBO0FBQ0EsMEJBQTBCLHlFQUFvQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLHdFQUF3RSxjQUFjLDhDQUE4QztBQUNwSTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxFQUFFO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9HQUFvRyxhQUFhO0FBQ2pIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmFuc2FjdGlvbmFsX2FnZW50Ly4vbm9kZV9tb2R1bGVzL0B4NDAyL2NvcmUvZGlzdC9lc20vY2xpZW50L2luZGV4Lm1qcz8zZGVhIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIHg0MDJIVFRQQ2xpZW50XG59IGZyb20gXCIuLi9jaHVuay01NVhUVE1MRi5tanNcIjtcbmltcG9ydCB7XG4gIHg0MDJWZXJzaW9uXG59IGZyb20gXCIuLi9jaHVuay1WRTM3R0RHMi5tanNcIjtcbmltcG9ydCBcIi4uL2NodW5rLVg0VzRTNVJCLm1qc1wiO1xuaW1wb3J0IHtcbiAgZmluZEJ5TmV0d29ya0FuZFNjaGVtZSxcbiAgZmluZFNjaGVtZXNCeU5ldHdvcmtcbn0gZnJvbSBcIi4uL2NodW5rLVRETFFaNk1QLm1qc1wiO1xuaW1wb3J0IFwiLi4vY2h1bmstQkpUTzVKTzUubWpzXCI7XG5cbi8vIHNyYy9jbGllbnQveDQwMkNsaWVudC50c1xudmFyIHg0MDJDbGllbnQgPSBjbGFzcyBfeDQwMkNsaWVudCB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHg0MDJDbGllbnQgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwYXJhbSBwYXltZW50UmVxdWlyZW1lbnRzU2VsZWN0b3IgLSBGdW5jdGlvbiB0byBzZWxlY3QgcGF5bWVudCByZXF1aXJlbWVudHMgZnJvbSBhdmFpbGFibGUgb3B0aW9uc1xuICAgKi9cbiAgY29uc3RydWN0b3IocGF5bWVudFJlcXVpcmVtZW50c1NlbGVjdG9yKSB7XG4gICAgdGhpcy5yZWdpc3RlcmVkQ2xpZW50U2NoZW1lcyA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7XG4gICAgdGhpcy5wb2xpY2llcyA9IFtdO1xuICAgIHRoaXMuYmVmb3JlUGF5bWVudENyZWF0aW9uSG9va3MgPSBbXTtcbiAgICB0aGlzLmFmdGVyUGF5bWVudENyZWF0aW9uSG9va3MgPSBbXTtcbiAgICB0aGlzLm9uUGF5bWVudENyZWF0aW9uRmFpbHVyZUhvb2tzID0gW107XG4gICAgdGhpcy5wYXltZW50UmVxdWlyZW1lbnRzU2VsZWN0b3IgPSBwYXltZW50UmVxdWlyZW1lbnRzU2VsZWN0b3IgfHwgKCh4NDAyVmVyc2lvbjIsIGFjY2VwdHMpID0+IGFjY2VwdHNbMF0pO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHg0MDJDbGllbnQgaW5zdGFuY2UgZnJvbSBhIGNvbmZpZ3VyYXRpb24gb2JqZWN0LlxuICAgKlxuICAgKiBAcGFyYW0gY29uZmlnIC0gVGhlIGNsaWVudCBjb25maWd1cmF0aW9uIGluY2x1ZGluZyBzY2hlbWVzLCBwb2xpY2llcywgYW5kIHBheW1lbnQgcmVxdWlyZW1lbnRzIHNlbGVjdG9yXG4gICAqIEByZXR1cm5zIEEgY29uZmlndXJlZCB4NDAyQ2xpZW50IGluc3RhbmNlXG4gICAqL1xuICBzdGF0aWMgZnJvbUNvbmZpZyhjb25maWcpIHtcbiAgICBjb25zdCBjbGllbnQgPSBuZXcgX3g0MDJDbGllbnQoY29uZmlnLnBheW1lbnRSZXF1aXJlbWVudHNTZWxlY3Rvcik7XG4gICAgY29uZmlnLnNjaGVtZXMuZm9yRWFjaCgoc2NoZW1lKSA9PiB7XG4gICAgICBpZiAoc2NoZW1lLng0MDJWZXJzaW9uID09PSAxKSB7XG4gICAgICAgIGNsaWVudC5yZWdpc3RlclYxKHNjaGVtZS5uZXR3b3JrLCBzY2hlbWUuY2xpZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNsaWVudC5yZWdpc3RlcihzY2hlbWUubmV0d29yaywgc2NoZW1lLmNsaWVudCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgY29uZmlnLnBvbGljaWVzPy5mb3JFYWNoKChwb2xpY3kpID0+IHtcbiAgICAgIGNsaWVudC5yZWdpc3RlclBvbGljeShwb2xpY3kpO1xuICAgIH0pO1xuICAgIHJldHVybiBjbGllbnQ7XG4gIH1cbiAgLyoqXG4gICAqIFJlZ2lzdGVycyBhIHNjaGVtZSBjbGllbnQgZm9yIHRoZSBjdXJyZW50IHg0MDIgdmVyc2lvbi5cbiAgICpcbiAgICogQHBhcmFtIG5ldHdvcmsgLSBUaGUgbmV0d29yayB0byByZWdpc3RlciB0aGUgY2xpZW50IGZvclxuICAgKiBAcGFyYW0gY2xpZW50IC0gVGhlIHNjaGVtZSBuZXR3b3JrIGNsaWVudCB0byByZWdpc3RlclxuICAgKiBAcmV0dXJucyBUaGUgeDQwMkNsaWVudCBpbnN0YW5jZSBmb3IgY2hhaW5pbmdcbiAgICovXG4gIHJlZ2lzdGVyKG5ldHdvcmssIGNsaWVudCkge1xuICAgIHJldHVybiB0aGlzLl9yZWdpc3RlclNjaGVtZSh4NDAyVmVyc2lvbiwgbmV0d29yaywgY2xpZW50KTtcbiAgfVxuICAvKipcbiAgICogUmVnaXN0ZXJzIGEgc2NoZW1lIGNsaWVudCBmb3IgeDQwMiB2ZXJzaW9uIDEuXG4gICAqXG4gICAqIEBwYXJhbSBuZXR3b3JrIC0gVGhlIHYxIG5ldHdvcmsgaWRlbnRpZmllciAoZS5nLiwgJ2Jhc2Utc2Vwb2xpYScsICdzb2xhbmEtZGV2bmV0JylcbiAgICogQHBhcmFtIGNsaWVudCAtIFRoZSBzY2hlbWUgbmV0d29yayBjbGllbnQgdG8gcmVnaXN0ZXJcbiAgICogQHJldHVybnMgVGhlIHg0MDJDbGllbnQgaW5zdGFuY2UgZm9yIGNoYWluaW5nXG4gICAqL1xuICByZWdpc3RlclYxKG5ldHdvcmssIGNsaWVudCkge1xuICAgIHJldHVybiB0aGlzLl9yZWdpc3RlclNjaGVtZSgxLCBuZXR3b3JrLCBjbGllbnQpO1xuICB9XG4gIC8qKlxuICAgKiBSZWdpc3RlcnMgYSBwb2xpY3kgdG8gZmlsdGVyIG9yIHRyYW5zZm9ybSBwYXltZW50IHJlcXVpcmVtZW50cy5cbiAgICpcbiAgICogUG9saWNpZXMgYXJlIGFwcGxpZWQgaW4gb3JkZXIgYWZ0ZXIgZmlsdGVyaW5nIGJ5IHJlZ2lzdGVyZWQgc2NoZW1lc1xuICAgKiBhbmQgYmVmb3JlIHRoZSBzZWxlY3RvciBjaG9vc2VzIHRoZSBmaW5hbCBwYXltZW50IHJlcXVpcmVtZW50LlxuICAgKlxuICAgKiBAcGFyYW0gcG9saWN5IC0gRnVuY3Rpb24gdG8gZmlsdGVyL3RyYW5zZm9ybSBwYXltZW50IHJlcXVpcmVtZW50c1xuICAgKiBAcmV0dXJucyBUaGUgeDQwMkNsaWVudCBpbnN0YW5jZSBmb3IgY2hhaW5pbmdcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiAvLyBQcmVmZXIgY2hlYXBlciBvcHRpb25zXG4gICAqIGNsaWVudC5yZWdpc3RlclBvbGljeSgodmVyc2lvbiwgcmVxcykgPT5cbiAgICogICByZXFzLmZpbHRlcihyID0+IEJpZ0ludChyLnZhbHVlKSA8IEJpZ0ludCgnMTAwMDAwMCcpKVxuICAgKiApO1xuICAgKlxuICAgKiAvLyBQcmVmZXIgc3BlY2lmaWMgbmV0d29ya3NcbiAgICogY2xpZW50LnJlZ2lzdGVyUG9saWN5KCh2ZXJzaW9uLCByZXFzKSA9PlxuICAgKiAgIHJlcXMuZmlsdGVyKHIgPT4gci5uZXR3b3JrLnN0YXJ0c1dpdGgoJ2VpcDE1NTonKSlcbiAgICogKTtcbiAgICogYGBgXG4gICAqL1xuICByZWdpc3RlclBvbGljeShwb2xpY3kpIHtcbiAgICB0aGlzLnBvbGljaWVzLnB1c2gocG9saWN5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBob29rIHRvIGV4ZWN1dGUgYmVmb3JlIHBheW1lbnQgcGF5bG9hZCBjcmVhdGlvbi5cbiAgICogQ2FuIGFib3J0IGNyZWF0aW9uIGJ5IHJldHVybmluZyB7IGFib3J0OiB0cnVlLCByZWFzb246IHN0cmluZyB9XG4gICAqXG4gICAqIEBwYXJhbSBob29rIC0gVGhlIGhvb2sgZnVuY3Rpb24gdG8gcmVnaXN0ZXJcbiAgICogQHJldHVybnMgVGhlIHg0MDJDbGllbnQgaW5zdGFuY2UgZm9yIGNoYWluaW5nXG4gICAqL1xuICBvbkJlZm9yZVBheW1lbnRDcmVhdGlvbihob29rKSB7XG4gICAgdGhpcy5iZWZvcmVQYXltZW50Q3JlYXRpb25Ib29rcy5wdXNoKGhvb2spO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGhvb2sgdG8gZXhlY3V0ZSBhZnRlciBzdWNjZXNzZnVsIHBheW1lbnQgcGF5bG9hZCBjcmVhdGlvbi5cbiAgICpcbiAgICogQHBhcmFtIGhvb2sgLSBUaGUgaG9vayBmdW5jdGlvbiB0byByZWdpc3RlclxuICAgKiBAcmV0dXJucyBUaGUgeDQwMkNsaWVudCBpbnN0YW5jZSBmb3IgY2hhaW5pbmdcbiAgICovXG4gIG9uQWZ0ZXJQYXltZW50Q3JlYXRpb24oaG9vaykge1xuICAgIHRoaXMuYWZ0ZXJQYXltZW50Q3JlYXRpb25Ib29rcy5wdXNoKGhvb2spO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGhvb2sgdG8gZXhlY3V0ZSB3aGVuIHBheW1lbnQgcGF5bG9hZCBjcmVhdGlvbiBmYWlscy5cbiAgICogQ2FuIHJlY292ZXIgZnJvbSBmYWlsdXJlIGJ5IHJldHVybmluZyB7IHJlY292ZXJlZDogdHJ1ZSwgcGF5bG9hZDogUGF5bWVudFBheWxvYWQgfVxuICAgKlxuICAgKiBAcGFyYW0gaG9vayAtIFRoZSBob29rIGZ1bmN0aW9uIHRvIHJlZ2lzdGVyXG4gICAqIEByZXR1cm5zIFRoZSB4NDAyQ2xpZW50IGluc3RhbmNlIGZvciBjaGFpbmluZ1xuICAgKi9cbiAgb25QYXltZW50Q3JlYXRpb25GYWlsdXJlKGhvb2spIHtcbiAgICB0aGlzLm9uUGF5bWVudENyZWF0aW9uRmFpbHVyZUhvb2tzLnB1c2goaG9vayk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBwYXltZW50IHBheWxvYWQgYmFzZWQgb24gYSBQYXltZW50UmVxdWlyZWQgcmVzcG9uc2UuXG4gICAqXG4gICAqIEF1dG9tYXRpY2FsbHkgZXh0cmFjdHMgeDQwMlZlcnNpb24sIHJlc291cmNlLCBhbmQgZXh0ZW5zaW9ucyBmcm9tIHRoZSBQYXltZW50UmVxdWlyZWRcbiAgICogcmVzcG9uc2UgYW5kIGNvbnN0cnVjdHMgYSBjb21wbGV0ZSBQYXltZW50UGF5bG9hZCB3aXRoIHRoZSBhY2NlcHRlZCByZXF1aXJlbWVudHMuXG4gICAqXG4gICAqIEBwYXJhbSBwYXltZW50UmVxdWlyZWQgLSBUaGUgUGF5bWVudFJlcXVpcmVkIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlclxuICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byB0aGUgY29tcGxldGUgcGF5bWVudCBwYXlsb2FkXG4gICAqL1xuICBhc3luYyBjcmVhdGVQYXltZW50UGF5bG9hZChwYXltZW50UmVxdWlyZWQpIHtcbiAgICBjb25zdCBjbGllbnRTY2hlbWVzQnlOZXR3b3JrID0gdGhpcy5yZWdpc3RlcmVkQ2xpZW50U2NoZW1lcy5nZXQocGF5bWVudFJlcXVpcmVkLng0MDJWZXJzaW9uKTtcbiAgICBpZiAoIWNsaWVudFNjaGVtZXNCeU5ldHdvcmspIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gY2xpZW50IHJlZ2lzdGVyZWQgZm9yIHg0MDIgdmVyc2lvbjogJHtwYXltZW50UmVxdWlyZWQueDQwMlZlcnNpb259YCk7XG4gICAgfVxuICAgIGNvbnN0IHJlcXVpcmVtZW50cyA9IHRoaXMuc2VsZWN0UGF5bWVudFJlcXVpcmVtZW50cyhwYXltZW50UmVxdWlyZWQueDQwMlZlcnNpb24sIHBheW1lbnRSZXF1aXJlZC5hY2NlcHRzKTtcbiAgICBjb25zdCBjb250ZXh0ID0ge1xuICAgICAgcGF5bWVudFJlcXVpcmVkLFxuICAgICAgc2VsZWN0ZWRSZXF1aXJlbWVudHM6IHJlcXVpcmVtZW50c1xuICAgIH07XG4gICAgZm9yIChjb25zdCBob29rIG9mIHRoaXMuYmVmb3JlUGF5bWVudENyZWF0aW9uSG9va3MpIHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhvb2soY29udGV4dCk7XG4gICAgICBpZiAocmVzdWx0ICYmIFwiYWJvcnRcIiBpbiByZXN1bHQgJiYgcmVzdWx0LmFib3J0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgUGF5bWVudCBjcmVhdGlvbiBhYm9ydGVkOiAke3Jlc3VsdC5yZWFzb259YCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzY2hlbWVOZXR3b3JrQ2xpZW50ID0gZmluZEJ5TmV0d29ya0FuZFNjaGVtZShjbGllbnRTY2hlbWVzQnlOZXR3b3JrLCByZXF1aXJlbWVudHMuc2NoZW1lLCByZXF1aXJlbWVudHMubmV0d29yayk7XG4gICAgICBpZiAoIXNjaGVtZU5ldHdvcmtDbGllbnQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBjbGllbnQgcmVnaXN0ZXJlZCBmb3Igc2NoZW1lOiAke3JlcXVpcmVtZW50cy5zY2hlbWV9IGFuZCBuZXR3b3JrOiAke3JlcXVpcmVtZW50cy5uZXR3b3JrfWApO1xuICAgICAgfVxuICAgICAgY29uc3QgcGFydGlhbFBheWxvYWQgPSBhd2FpdCBzY2hlbWVOZXR3b3JrQ2xpZW50LmNyZWF0ZVBheW1lbnRQYXlsb2FkKHBheW1lbnRSZXF1aXJlZC54NDAyVmVyc2lvbiwgcmVxdWlyZW1lbnRzKTtcbiAgICAgIGxldCBwYXltZW50UGF5bG9hZDtcbiAgICAgIGlmIChwYXJ0aWFsUGF5bG9hZC54NDAyVmVyc2lvbiA9PSAxKSB7XG4gICAgICAgIHBheW1lbnRQYXlsb2FkID0gcGFydGlhbFBheWxvYWQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYXltZW50UGF5bG9hZCA9IHtcbiAgICAgICAgICAuLi5wYXJ0aWFsUGF5bG9hZCxcbiAgICAgICAgICBleHRlbnNpb25zOiBwYXltZW50UmVxdWlyZWQuZXh0ZW5zaW9ucyxcbiAgICAgICAgICByZXNvdXJjZTogcGF5bWVudFJlcXVpcmVkLnJlc291cmNlLFxuICAgICAgICAgIGFjY2VwdGVkOiByZXF1aXJlbWVudHNcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNyZWF0ZWRDb250ZXh0ID0ge1xuICAgICAgICAuLi5jb250ZXh0LFxuICAgICAgICBwYXltZW50UGF5bG9hZFxuICAgICAgfTtcbiAgICAgIGZvciAoY29uc3QgaG9vayBvZiB0aGlzLmFmdGVyUGF5bWVudENyZWF0aW9uSG9va3MpIHtcbiAgICAgICAgYXdhaXQgaG9vayhjcmVhdGVkQ29udGV4dCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcGF5bWVudFBheWxvYWQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IGZhaWx1cmVDb250ZXh0ID0ge1xuICAgICAgICAuLi5jb250ZXh0LFxuICAgICAgICBlcnJvclxuICAgICAgfTtcbiAgICAgIGZvciAoY29uc3QgaG9vayBvZiB0aGlzLm9uUGF5bWVudENyZWF0aW9uRmFpbHVyZUhvb2tzKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhvb2soZmFpbHVyZUNvbnRleHQpO1xuICAgICAgICBpZiAocmVzdWx0ICYmIFwicmVjb3ZlcmVkXCIgaW4gcmVzdWx0ICYmIHJlc3VsdC5yZWNvdmVyZWQpIHtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0LnBheWxvYWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICAvKipcbiAgICogU2VsZWN0cyBhcHByb3ByaWF0ZSBwYXltZW50IHJlcXVpcmVtZW50cyBiYXNlZCBvbiByZWdpc3RlcmVkIGNsaWVudHMgYW5kIHBvbGljaWVzLlxuICAgKlxuICAgKiBTZWxlY3Rpb24gcHJvY2VzczpcbiAgICogMS4gRmlsdGVyIGJ5IHJlZ2lzdGVyZWQgc2NoZW1lcyAobmV0d29yayArIHNjaGVtZSBzdXBwb3J0KVxuICAgKiAyLiBBcHBseSBhbGwgcmVnaXN0ZXJlZCBwb2xpY2llcyBpbiBvcmRlclxuICAgKiAzLiBVc2Ugc2VsZWN0b3IgdG8gY2hvb3NlIGZpbmFsIHJlcXVpcmVtZW50XG4gICAqXG4gICAqIEBwYXJhbSB4NDAyVmVyc2lvbiAtIFRoZSB4NDAyIHByb3RvY29sIHZlcnNpb25cbiAgICogQHBhcmFtIHBheW1lbnRSZXF1aXJlbWVudHMgLSBBcnJheSBvZiBhdmFpbGFibGUgcGF5bWVudCByZXF1aXJlbWVudHNcbiAgICogQHJldHVybnMgVGhlIHNlbGVjdGVkIHBheW1lbnQgcmVxdWlyZW1lbnRzXG4gICAqL1xuICBzZWxlY3RQYXltZW50UmVxdWlyZW1lbnRzKHg0MDJWZXJzaW9uMiwgcGF5bWVudFJlcXVpcmVtZW50cykge1xuICAgIGNvbnN0IGNsaWVudFNjaGVtZXNCeU5ldHdvcmsgPSB0aGlzLnJlZ2lzdGVyZWRDbGllbnRTY2hlbWVzLmdldCh4NDAyVmVyc2lvbjIpO1xuICAgIGlmICghY2xpZW50U2NoZW1lc0J5TmV0d29yaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyBjbGllbnQgcmVnaXN0ZXJlZCBmb3IgeDQwMiB2ZXJzaW9uOiAke3g0MDJWZXJzaW9uMn1gKTtcbiAgICB9XG4gICAgY29uc3Qgc3VwcG9ydGVkUGF5bWVudFJlcXVpcmVtZW50cyA9IHBheW1lbnRSZXF1aXJlbWVudHMuZmlsdGVyKChyZXF1aXJlbWVudCkgPT4ge1xuICAgICAgbGV0IGNsaWVudFNjaGVtZXMgPSBmaW5kU2NoZW1lc0J5TmV0d29yayhjbGllbnRTY2hlbWVzQnlOZXR3b3JrLCByZXF1aXJlbWVudC5uZXR3b3JrKTtcbiAgICAgIGlmICghY2xpZW50U2NoZW1lcykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2xpZW50U2NoZW1lcy5oYXMocmVxdWlyZW1lbnQuc2NoZW1lKTtcbiAgICB9KTtcbiAgICBpZiAoc3VwcG9ydGVkUGF5bWVudFJlcXVpcmVtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gbmV0d29yay9zY2hlbWUgcmVnaXN0ZXJlZCBmb3IgeDQwMiB2ZXJzaW9uOiAke3g0MDJWZXJzaW9uMn0gd2hpY2ggY29tcGx5IHdpdGggdGhlIHBheW1lbnQgcmVxdWlyZW1lbnRzLiAke0pTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgeDQwMlZlcnNpb246IHg0MDJWZXJzaW9uMixcbiAgICAgICAgcGF5bWVudFJlcXVpcmVtZW50cyxcbiAgICAgICAgeDQwMlZlcnNpb25zOiBBcnJheS5mcm9tKHRoaXMucmVnaXN0ZXJlZENsaWVudFNjaGVtZXMua2V5cygpKSxcbiAgICAgICAgbmV0d29ya3M6IEFycmF5LmZyb20oY2xpZW50U2NoZW1lc0J5TmV0d29yay5rZXlzKCkpLFxuICAgICAgICBzY2hlbWVzOiBBcnJheS5mcm9tKGNsaWVudFNjaGVtZXNCeU5ldHdvcmsudmFsdWVzKCkpLm1hcCgoc2NoZW1lcykgPT4gQXJyYXkuZnJvbShzY2hlbWVzLmtleXMoKSkpLmZsYXQoKVxuICAgICAgfSl9YCk7XG4gICAgfVxuICAgIGxldCBmaWx0ZXJlZFJlcXVpcmVtZW50cyA9IHN1cHBvcnRlZFBheW1lbnRSZXF1aXJlbWVudHM7XG4gICAgZm9yIChjb25zdCBwb2xpY3kgb2YgdGhpcy5wb2xpY2llcykge1xuICAgICAgZmlsdGVyZWRSZXF1aXJlbWVudHMgPSBwb2xpY3koeDQwMlZlcnNpb24yLCBmaWx0ZXJlZFJlcXVpcmVtZW50cyk7XG4gICAgICBpZiAoZmlsdGVyZWRSZXF1aXJlbWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgQWxsIHBheW1lbnQgcmVxdWlyZW1lbnRzIHdlcmUgZmlsdGVyZWQgb3V0IGJ5IHBvbGljaWVzIGZvciB4NDAyIHZlcnNpb246ICR7eDQwMlZlcnNpb24yfWApO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcy5wYXltZW50UmVxdWlyZW1lbnRzU2VsZWN0b3IoeDQwMlZlcnNpb24yLCBmaWx0ZXJlZFJlcXVpcmVtZW50cyk7XG4gIH1cbiAgLyoqXG4gICAqIEludGVybmFsIG1ldGhvZCB0byByZWdpc3RlciBhIHNjaGVtZSBjbGllbnQuXG4gICAqXG4gICAqIEBwYXJhbSB4NDAyVmVyc2lvbiAtIFRoZSB4NDAyIHByb3RvY29sIHZlcnNpb25cbiAgICogQHBhcmFtIG5ldHdvcmsgLSBUaGUgbmV0d29yayB0byByZWdpc3RlciB0aGUgY2xpZW50IGZvclxuICAgKiBAcGFyYW0gY2xpZW50IC0gVGhlIHNjaGVtZSBuZXR3b3JrIGNsaWVudCB0byByZWdpc3RlclxuICAgKiBAcmV0dXJucyBUaGUgeDQwMkNsaWVudCBpbnN0YW5jZSBmb3IgY2hhaW5pbmdcbiAgICovXG4gIF9yZWdpc3RlclNjaGVtZSh4NDAyVmVyc2lvbjIsIG5ldHdvcmssIGNsaWVudCkge1xuICAgIGlmICghdGhpcy5yZWdpc3RlcmVkQ2xpZW50U2NoZW1lcy5oYXMoeDQwMlZlcnNpb24yKSkge1xuICAgICAgdGhpcy5yZWdpc3RlcmVkQ2xpZW50U2NoZW1lcy5zZXQoeDQwMlZlcnNpb24yLCAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpKTtcbiAgICB9XG4gICAgY29uc3QgY2xpZW50U2NoZW1lc0J5TmV0d29yayA9IHRoaXMucmVnaXN0ZXJlZENsaWVudFNjaGVtZXMuZ2V0KHg0MDJWZXJzaW9uMik7XG4gICAgaWYgKCFjbGllbnRTY2hlbWVzQnlOZXR3b3JrLmhhcyhuZXR3b3JrKSkge1xuICAgICAgY2xpZW50U2NoZW1lc0J5TmV0d29yay5zZXQobmV0d29yaywgLyogQF9fUFVSRV9fICovIG5ldyBNYXAoKSk7XG4gICAgfVxuICAgIGNvbnN0IGNsaWVudEJ5U2NoZW1lID0gY2xpZW50U2NoZW1lc0J5TmV0d29yay5nZXQobmV0d29yayk7XG4gICAgaWYgKCFjbGllbnRCeVNjaGVtZS5oYXMoY2xpZW50LnNjaGVtZSkpIHtcbiAgICAgIGNsaWVudEJ5U2NoZW1lLnNldChjbGllbnQuc2NoZW1lLCBjbGllbnQpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufTtcbmV4cG9ydCB7XG4gIHg0MDJDbGllbnQsXG4gIHg0MDJIVFRQQ2xpZW50XG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/core/dist/esm/client/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/core/dist/esm/http/index.mjs":
/*!*********************************************************!*\
  !*** ./node_modules/@x402/core/dist/esm/http/index.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   HTTPFacilitatorClient: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.HTTPFacilitatorClient),\n/* harmony export */   RouteConfigurationError: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.RouteConfigurationError),\n/* harmony export */   decodePaymentRequiredHeader: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.decodePaymentRequiredHeader),\n/* harmony export */   decodePaymentResponseHeader: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.decodePaymentResponseHeader),\n/* harmony export */   decodePaymentSignatureHeader: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.decodePaymentSignatureHeader),\n/* harmony export */   encodePaymentRequiredHeader: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.encodePaymentRequiredHeader),\n/* harmony export */   encodePaymentResponseHeader: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.encodePaymentResponseHeader),\n/* harmony export */   encodePaymentSignatureHeader: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.encodePaymentSignatureHeader),\n/* harmony export */   x402HTTPClient: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.x402HTTPClient),\n/* harmony export */   x402HTTPResourceServer: () => (/* reexport safe */ _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__.x402HTTPResourceServer)\n/* harmony export */ });\n/* harmony import */ var _chunk_55XTTMLF_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../chunk-55XTTMLF.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-55XTTMLF.mjs\");\n/* harmony import */ var _chunk_VE37GDG2_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../chunk-VE37GDG2.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-VE37GDG2.mjs\");\n/* harmony import */ var _chunk_X4W4S5RB_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../chunk-X4W4S5RB.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-X4W4S5RB.mjs\");\n/* harmony import */ var _chunk_TDLQZ6MP_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../chunk-TDLQZ6MP.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-TDLQZ6MP.mjs\");\n/* harmony import */ var _chunk_BJTO5JO5_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../chunk-BJTO5JO5.mjs */ \"(rsc)/./node_modules/@x402/core/dist/esm/chunk-BJTO5JO5.mjs\");\n\n\n\n\n\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvY29yZS9kaXN0L2VzbS9odHRwL2luZGV4Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFXK0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVk3QjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHJhbnNhY3Rpb25hbF9hZ2VudC8uL25vZGVfbW9kdWxlcy9AeDQwMi9jb3JlL2Rpc3QvZXNtL2h0dHAvaW5kZXgubWpzP2ZlNjMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgSFRUUEZhY2lsaXRhdG9yQ2xpZW50LFxuICBSb3V0ZUNvbmZpZ3VyYXRpb25FcnJvcixcbiAgZGVjb2RlUGF5bWVudFJlcXVpcmVkSGVhZGVyLFxuICBkZWNvZGVQYXltZW50UmVzcG9uc2VIZWFkZXIsXG4gIGRlY29kZVBheW1lbnRTaWduYXR1cmVIZWFkZXIsXG4gIGVuY29kZVBheW1lbnRSZXF1aXJlZEhlYWRlcixcbiAgZW5jb2RlUGF5bWVudFJlc3BvbnNlSGVhZGVyLFxuICBlbmNvZGVQYXltZW50U2lnbmF0dXJlSGVhZGVyLFxuICB4NDAySFRUUENsaWVudCxcbiAgeDQwMkhUVFBSZXNvdXJjZVNlcnZlclxufSBmcm9tIFwiLi4vY2h1bmstNTVYVFRNTEYubWpzXCI7XG5pbXBvcnQgXCIuLi9jaHVuay1WRTM3R0RHMi5tanNcIjtcbmltcG9ydCBcIi4uL2NodW5rLVg0VzRTNVJCLm1qc1wiO1xuaW1wb3J0IFwiLi4vY2h1bmstVERMUVo2TVAubWpzXCI7XG5pbXBvcnQgXCIuLi9jaHVuay1CSlRPNUpPNS5tanNcIjtcbmV4cG9ydCB7XG4gIEhUVFBGYWNpbGl0YXRvckNsaWVudCxcbiAgUm91dGVDb25maWd1cmF0aW9uRXJyb3IsXG4gIGRlY29kZVBheW1lbnRSZXF1aXJlZEhlYWRlcixcbiAgZGVjb2RlUGF5bWVudFJlc3BvbnNlSGVhZGVyLFxuICBkZWNvZGVQYXltZW50U2lnbmF0dXJlSGVhZGVyLFxuICBlbmNvZGVQYXltZW50UmVxdWlyZWRIZWFkZXIsXG4gIGVuY29kZVBheW1lbnRSZXNwb25zZUhlYWRlcixcbiAgZW5jb2RlUGF5bWVudFNpZ25hdHVyZUhlYWRlcixcbiAgeDQwMkhUVFBDbGllbnQsXG4gIHg0MDJIVFRQUmVzb3VyY2VTZXJ2ZXJcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5tanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/core/dist/esm/http/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/evm/dist/esm/chunk-FOUXRQAV.mjs":
/*!************************************************************!*\
  !*** ./node_modules/@x402/evm/dist/esm/chunk-FOUXRQAV.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ExactEvmScheme: () => (/* binding */ ExactEvmScheme)\n/* harmony export */ });\n/* harmony import */ var _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chunk-ZYXTTU74.mjs */ \"(rsc)/./node_modules/@x402/evm/dist/esm/chunk-ZYXTTU74.mjs\");\n/* harmony import */ var viem__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! viem */ \"(rsc)/./node_modules/viem/_esm/utils/address/getAddress.js\");\n\n\n// src/exact/client/scheme.ts\n\nvar ExactEvmScheme = class {\n  /**\n   * Creates a new ExactEvmClient instance.\n   *\n   * @param signer - The EVM signer for client operations\n   */\n  constructor(signer) {\n    this.signer = signer;\n    this.scheme = \"exact\";\n  }\n  /**\n   * Creates a payment payload for the Exact scheme.\n   *\n   * @param x402Version - The x402 protocol version\n   * @param paymentRequirements - The payment requirements\n   * @returns Promise resolving to a payment payload\n   */\n  async createPaymentPayload(x402Version, paymentRequirements) {\n    const nonce = (0,_chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.createNonce)();\n    const now = Math.floor(Date.now() / 1e3);\n    const authorization = {\n      from: this.signer.address,\n      to: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(paymentRequirements.payTo),\n      value: paymentRequirements.amount,\n      validAfter: (now - 600).toString(),\n      // 10 minutes before\n      validBefore: (now + paymentRequirements.maxTimeoutSeconds).toString(),\n      nonce\n    };\n    const signature = await this.signAuthorization(authorization, paymentRequirements);\n    const payload = {\n      authorization,\n      signature\n    };\n    return {\n      x402Version,\n      payload\n    };\n  }\n  /**\n   * Sign the EIP-3009 authorization using EIP-712\n   *\n   * @param authorization - The authorization to sign\n   * @param requirements - The payment requirements\n   * @returns Promise resolving to the signature\n   */\n  async signAuthorization(authorization, requirements) {\n    const chainId = parseInt(requirements.network.split(\":\")[1]);\n    if (!requirements.extra?.name || !requirements.extra?.version) {\n      throw new Error(\n        `EIP-712 domain parameters (name, version) are required in payment requirements for asset ${requirements.asset}`\n      );\n    }\n    const { name, version } = requirements.extra;\n    const domain = {\n      name,\n      version,\n      chainId,\n      verifyingContract: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(requirements.asset)\n    };\n    const message = {\n      from: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(authorization.from),\n      to: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(authorization.to),\n      value: BigInt(authorization.value),\n      validAfter: BigInt(authorization.validAfter),\n      validBefore: BigInt(authorization.validBefore),\n      nonce: authorization.nonce\n    };\n    return await this.signer.signTypedData({\n      domain,\n      types: _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.authorizationTypes,\n      primaryType: \"TransferWithAuthorization\",\n      message\n    });\n  }\n};\n\n\n//# sourceMappingURL=chunk-FOUXRQAV.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2NodW5rLUZPVVhSUUFWLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFHOEI7O0FBRTlCO0FBQ2tDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQixnRUFBVztBQUM3QjtBQUNBO0FBQ0E7QUFDQSxVQUFVLGdEQUFVO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9HQUFvRyxtQkFBbUI7QUFDdkg7QUFDQTtBQUNBLFlBQVksZ0JBQWdCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCLGdEQUFVO0FBQ25DO0FBQ0E7QUFDQSxZQUFZLGdEQUFVO0FBQ3RCLFVBQVUsZ0RBQVU7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhLG1FQUFrQjtBQUMvQjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBSUU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3RyYW5zYWN0aW9uYWxfYWdlbnQvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2NodW5rLUZPVVhSUUFWLm1qcz8xMmMyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGF1dGhvcml6YXRpb25UeXBlcyxcbiAgY3JlYXRlTm9uY2Vcbn0gZnJvbSBcIi4vY2h1bmstWllYVFRVNzQubWpzXCI7XG5cbi8vIHNyYy9leGFjdC9jbGllbnQvc2NoZW1lLnRzXG5pbXBvcnQgeyBnZXRBZGRyZXNzIH0gZnJvbSBcInZpZW1cIjtcbnZhciBFeGFjdEV2bVNjaGVtZSA9IGNsYXNzIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgRXhhY3RFdm1DbGllbnQgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwYXJhbSBzaWduZXIgLSBUaGUgRVZNIHNpZ25lciBmb3IgY2xpZW50IG9wZXJhdGlvbnNcbiAgICovXG4gIGNvbnN0cnVjdG9yKHNpZ25lcikge1xuICAgIHRoaXMuc2lnbmVyID0gc2lnbmVyO1xuICAgIHRoaXMuc2NoZW1lID0gXCJleGFjdFwiO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgcGF5bWVudCBwYXlsb2FkIGZvciB0aGUgRXhhY3Qgc2NoZW1lLlxuICAgKlxuICAgKiBAcGFyYW0geDQwMlZlcnNpb24gLSBUaGUgeDQwMiBwcm90b2NvbCB2ZXJzaW9uXG4gICAqIEBwYXJhbSBwYXltZW50UmVxdWlyZW1lbnRzIC0gVGhlIHBheW1lbnQgcmVxdWlyZW1lbnRzXG4gICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIGEgcGF5bWVudCBwYXlsb2FkXG4gICAqL1xuICBhc3luYyBjcmVhdGVQYXltZW50UGF5bG9hZCh4NDAyVmVyc2lvbiwgcGF5bWVudFJlcXVpcmVtZW50cykge1xuICAgIGNvbnN0IG5vbmNlID0gY3JlYXRlTm9uY2UoKTtcbiAgICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxZTMpO1xuICAgIGNvbnN0IGF1dGhvcml6YXRpb24gPSB7XG4gICAgICBmcm9tOiB0aGlzLnNpZ25lci5hZGRyZXNzLFxuICAgICAgdG86IGdldEFkZHJlc3MocGF5bWVudFJlcXVpcmVtZW50cy5wYXlUbyksXG4gICAgICB2YWx1ZTogcGF5bWVudFJlcXVpcmVtZW50cy5hbW91bnQsXG4gICAgICB2YWxpZEFmdGVyOiAobm93IC0gNjAwKS50b1N0cmluZygpLFxuICAgICAgLy8gMTAgbWludXRlcyBiZWZvcmVcbiAgICAgIHZhbGlkQmVmb3JlOiAobm93ICsgcGF5bWVudFJlcXVpcmVtZW50cy5tYXhUaW1lb3V0U2Vjb25kcykudG9TdHJpbmcoKSxcbiAgICAgIG5vbmNlXG4gICAgfTtcbiAgICBjb25zdCBzaWduYXR1cmUgPSBhd2FpdCB0aGlzLnNpZ25BdXRob3JpemF0aW9uKGF1dGhvcml6YXRpb24sIHBheW1lbnRSZXF1aXJlbWVudHMpO1xuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICBhdXRob3JpemF0aW9uLFxuICAgICAgc2lnbmF0dXJlXG4gICAgfTtcbiAgICByZXR1cm4ge1xuICAgICAgeDQwMlZlcnNpb24sXG4gICAgICBwYXlsb2FkXG4gICAgfTtcbiAgfVxuICAvKipcbiAgICogU2lnbiB0aGUgRUlQLTMwMDkgYXV0aG9yaXphdGlvbiB1c2luZyBFSVAtNzEyXG4gICAqXG4gICAqIEBwYXJhbSBhdXRob3JpemF0aW9uIC0gVGhlIGF1dGhvcml6YXRpb24gdG8gc2lnblxuICAgKiBAcGFyYW0gcmVxdWlyZW1lbnRzIC0gVGhlIHBheW1lbnQgcmVxdWlyZW1lbnRzXG4gICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRoZSBzaWduYXR1cmVcbiAgICovXG4gIGFzeW5jIHNpZ25BdXRob3JpemF0aW9uKGF1dGhvcml6YXRpb24sIHJlcXVpcmVtZW50cykge1xuICAgIGNvbnN0IGNoYWluSWQgPSBwYXJzZUludChyZXF1aXJlbWVudHMubmV0d29yay5zcGxpdChcIjpcIilbMV0pO1xuICAgIGlmICghcmVxdWlyZW1lbnRzLmV4dHJhPy5uYW1lIHx8ICFyZXF1aXJlbWVudHMuZXh0cmE/LnZlcnNpb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEVJUC03MTIgZG9tYWluIHBhcmFtZXRlcnMgKG5hbWUsIHZlcnNpb24pIGFyZSByZXF1aXJlZCBpbiBwYXltZW50IHJlcXVpcmVtZW50cyBmb3IgYXNzZXQgJHtyZXF1aXJlbWVudHMuYXNzZXR9YFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgeyBuYW1lLCB2ZXJzaW9uIH0gPSByZXF1aXJlbWVudHMuZXh0cmE7XG4gICAgY29uc3QgZG9tYWluID0ge1xuICAgICAgbmFtZSxcbiAgICAgIHZlcnNpb24sXG4gICAgICBjaGFpbklkLFxuICAgICAgdmVyaWZ5aW5nQ29udHJhY3Q6IGdldEFkZHJlc3MocmVxdWlyZW1lbnRzLmFzc2V0KVxuICAgIH07XG4gICAgY29uc3QgbWVzc2FnZSA9IHtcbiAgICAgIGZyb206IGdldEFkZHJlc3MoYXV0aG9yaXphdGlvbi5mcm9tKSxcbiAgICAgIHRvOiBnZXRBZGRyZXNzKGF1dGhvcml6YXRpb24udG8pLFxuICAgICAgdmFsdWU6IEJpZ0ludChhdXRob3JpemF0aW9uLnZhbHVlKSxcbiAgICAgIHZhbGlkQWZ0ZXI6IEJpZ0ludChhdXRob3JpemF0aW9uLnZhbGlkQWZ0ZXIpLFxuICAgICAgdmFsaWRCZWZvcmU6IEJpZ0ludChhdXRob3JpemF0aW9uLnZhbGlkQmVmb3JlKSxcbiAgICAgIG5vbmNlOiBhdXRob3JpemF0aW9uLm5vbmNlXG4gICAgfTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zaWduZXIuc2lnblR5cGVkRGF0YSh7XG4gICAgICBkb21haW4sXG4gICAgICB0eXBlczogYXV0aG9yaXphdGlvblR5cGVzLFxuICAgICAgcHJpbWFyeVR5cGU6IFwiVHJhbnNmZXJXaXRoQXV0aG9yaXphdGlvblwiLFxuICAgICAgbWVzc2FnZVxuICAgIH0pO1xuICB9XG59O1xuXG5leHBvcnQge1xuICBFeGFjdEV2bVNjaGVtZVxufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWNodW5rLUZPVVhSUUFWLm1qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/evm/dist/esm/chunk-FOUXRQAV.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/evm/dist/esm/chunk-JYZWCLMP.mjs":
/*!************************************************************!*\
  !*** ./node_modules/@x402/evm/dist/esm/chunk-JYZWCLMP.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ExactEvmSchemeV1: () => (/* binding */ ExactEvmSchemeV1)\n/* harmony export */ });\n/* harmony import */ var _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chunk-ZYXTTU74.mjs */ \"(rsc)/./node_modules/@x402/evm/dist/esm/chunk-ZYXTTU74.mjs\");\n/* harmony import */ var viem__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! viem */ \"(rsc)/./node_modules/viem/_esm/utils/address/getAddress.js\");\n/* harmony import */ var viem__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! viem */ \"(rsc)/./node_modules/viem/_esm/utils/signature/parseErc6492Signature.js\");\n/* harmony import */ var viem__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! viem */ \"(rsc)/./node_modules/viem/_esm/utils/address/isAddressEqual.js\");\n/* harmony import */ var viem__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! viem */ \"(rsc)/./node_modules/viem/_esm/utils/signature/parseSignature.js\");\n\n\n// src/exact/v1/facilitator/scheme.ts\n\nvar ExactEvmSchemeV1 = class {\n  /**\n   * Creates a new ExactEvmFacilitatorV1 instance.\n   *\n   * @param signer - The EVM signer for facilitator operations\n   * @param config - Optional configuration for the facilitator\n   */\n  constructor(signer, config) {\n    this.signer = signer;\n    this.scheme = \"exact\";\n    this.caipFamily = \"eip155:*\";\n    this.config = {\n      deployERC4337WithEIP6492: config?.deployERC4337WithEIP6492 ?? false\n    };\n  }\n  /**\n   * Get mechanism-specific extra data for the supported kinds endpoint.\n   * For EVM, no extra data is needed.\n   *\n   * @param _ - The network identifier (unused for EVM)\n   * @returns undefined (EVM has no extra data)\n   */\n  getExtra(_) {\n    return void 0;\n  }\n  /**\n   * Get signer addresses used by this facilitator.\n   * Returns all addresses this facilitator can use for signing/settling transactions.\n   *\n   * @param _ - The network identifier (unused for EVM, addresses are network-agnostic)\n   * @returns Array of facilitator wallet addresses\n   */\n  getSigners(_) {\n    return [...this.signer.getAddresses()];\n  }\n  /**\n   * Verifies a payment payload (V1).\n   *\n   * @param payload - The payment payload to verify\n   * @param requirements - The payment requirements\n   * @returns Promise resolving to verification response\n   */\n  async verify(payload, requirements) {\n    const requirementsV1 = requirements;\n    const payloadV1 = payload;\n    const exactEvmPayload = payload.payload;\n    if (payloadV1.scheme !== \"exact\" || requirements.scheme !== \"exact\") {\n      return {\n        isValid: false,\n        invalidReason: \"unsupported_scheme\",\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n    const chainId = (0,_chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.getEvmChainId)(payloadV1.network);\n    if (!requirements.extra?.name || !requirements.extra?.version) {\n      return {\n        isValid: false,\n        invalidReason: \"missing_eip712_domain\",\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n    const { name, version } = requirements.extra;\n    const erc20Address = (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(requirements.asset);\n    if (payloadV1.network !== requirements.network) {\n      return {\n        isValid: false,\n        invalidReason: \"network_mismatch\",\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n    const permitTypedData = {\n      types: _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.authorizationTypes,\n      primaryType: \"TransferWithAuthorization\",\n      domain: {\n        name,\n        version,\n        chainId,\n        verifyingContract: erc20Address\n      },\n      message: {\n        from: exactEvmPayload.authorization.from,\n        to: exactEvmPayload.authorization.to,\n        value: BigInt(exactEvmPayload.authorization.value),\n        validAfter: BigInt(exactEvmPayload.authorization.validAfter),\n        validBefore: BigInt(exactEvmPayload.authorization.validBefore),\n        nonce: exactEvmPayload.authorization.nonce\n      }\n    };\n    try {\n      const recoveredAddress = await this.signer.verifyTypedData({\n        address: exactEvmPayload.authorization.from,\n        ...permitTypedData,\n        signature: exactEvmPayload.signature\n      });\n      if (!recoveredAddress) {\n        return {\n          isValid: false,\n          invalidReason: \"invalid_exact_evm_payload_signature\",\n          payer: exactEvmPayload.authorization.from\n        };\n      }\n    } catch {\n      const signature = exactEvmPayload.signature;\n      const signatureLength = signature.startsWith(\"0x\") ? signature.length - 2 : signature.length;\n      const isSmartWallet = signatureLength > 130;\n      if (isSmartWallet) {\n        const payerAddress = exactEvmPayload.authorization.from;\n        const bytecode = await this.signer.getCode({ address: payerAddress });\n        if (!bytecode || bytecode === \"0x\") {\n          const erc6492Data = (0,viem__WEBPACK_IMPORTED_MODULE_2__.parseErc6492Signature)(signature);\n          const hasDeploymentInfo = erc6492Data.address && erc6492Data.data && !(0,viem__WEBPACK_IMPORTED_MODULE_3__.isAddressEqual)(erc6492Data.address, \"0x0000000000000000000000000000000000000000\");\n          if (!hasDeploymentInfo) {\n            return {\n              isValid: false,\n              invalidReason: \"invalid_exact_evm_payload_undeployed_smart_wallet\",\n              payer: payerAddress\n            };\n          }\n        } else {\n          return {\n            isValid: false,\n            invalidReason: \"invalid_exact_evm_payload_signature\",\n            payer: exactEvmPayload.authorization.from\n          };\n        }\n      } else {\n        return {\n          isValid: false,\n          invalidReason: \"invalid_exact_evm_payload_signature\",\n          payer: exactEvmPayload.authorization.from\n        };\n      }\n    }\n    if ((0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(exactEvmPayload.authorization.to) !== (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(requirements.payTo)) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_exact_evm_payload_recipient_mismatch\",\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n    const now = Math.floor(Date.now() / 1e3);\n    if (BigInt(exactEvmPayload.authorization.validBefore) < BigInt(now + 6)) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_exact_evm_payload_authorization_valid_before\",\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n    if (BigInt(exactEvmPayload.authorization.validAfter) > BigInt(now)) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_exact_evm_payload_authorization_valid_after\",\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n    try {\n      const balance = await this.signer.readContract({\n        address: erc20Address,\n        abi: _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.eip3009ABI,\n        functionName: \"balanceOf\",\n        args: [exactEvmPayload.authorization.from]\n      });\n      if (BigInt(balance) < BigInt(requirementsV1.maxAmountRequired)) {\n        return {\n          isValid: false,\n          invalidReason: \"insufficient_funds\",\n          payer: exactEvmPayload.authorization.from\n        };\n      }\n    } catch {\n    }\n    if (BigInt(exactEvmPayload.authorization.value) < BigInt(requirementsV1.maxAmountRequired)) {\n      return {\n        isValid: false,\n        invalidReason: \"invalid_exact_evm_payload_authorization_value\",\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n    return {\n      isValid: true,\n      invalidReason: void 0,\n      payer: exactEvmPayload.authorization.from\n    };\n  }\n  /**\n   * Settles a payment by executing the transfer (V1).\n   *\n   * @param payload - The payment payload to settle\n   * @param requirements - The payment requirements\n   * @returns Promise resolving to settlement response\n   */\n  async settle(payload, requirements) {\n    const payloadV1 = payload;\n    const exactEvmPayload = payload.payload;\n    const valid = await this.verify(payload, requirements);\n    if (!valid.isValid) {\n      return {\n        success: false,\n        network: payloadV1.network,\n        transaction: \"\",\n        errorReason: valid.invalidReason ?? \"invalid_scheme\",\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n    try {\n      const parseResult = (0,viem__WEBPACK_IMPORTED_MODULE_2__.parseErc6492Signature)(exactEvmPayload.signature);\n      const { signature, address: factoryAddress, data: factoryCalldata } = parseResult;\n      if (this.config.deployERC4337WithEIP6492 && factoryAddress && factoryCalldata && !(0,viem__WEBPACK_IMPORTED_MODULE_3__.isAddressEqual)(factoryAddress, \"0x0000000000000000000000000000000000000000\")) {\n        const payerAddress = exactEvmPayload.authorization.from;\n        const bytecode = await this.signer.getCode({ address: payerAddress });\n        if (!bytecode || bytecode === \"0x\") {\n          try {\n            console.log(`Deploying ERC-4337 smart wallet for ${payerAddress} via EIP-6492`);\n            const deployTx = await this.signer.sendTransaction({\n              to: factoryAddress,\n              data: factoryCalldata\n            });\n            await this.signer.waitForTransactionReceipt({ hash: deployTx });\n            console.log(`Successfully deployed smart wallet for ${payerAddress}`);\n          } catch (deployError) {\n            console.error(\"Smart wallet deployment failed:\", deployError);\n            throw deployError;\n          }\n        } else {\n          console.log(`Smart wallet for ${payerAddress} already deployed, skipping deployment`);\n        }\n      }\n      const signatureLength = signature.startsWith(\"0x\") ? signature.length - 2 : signature.length;\n      const isECDSA = signatureLength === 130;\n      let tx;\n      if (isECDSA) {\n        const parsedSig = (0,viem__WEBPACK_IMPORTED_MODULE_4__.parseSignature)(signature);\n        tx = await this.signer.writeContract({\n          address: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(requirements.asset),\n          abi: _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.eip3009ABI,\n          functionName: \"transferWithAuthorization\",\n          args: [\n            (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(exactEvmPayload.authorization.from),\n            (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(exactEvmPayload.authorization.to),\n            BigInt(exactEvmPayload.authorization.value),\n            BigInt(exactEvmPayload.authorization.validAfter),\n            BigInt(exactEvmPayload.authorization.validBefore),\n            exactEvmPayload.authorization.nonce,\n            parsedSig.v || parsedSig.yParity,\n            parsedSig.r,\n            parsedSig.s\n          ]\n        });\n      } else {\n        tx = await this.signer.writeContract({\n          address: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(requirements.asset),\n          abi: _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.eip3009ABI,\n          functionName: \"transferWithAuthorization\",\n          args: [\n            (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(exactEvmPayload.authorization.from),\n            (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(exactEvmPayload.authorization.to),\n            BigInt(exactEvmPayload.authorization.value),\n            BigInt(exactEvmPayload.authorization.validAfter),\n            BigInt(exactEvmPayload.authorization.validBefore),\n            exactEvmPayload.authorization.nonce,\n            signature\n          ]\n        });\n      }\n      const receipt = await this.signer.waitForTransactionReceipt({ hash: tx });\n      if (receipt.status !== \"success\") {\n        return {\n          success: false,\n          errorReason: \"invalid_transaction_state\",\n          transaction: tx,\n          network: payloadV1.network,\n          payer: exactEvmPayload.authorization.from\n        };\n      }\n      return {\n        success: true,\n        transaction: tx,\n        network: payloadV1.network,\n        payer: exactEvmPayload.authorization.from\n      };\n    } catch (error) {\n      console.error(\"Failed to settle transaction:\", error);\n      return {\n        success: false,\n        errorReason: \"transaction_failed\",\n        transaction: \"\",\n        network: payloadV1.network,\n        payer: exactEvmPayload.authorization.from\n      };\n    }\n  }\n};\n\n\n//# sourceMappingURL=chunk-JYZWCLMP.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2NodW5rLUpZWldDTE1QLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFJOEI7O0FBRTlCO0FBQ3lGO0FBQ3pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0Isa0VBQWE7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZLGdCQUFnQjtBQUM1Qix5QkFBeUIsZ0RBQVU7QUFDbkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsbUVBQWtCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsdUJBQXVCO0FBQzVFO0FBQ0EsOEJBQThCLDJEQUFxQjtBQUNuRCxnRkFBZ0Ysb0RBQWM7QUFDOUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSxnREFBVSx1Q0FBdUMsZ0RBQVU7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYSwyREFBVTtBQUN2QjtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsMkRBQXFCO0FBQy9DLGNBQWMsNERBQTREO0FBQzFFLHdGQUF3RixvREFBYztBQUN0RztBQUNBLHFEQUFxRCx1QkFBdUI7QUFDNUU7QUFDQTtBQUNBLCtEQUErRCxjQUFjO0FBQzdFO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYiwwREFBMEQsZ0JBQWdCO0FBQzFFLGtFQUFrRSxhQUFhO0FBQy9FLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1YsMENBQTBDLGNBQWM7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLG9EQUFjO0FBQ3hDO0FBQ0EsbUJBQW1CLGdEQUFVO0FBQzdCLGVBQWUsMkRBQVU7QUFDekI7QUFDQTtBQUNBLFlBQVksZ0RBQVU7QUFDdEIsWUFBWSxnREFBVTtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFFBQVE7QUFDUjtBQUNBLG1CQUFtQixnREFBVTtBQUM3QixlQUFlLDJEQUFVO0FBQ3pCO0FBQ0E7QUFDQSxZQUFZLGdEQUFVO0FBQ3RCLFlBQVksZ0RBQVU7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0Esb0VBQW9FLFVBQVU7QUFDOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3RyYW5zYWN0aW9uYWxfYWdlbnQvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2NodW5rLUpZWldDTE1QLm1qcz9lYTJiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIGF1dGhvcml6YXRpb25UeXBlcyxcbiAgZWlwMzAwOUFCSSxcbiAgZ2V0RXZtQ2hhaW5JZFxufSBmcm9tIFwiLi9jaHVuay1aWVhUVFU3NC5tanNcIjtcblxuLy8gc3JjL2V4YWN0L3YxL2ZhY2lsaXRhdG9yL3NjaGVtZS50c1xuaW1wb3J0IHsgZ2V0QWRkcmVzcywgaXNBZGRyZXNzRXF1YWwsIHBhcnNlRXJjNjQ5MlNpZ25hdHVyZSwgcGFyc2VTaWduYXR1cmUgfSBmcm9tIFwidmllbVwiO1xudmFyIEV4YWN0RXZtU2NoZW1lVjEgPSBjbGFzcyB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IEV4YWN0RXZtRmFjaWxpdGF0b3JWMSBpbnN0YW5jZS5cbiAgICpcbiAgICogQHBhcmFtIHNpZ25lciAtIFRoZSBFVk0gc2lnbmVyIGZvciBmYWNpbGl0YXRvciBvcGVyYXRpb25zXG4gICAqIEBwYXJhbSBjb25maWcgLSBPcHRpb25hbCBjb25maWd1cmF0aW9uIGZvciB0aGUgZmFjaWxpdGF0b3JcbiAgICovXG4gIGNvbnN0cnVjdG9yKHNpZ25lciwgY29uZmlnKSB7XG4gICAgdGhpcy5zaWduZXIgPSBzaWduZXI7XG4gICAgdGhpcy5zY2hlbWUgPSBcImV4YWN0XCI7XG4gICAgdGhpcy5jYWlwRmFtaWx5ID0gXCJlaXAxNTU6KlwiO1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgZGVwbG95RVJDNDMzN1dpdGhFSVA2NDkyOiBjb25maWc/LmRlcGxveUVSQzQzMzdXaXRoRUlQNjQ5MiA/PyBmYWxzZVxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIEdldCBtZWNoYW5pc20tc3BlY2lmaWMgZXh0cmEgZGF0YSBmb3IgdGhlIHN1cHBvcnRlZCBraW5kcyBlbmRwb2ludC5cbiAgICogRm9yIEVWTSwgbm8gZXh0cmEgZGF0YSBpcyBuZWVkZWQuXG4gICAqXG4gICAqIEBwYXJhbSBfIC0gVGhlIG5ldHdvcmsgaWRlbnRpZmllciAodW51c2VkIGZvciBFVk0pXG4gICAqIEByZXR1cm5zIHVuZGVmaW5lZCAoRVZNIGhhcyBubyBleHRyYSBkYXRhKVxuICAgKi9cbiAgZ2V0RXh0cmEoXykge1xuICAgIHJldHVybiB2b2lkIDA7XG4gIH1cbiAgLyoqXG4gICAqIEdldCBzaWduZXIgYWRkcmVzc2VzIHVzZWQgYnkgdGhpcyBmYWNpbGl0YXRvci5cbiAgICogUmV0dXJucyBhbGwgYWRkcmVzc2VzIHRoaXMgZmFjaWxpdGF0b3IgY2FuIHVzZSBmb3Igc2lnbmluZy9zZXR0bGluZyB0cmFuc2FjdGlvbnMuXG4gICAqXG4gICAqIEBwYXJhbSBfIC0gVGhlIG5ldHdvcmsgaWRlbnRpZmllciAodW51c2VkIGZvciBFVk0sIGFkZHJlc3NlcyBhcmUgbmV0d29yay1hZ25vc3RpYylcbiAgICogQHJldHVybnMgQXJyYXkgb2YgZmFjaWxpdGF0b3Igd2FsbGV0IGFkZHJlc3Nlc1xuICAgKi9cbiAgZ2V0U2lnbmVycyhfKSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLnNpZ25lci5nZXRBZGRyZXNzZXMoKV07XG4gIH1cbiAgLyoqXG4gICAqIFZlcmlmaWVzIGEgcGF5bWVudCBwYXlsb2FkIChWMSkuXG4gICAqXG4gICAqIEBwYXJhbSBwYXlsb2FkIC0gVGhlIHBheW1lbnQgcGF5bG9hZCB0byB2ZXJpZnlcbiAgICogQHBhcmFtIHJlcXVpcmVtZW50cyAtIFRoZSBwYXltZW50IHJlcXVpcmVtZW50c1xuICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byB2ZXJpZmljYXRpb24gcmVzcG9uc2VcbiAgICovXG4gIGFzeW5jIHZlcmlmeShwYXlsb2FkLCByZXF1aXJlbWVudHMpIHtcbiAgICBjb25zdCByZXF1aXJlbWVudHNWMSA9IHJlcXVpcmVtZW50cztcbiAgICBjb25zdCBwYXlsb2FkVjEgPSBwYXlsb2FkO1xuICAgIGNvbnN0IGV4YWN0RXZtUGF5bG9hZCA9IHBheWxvYWQucGF5bG9hZDtcbiAgICBpZiAocGF5bG9hZFYxLnNjaGVtZSAhPT0gXCJleGFjdFwiIHx8IHJlcXVpcmVtZW50cy5zY2hlbWUgIT09IFwiZXhhY3RcIikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGludmFsaWRSZWFzb246IFwidW5zdXBwb3J0ZWRfc2NoZW1lXCIsXG4gICAgICAgIHBheWVyOiBleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCBjaGFpbklkID0gZ2V0RXZtQ2hhaW5JZChwYXlsb2FkVjEubmV0d29yayk7XG4gICAgaWYgKCFyZXF1aXJlbWVudHMuZXh0cmE/Lm5hbWUgfHwgIXJlcXVpcmVtZW50cy5leHRyYT8udmVyc2lvbikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGludmFsaWRSZWFzb246IFwibWlzc2luZ19laXA3MTJfZG9tYWluXCIsXG4gICAgICAgIHBheWVyOiBleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tXG4gICAgICB9O1xuICAgIH1cbiAgICBjb25zdCB7IG5hbWUsIHZlcnNpb24gfSA9IHJlcXVpcmVtZW50cy5leHRyYTtcbiAgICBjb25zdCBlcmMyMEFkZHJlc3MgPSBnZXRBZGRyZXNzKHJlcXVpcmVtZW50cy5hc3NldCk7XG4gICAgaWYgKHBheWxvYWRWMS5uZXR3b3JrICE9PSByZXF1aXJlbWVudHMubmV0d29yaykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGludmFsaWRSZWFzb246IFwibmV0d29ya19taXNtYXRjaFwiLFxuICAgICAgICBwYXllcjogZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24uZnJvbVxuICAgICAgfTtcbiAgICB9XG4gICAgY29uc3QgcGVybWl0VHlwZWREYXRhID0ge1xuICAgICAgdHlwZXM6IGF1dGhvcml6YXRpb25UeXBlcyxcbiAgICAgIHByaW1hcnlUeXBlOiBcIlRyYW5zZmVyV2l0aEF1dGhvcml6YXRpb25cIixcbiAgICAgIGRvbWFpbjoge1xuICAgICAgICBuYW1lLFxuICAgICAgICB2ZXJzaW9uLFxuICAgICAgICBjaGFpbklkLFxuICAgICAgICB2ZXJpZnlpbmdDb250cmFjdDogZXJjMjBBZGRyZXNzXG4gICAgICB9LFxuICAgICAgbWVzc2FnZToge1xuICAgICAgICBmcm9tOiBleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tLFxuICAgICAgICB0bzogZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24udG8sXG4gICAgICAgIHZhbHVlOiBCaWdJbnQoZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24udmFsdWUpLFxuICAgICAgICB2YWxpZEFmdGVyOiBCaWdJbnQoZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24udmFsaWRBZnRlciksXG4gICAgICAgIHZhbGlkQmVmb3JlOiBCaWdJbnQoZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24udmFsaWRCZWZvcmUpLFxuICAgICAgICBub25jZTogZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24ubm9uY2VcbiAgICAgIH1cbiAgICB9O1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZWNvdmVyZWRBZGRyZXNzID0gYXdhaXQgdGhpcy5zaWduZXIudmVyaWZ5VHlwZWREYXRhKHtcbiAgICAgICAgYWRkcmVzczogZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24uZnJvbSxcbiAgICAgICAgLi4ucGVybWl0VHlwZWREYXRhLFxuICAgICAgICBzaWduYXR1cmU6IGV4YWN0RXZtUGF5bG9hZC5zaWduYXR1cmVcbiAgICAgIH0pO1xuICAgICAgaWYgKCFyZWNvdmVyZWRBZGRyZXNzKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgaW52YWxpZFJlYXNvbjogXCJpbnZhbGlkX2V4YWN0X2V2bV9wYXlsb2FkX3NpZ25hdHVyZVwiLFxuICAgICAgICAgIHBheWVyOiBleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCB7XG4gICAgICBjb25zdCBzaWduYXR1cmUgPSBleGFjdEV2bVBheWxvYWQuc2lnbmF0dXJlO1xuICAgICAgY29uc3Qgc2lnbmF0dXJlTGVuZ3RoID0gc2lnbmF0dXJlLnN0YXJ0c1dpdGgoXCIweFwiKSA/IHNpZ25hdHVyZS5sZW5ndGggLSAyIDogc2lnbmF0dXJlLmxlbmd0aDtcbiAgICAgIGNvbnN0IGlzU21hcnRXYWxsZXQgPSBzaWduYXR1cmVMZW5ndGggPiAxMzA7XG4gICAgICBpZiAoaXNTbWFydFdhbGxldCkge1xuICAgICAgICBjb25zdCBwYXllckFkZHJlc3MgPSBleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tO1xuICAgICAgICBjb25zdCBieXRlY29kZSA9IGF3YWl0IHRoaXMuc2lnbmVyLmdldENvZGUoeyBhZGRyZXNzOiBwYXllckFkZHJlc3MgfSk7XG4gICAgICAgIGlmICghYnl0ZWNvZGUgfHwgYnl0ZWNvZGUgPT09IFwiMHhcIikge1xuICAgICAgICAgIGNvbnN0IGVyYzY0OTJEYXRhID0gcGFyc2VFcmM2NDkyU2lnbmF0dXJlKHNpZ25hdHVyZSk7XG4gICAgICAgICAgY29uc3QgaGFzRGVwbG95bWVudEluZm8gPSBlcmM2NDkyRGF0YS5hZGRyZXNzICYmIGVyYzY0OTJEYXRhLmRhdGEgJiYgIWlzQWRkcmVzc0VxdWFsKGVyYzY0OTJEYXRhLmFkZHJlc3MsIFwiMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwXCIpO1xuICAgICAgICAgIGlmICghaGFzRGVwbG95bWVudEluZm8pIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgICBpbnZhbGlkUmVhc29uOiBcImludmFsaWRfZXhhY3RfZXZtX3BheWxvYWRfdW5kZXBsb3llZF9zbWFydF93YWxsZXRcIixcbiAgICAgICAgICAgICAgcGF5ZXI6IHBheWVyQWRkcmVzc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgaW52YWxpZFJlYXNvbjogXCJpbnZhbGlkX2V4YWN0X2V2bV9wYXlsb2FkX3NpZ25hdHVyZVwiLFxuICAgICAgICAgICAgcGF5ZXI6IGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb21cbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGludmFsaWRSZWFzb246IFwiaW52YWxpZF9leGFjdF9ldm1fcGF5bG9hZF9zaWduYXR1cmVcIixcbiAgICAgICAgICBwYXllcjogZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24uZnJvbVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoZ2V0QWRkcmVzcyhleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi50bykgIT09IGdldEFkZHJlc3MocmVxdWlyZW1lbnRzLnBheVRvKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGludmFsaWRSZWFzb246IFwiaW52YWxpZF9leGFjdF9ldm1fcGF5bG9hZF9yZWNpcGllbnRfbWlzbWF0Y2hcIixcbiAgICAgICAgcGF5ZXI6IGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb21cbiAgICAgIH07XG4gICAgfVxuICAgIGNvbnN0IG5vdyA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDFlMyk7XG4gICAgaWYgKEJpZ0ludChleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi52YWxpZEJlZm9yZSkgPCBCaWdJbnQobm93ICsgNikpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICBpbnZhbGlkUmVhc29uOiBcImludmFsaWRfZXhhY3RfZXZtX3BheWxvYWRfYXV0aG9yaXphdGlvbl92YWxpZF9iZWZvcmVcIixcbiAgICAgICAgcGF5ZXI6IGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb21cbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChCaWdJbnQoZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24udmFsaWRBZnRlcikgPiBCaWdJbnQobm93KSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIGludmFsaWRSZWFzb246IFwiaW52YWxpZF9leGFjdF9ldm1fcGF5bG9hZF9hdXRob3JpemF0aW9uX3ZhbGlkX2FmdGVyXCIsXG4gICAgICAgIHBheWVyOiBleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tXG4gICAgICB9O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgYmFsYW5jZSA9IGF3YWl0IHRoaXMuc2lnbmVyLnJlYWRDb250cmFjdCh7XG4gICAgICAgIGFkZHJlc3M6IGVyYzIwQWRkcmVzcyxcbiAgICAgICAgYWJpOiBlaXAzMDA5QUJJLFxuICAgICAgICBmdW5jdGlvbk5hbWU6IFwiYmFsYW5jZU9mXCIsXG4gICAgICAgIGFyZ3M6IFtleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tXVxuICAgICAgfSk7XG4gICAgICBpZiAoQmlnSW50KGJhbGFuY2UpIDwgQmlnSW50KHJlcXVpcmVtZW50c1YxLm1heEFtb3VudFJlcXVpcmVkKSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIGludmFsaWRSZWFzb246IFwiaW5zdWZmaWNpZW50X2Z1bmRzXCIsXG4gICAgICAgICAgcGF5ZXI6IGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb21cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICB9XG4gICAgaWYgKEJpZ0ludChleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi52YWx1ZSkgPCBCaWdJbnQocmVxdWlyZW1lbnRzVjEubWF4QW1vdW50UmVxdWlyZWQpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgaW52YWxpZFJlYXNvbjogXCJpbnZhbGlkX2V4YWN0X2V2bV9wYXlsb2FkX2F1dGhvcml6YXRpb25fdmFsdWVcIixcbiAgICAgICAgcGF5ZXI6IGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb21cbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBpc1ZhbGlkOiB0cnVlLFxuICAgICAgaW52YWxpZFJlYXNvbjogdm9pZCAwLFxuICAgICAgcGF5ZXI6IGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb21cbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBTZXR0bGVzIGEgcGF5bWVudCBieSBleGVjdXRpbmcgdGhlIHRyYW5zZmVyIChWMSkuXG4gICAqXG4gICAqIEBwYXJhbSBwYXlsb2FkIC0gVGhlIHBheW1lbnQgcGF5bG9hZCB0byBzZXR0bGVcbiAgICogQHBhcmFtIHJlcXVpcmVtZW50cyAtIFRoZSBwYXltZW50IHJlcXVpcmVtZW50c1xuICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBzZXR0bGVtZW50IHJlc3BvbnNlXG4gICAqL1xuICBhc3luYyBzZXR0bGUocGF5bG9hZCwgcmVxdWlyZW1lbnRzKSB7XG4gICAgY29uc3QgcGF5bG9hZFYxID0gcGF5bG9hZDtcbiAgICBjb25zdCBleGFjdEV2bVBheWxvYWQgPSBwYXlsb2FkLnBheWxvYWQ7XG4gICAgY29uc3QgdmFsaWQgPSBhd2FpdCB0aGlzLnZlcmlmeShwYXlsb2FkLCByZXF1aXJlbWVudHMpO1xuICAgIGlmICghdmFsaWQuaXNWYWxpZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG5ldHdvcms6IHBheWxvYWRWMS5uZXR3b3JrLFxuICAgICAgICB0cmFuc2FjdGlvbjogXCJcIixcbiAgICAgICAgZXJyb3JSZWFzb246IHZhbGlkLmludmFsaWRSZWFzb24gPz8gXCJpbnZhbGlkX3NjaGVtZVwiLFxuICAgICAgICBwYXllcjogZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24uZnJvbVxuICAgICAgfTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlUmVzdWx0ID0gcGFyc2VFcmM2NDkyU2lnbmF0dXJlKGV4YWN0RXZtUGF5bG9hZC5zaWduYXR1cmUpO1xuICAgICAgY29uc3QgeyBzaWduYXR1cmUsIGFkZHJlc3M6IGZhY3RvcnlBZGRyZXNzLCBkYXRhOiBmYWN0b3J5Q2FsbGRhdGEgfSA9IHBhcnNlUmVzdWx0O1xuICAgICAgaWYgKHRoaXMuY29uZmlnLmRlcGxveUVSQzQzMzdXaXRoRUlQNjQ5MiAmJiBmYWN0b3J5QWRkcmVzcyAmJiBmYWN0b3J5Q2FsbGRhdGEgJiYgIWlzQWRkcmVzc0VxdWFsKGZhY3RvcnlBZGRyZXNzLCBcIjB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMFwiKSkge1xuICAgICAgICBjb25zdCBwYXllckFkZHJlc3MgPSBleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tO1xuICAgICAgICBjb25zdCBieXRlY29kZSA9IGF3YWl0IHRoaXMuc2lnbmVyLmdldENvZGUoeyBhZGRyZXNzOiBwYXllckFkZHJlc3MgfSk7XG4gICAgICAgIGlmICghYnl0ZWNvZGUgfHwgYnl0ZWNvZGUgPT09IFwiMHhcIikge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgRGVwbG95aW5nIEVSQy00MzM3IHNtYXJ0IHdhbGxldCBmb3IgJHtwYXllckFkZHJlc3N9IHZpYSBFSVAtNjQ5MmApO1xuICAgICAgICAgICAgY29uc3QgZGVwbG95VHggPSBhd2FpdCB0aGlzLnNpZ25lci5zZW5kVHJhbnNhY3Rpb24oe1xuICAgICAgICAgICAgICB0bzogZmFjdG9yeUFkZHJlc3MsXG4gICAgICAgICAgICAgIGRhdGE6IGZhY3RvcnlDYWxsZGF0YVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnNpZ25lci53YWl0Rm9yVHJhbnNhY3Rpb25SZWNlaXB0KHsgaGFzaDogZGVwbG95VHggfSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgU3VjY2Vzc2Z1bGx5IGRlcGxveWVkIHNtYXJ0IHdhbGxldCBmb3IgJHtwYXllckFkZHJlc3N9YCk7XG4gICAgICAgICAgfSBjYXRjaCAoZGVwbG95RXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTbWFydCB3YWxsZXQgZGVwbG95bWVudCBmYWlsZWQ6XCIsIGRlcGxveUVycm9yKTtcbiAgICAgICAgICAgIHRocm93IGRlcGxveUVycm9yO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhgU21hcnQgd2FsbGV0IGZvciAke3BheWVyQWRkcmVzc30gYWxyZWFkeSBkZXBsb3llZCwgc2tpcHBpbmcgZGVwbG95bWVudGApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zdCBzaWduYXR1cmVMZW5ndGggPSBzaWduYXR1cmUuc3RhcnRzV2l0aChcIjB4XCIpID8gc2lnbmF0dXJlLmxlbmd0aCAtIDIgOiBzaWduYXR1cmUubGVuZ3RoO1xuICAgICAgY29uc3QgaXNFQ0RTQSA9IHNpZ25hdHVyZUxlbmd0aCA9PT0gMTMwO1xuICAgICAgbGV0IHR4O1xuICAgICAgaWYgKGlzRUNEU0EpIHtcbiAgICAgICAgY29uc3QgcGFyc2VkU2lnID0gcGFyc2VTaWduYXR1cmUoc2lnbmF0dXJlKTtcbiAgICAgICAgdHggPSBhd2FpdCB0aGlzLnNpZ25lci53cml0ZUNvbnRyYWN0KHtcbiAgICAgICAgICBhZGRyZXNzOiBnZXRBZGRyZXNzKHJlcXVpcmVtZW50cy5hc3NldCksXG4gICAgICAgICAgYWJpOiBlaXAzMDA5QUJJLFxuICAgICAgICAgIGZ1bmN0aW9uTmFtZTogXCJ0cmFuc2ZlcldpdGhBdXRob3JpemF0aW9uXCIsXG4gICAgICAgICAgYXJnczogW1xuICAgICAgICAgICAgZ2V0QWRkcmVzcyhleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5mcm9tKSxcbiAgICAgICAgICAgIGdldEFkZHJlc3MoZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24udG8pLFxuICAgICAgICAgICAgQmlnSW50KGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLnZhbHVlKSxcbiAgICAgICAgICAgIEJpZ0ludChleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi52YWxpZEFmdGVyKSxcbiAgICAgICAgICAgIEJpZ0ludChleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi52YWxpZEJlZm9yZSksXG4gICAgICAgICAgICBleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi5ub25jZSxcbiAgICAgICAgICAgIHBhcnNlZFNpZy52IHx8IHBhcnNlZFNpZy55UGFyaXR5LFxuICAgICAgICAgICAgcGFyc2VkU2lnLnIsXG4gICAgICAgICAgICBwYXJzZWRTaWcuc1xuICAgICAgICAgIF1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0eCA9IGF3YWl0IHRoaXMuc2lnbmVyLndyaXRlQ29udHJhY3Qoe1xuICAgICAgICAgIGFkZHJlc3M6IGdldEFkZHJlc3MocmVxdWlyZW1lbnRzLmFzc2V0KSxcbiAgICAgICAgICBhYmk6IGVpcDMwMDlBQkksXG4gICAgICAgICAgZnVuY3Rpb25OYW1lOiBcInRyYW5zZmVyV2l0aEF1dGhvcml6YXRpb25cIixcbiAgICAgICAgICBhcmdzOiBbXG4gICAgICAgICAgICBnZXRBZGRyZXNzKGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb20pLFxuICAgICAgICAgICAgZ2V0QWRkcmVzcyhleGFjdEV2bVBheWxvYWQuYXV0aG9yaXphdGlvbi50byksXG4gICAgICAgICAgICBCaWdJbnQoZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24udmFsdWUpLFxuICAgICAgICAgICAgQmlnSW50KGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLnZhbGlkQWZ0ZXIpLFxuICAgICAgICAgICAgQmlnSW50KGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLnZhbGlkQmVmb3JlKSxcbiAgICAgICAgICAgIGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLm5vbmNlLFxuICAgICAgICAgICAgc2lnbmF0dXJlXG4gICAgICAgICAgXVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlY2VpcHQgPSBhd2FpdCB0aGlzLnNpZ25lci53YWl0Rm9yVHJhbnNhY3Rpb25SZWNlaXB0KHsgaGFzaDogdHggfSk7XG4gICAgICBpZiAocmVjZWlwdC5zdGF0dXMgIT09IFwic3VjY2Vzc1wiKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgZXJyb3JSZWFzb246IFwiaW52YWxpZF90cmFuc2FjdGlvbl9zdGF0ZVwiLFxuICAgICAgICAgIHRyYW5zYWN0aW9uOiB0eCxcbiAgICAgICAgICBuZXR3b3JrOiBwYXlsb2FkVjEubmV0d29yayxcbiAgICAgICAgICBwYXllcjogZXhhY3RFdm1QYXlsb2FkLmF1dGhvcml6YXRpb24uZnJvbVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgdHJhbnNhY3Rpb246IHR4LFxuICAgICAgICBuZXR3b3JrOiBwYXlsb2FkVjEubmV0d29yayxcbiAgICAgICAgcGF5ZXI6IGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb21cbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2V0dGxlIHRyYW5zYWN0aW9uOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3JSZWFzb246IFwidHJhbnNhY3Rpb25fZmFpbGVkXCIsXG4gICAgICAgIHRyYW5zYWN0aW9uOiBcIlwiLFxuICAgICAgICBuZXR3b3JrOiBwYXlsb2FkVjEubmV0d29yayxcbiAgICAgICAgcGF5ZXI6IGV4YWN0RXZtUGF5bG9hZC5hdXRob3JpemF0aW9uLmZyb21cbiAgICAgIH07XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQge1xuICBFeGFjdEV2bVNjaGVtZVYxXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2h1bmstSllaV0NMTVAubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/evm/dist/esm/chunk-JYZWCLMP.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/evm/dist/esm/chunk-PSA4YVU2.mjs":
/*!************************************************************!*\
  !*** ./node_modules/@x402/evm/dist/esm/chunk-PSA4YVU2.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ExactEvmSchemeV1: () => (/* binding */ ExactEvmSchemeV1)\n/* harmony export */ });\n/* harmony import */ var _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./chunk-ZYXTTU74.mjs */ \"(rsc)/./node_modules/@x402/evm/dist/esm/chunk-ZYXTTU74.mjs\");\n/* harmony import */ var viem__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! viem */ \"(rsc)/./node_modules/viem/_esm/utils/address/getAddress.js\");\n\n\n// src/exact/v1/client/scheme.ts\n\nvar ExactEvmSchemeV1 = class {\n  /**\n   * Creates a new ExactEvmClientV1 instance.\n   *\n   * @param signer - The EVM signer for client operations\n   */\n  constructor(signer) {\n    this.signer = signer;\n    this.scheme = \"exact\";\n  }\n  /**\n   * Creates a payment payload for the Exact scheme (V1).\n   *\n   * @param x402Version - The x402 protocol version\n   * @param paymentRequirements - The payment requirements\n   * @returns Promise resolving to a payment payload\n   */\n  async createPaymentPayload(x402Version, paymentRequirements) {\n    const selectedV1 = paymentRequirements;\n    const nonce = (0,_chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.createNonce)();\n    const now = Math.floor(Date.now() / 1e3);\n    const authorization = {\n      from: this.signer.address,\n      to: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(selectedV1.payTo),\n      value: selectedV1.maxAmountRequired,\n      validAfter: (now - 600).toString(),\n      // 10 minutes before\n      validBefore: (now + selectedV1.maxTimeoutSeconds).toString(),\n      nonce\n    };\n    const signature = await this.signAuthorization(authorization, selectedV1);\n    const payload = {\n      authorization,\n      signature\n    };\n    return {\n      x402Version,\n      scheme: selectedV1.scheme,\n      network: selectedV1.network,\n      payload\n    };\n  }\n  /**\n   * Sign the EIP-3009 authorization using EIP-712\n   *\n   * @param authorization - The authorization to sign\n   * @param requirements - The payment requirements\n   * @returns Promise resolving to the signature\n   */\n  async signAuthorization(authorization, requirements) {\n    const chainId = (0,_chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.getEvmChainId)(requirements.network);\n    if (!requirements.extra?.name || !requirements.extra?.version) {\n      throw new Error(\n        `EIP-712 domain parameters (name, version) are required in payment requirements for asset ${requirements.asset}`\n      );\n    }\n    const { name, version } = requirements.extra;\n    const domain = {\n      name,\n      version,\n      chainId,\n      verifyingContract: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(requirements.asset)\n    };\n    const message = {\n      from: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(authorization.from),\n      to: (0,viem__WEBPACK_IMPORTED_MODULE_1__.getAddress)(authorization.to),\n      value: BigInt(authorization.value),\n      validAfter: BigInt(authorization.validAfter),\n      validBefore: BigInt(authorization.validBefore),\n      nonce: authorization.nonce\n    };\n    return await this.signer.signTypedData({\n      domain,\n      types: _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_0__.authorizationTypes,\n      primaryType: \"TransferWithAuthorization\",\n      message\n    });\n  }\n};\n\n\n//# sourceMappingURL=chunk-PSA4YVU2.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2NodW5rLVBTQTRZVlUyLm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFJOEI7O0FBRTlCO0FBQ2tDO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esa0JBQWtCLGdFQUFXO0FBQzdCO0FBQ0E7QUFDQTtBQUNBLFVBQVUsZ0RBQVU7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9CQUFvQixrRUFBYTtBQUNqQztBQUNBO0FBQ0Esb0dBQW9HLG1CQUFtQjtBQUN2SDtBQUNBO0FBQ0EsWUFBWSxnQkFBZ0I7QUFDNUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsZ0RBQVU7QUFDbkM7QUFDQTtBQUNBLFlBQVksZ0RBQVU7QUFDdEIsVUFBVSxnREFBVTtBQUNwQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsbUVBQWtCO0FBQy9CO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFJRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHJhbnNhY3Rpb25hbF9hZ2VudC8uL25vZGVfbW9kdWxlcy9AeDQwMi9ldm0vZGlzdC9lc20vY2h1bmstUFNBNFlWVTIubWpzP2MzNzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgYXV0aG9yaXphdGlvblR5cGVzLFxuICBjcmVhdGVOb25jZSxcbiAgZ2V0RXZtQ2hhaW5JZFxufSBmcm9tIFwiLi9jaHVuay1aWVhUVFU3NC5tanNcIjtcblxuLy8gc3JjL2V4YWN0L3YxL2NsaWVudC9zY2hlbWUudHNcbmltcG9ydCB7IGdldEFkZHJlc3MgfSBmcm9tIFwidmllbVwiO1xudmFyIEV4YWN0RXZtU2NoZW1lVjEgPSBjbGFzcyB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IEV4YWN0RXZtQ2xpZW50VjEgaW5zdGFuY2UuXG4gICAqXG4gICAqIEBwYXJhbSBzaWduZXIgLSBUaGUgRVZNIHNpZ25lciBmb3IgY2xpZW50IG9wZXJhdGlvbnNcbiAgICovXG4gIGNvbnN0cnVjdG9yKHNpZ25lcikge1xuICAgIHRoaXMuc2lnbmVyID0gc2lnbmVyO1xuICAgIHRoaXMuc2NoZW1lID0gXCJleGFjdFwiO1xuICB9XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgcGF5bWVudCBwYXlsb2FkIGZvciB0aGUgRXhhY3Qgc2NoZW1lIChWMSkuXG4gICAqXG4gICAqIEBwYXJhbSB4NDAyVmVyc2lvbiAtIFRoZSB4NDAyIHByb3RvY29sIHZlcnNpb25cbiAgICogQHBhcmFtIHBheW1lbnRSZXF1aXJlbWVudHMgLSBUaGUgcGF5bWVudCByZXF1aXJlbWVudHNcbiAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gYSBwYXltZW50IHBheWxvYWRcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBheW1lbnRQYXlsb2FkKHg0MDJWZXJzaW9uLCBwYXltZW50UmVxdWlyZW1lbnRzKSB7XG4gICAgY29uc3Qgc2VsZWN0ZWRWMSA9IHBheW1lbnRSZXF1aXJlbWVudHM7XG4gICAgY29uc3Qgbm9uY2UgPSBjcmVhdGVOb25jZSgpO1xuICAgIGNvbnN0IG5vdyA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDFlMyk7XG4gICAgY29uc3QgYXV0aG9yaXphdGlvbiA9IHtcbiAgICAgIGZyb206IHRoaXMuc2lnbmVyLmFkZHJlc3MsXG4gICAgICB0bzogZ2V0QWRkcmVzcyhzZWxlY3RlZFYxLnBheVRvKSxcbiAgICAgIHZhbHVlOiBzZWxlY3RlZFYxLm1heEFtb3VudFJlcXVpcmVkLFxuICAgICAgdmFsaWRBZnRlcjogKG5vdyAtIDYwMCkudG9TdHJpbmcoKSxcbiAgICAgIC8vIDEwIG1pbnV0ZXMgYmVmb3JlXG4gICAgICB2YWxpZEJlZm9yZTogKG5vdyArIHNlbGVjdGVkVjEubWF4VGltZW91dFNlY29uZHMpLnRvU3RyaW5nKCksXG4gICAgICBub25jZVxuICAgIH07XG4gICAgY29uc3Qgc2lnbmF0dXJlID0gYXdhaXQgdGhpcy5zaWduQXV0aG9yaXphdGlvbihhdXRob3JpemF0aW9uLCBzZWxlY3RlZFYxKTtcbiAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgYXV0aG9yaXphdGlvbixcbiAgICAgIHNpZ25hdHVyZVxuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgIHg0MDJWZXJzaW9uLFxuICAgICAgc2NoZW1lOiBzZWxlY3RlZFYxLnNjaGVtZSxcbiAgICAgIG5ldHdvcms6IHNlbGVjdGVkVjEubmV0d29yayxcbiAgICAgIHBheWxvYWRcbiAgICB9O1xuICB9XG4gIC8qKlxuICAgKiBTaWduIHRoZSBFSVAtMzAwOSBhdXRob3JpemF0aW9uIHVzaW5nIEVJUC03MTJcbiAgICpcbiAgICogQHBhcmFtIGF1dGhvcml6YXRpb24gLSBUaGUgYXV0aG9yaXphdGlvbiB0byBzaWduXG4gICAqIEBwYXJhbSByZXF1aXJlbWVudHMgLSBUaGUgcGF5bWVudCByZXF1aXJlbWVudHNcbiAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gdGhlIHNpZ25hdHVyZVxuICAgKi9cbiAgYXN5bmMgc2lnbkF1dGhvcml6YXRpb24oYXV0aG9yaXphdGlvbiwgcmVxdWlyZW1lbnRzKSB7XG4gICAgY29uc3QgY2hhaW5JZCA9IGdldEV2bUNoYWluSWQocmVxdWlyZW1lbnRzLm5ldHdvcmspO1xuICAgIGlmICghcmVxdWlyZW1lbnRzLmV4dHJhPy5uYW1lIHx8ICFyZXF1aXJlbWVudHMuZXh0cmE/LnZlcnNpb24pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEVJUC03MTIgZG9tYWluIHBhcmFtZXRlcnMgKG5hbWUsIHZlcnNpb24pIGFyZSByZXF1aXJlZCBpbiBwYXltZW50IHJlcXVpcmVtZW50cyBmb3IgYXNzZXQgJHtyZXF1aXJlbWVudHMuYXNzZXR9YFxuICAgICAgKTtcbiAgICB9XG4gICAgY29uc3QgeyBuYW1lLCB2ZXJzaW9uIH0gPSByZXF1aXJlbWVudHMuZXh0cmE7XG4gICAgY29uc3QgZG9tYWluID0ge1xuICAgICAgbmFtZSxcbiAgICAgIHZlcnNpb24sXG4gICAgICBjaGFpbklkLFxuICAgICAgdmVyaWZ5aW5nQ29udHJhY3Q6IGdldEFkZHJlc3MocmVxdWlyZW1lbnRzLmFzc2V0KVxuICAgIH07XG4gICAgY29uc3QgbWVzc2FnZSA9IHtcbiAgICAgIGZyb206IGdldEFkZHJlc3MoYXV0aG9yaXphdGlvbi5mcm9tKSxcbiAgICAgIHRvOiBnZXRBZGRyZXNzKGF1dGhvcml6YXRpb24udG8pLFxuICAgICAgdmFsdWU6IEJpZ0ludChhdXRob3JpemF0aW9uLnZhbHVlKSxcbiAgICAgIHZhbGlkQWZ0ZXI6IEJpZ0ludChhdXRob3JpemF0aW9uLnZhbGlkQWZ0ZXIpLFxuICAgICAgdmFsaWRCZWZvcmU6IEJpZ0ludChhdXRob3JpemF0aW9uLnZhbGlkQmVmb3JlKSxcbiAgICAgIG5vbmNlOiBhdXRob3JpemF0aW9uLm5vbmNlXG4gICAgfTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zaWduZXIuc2lnblR5cGVkRGF0YSh7XG4gICAgICBkb21haW4sXG4gICAgICB0eXBlczogYXV0aG9yaXphdGlvblR5cGVzLFxuICAgICAgcHJpbWFyeVR5cGU6IFwiVHJhbnNmZXJXaXRoQXV0aG9yaXphdGlvblwiLFxuICAgICAgbWVzc2FnZVxuICAgIH0pO1xuICB9XG59O1xuXG5leHBvcnQge1xuICBFeGFjdEV2bVNjaGVtZVYxXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2h1bmstUFNBNFlWVTIubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/evm/dist/esm/chunk-PSA4YVU2.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/evm/dist/esm/chunk-QLXM7BIB.mjs":
/*!************************************************************!*\
  !*** ./node_modules/@x402/evm/dist/esm/chunk-QLXM7BIB.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   NETWORKS: () => (/* binding */ NETWORKS)\n/* harmony export */ });\n// src/v1/index.ts\nvar NETWORKS = [\n  \"abstract\",\n  \"abstract-testnet\",\n  \"base-sepolia\",\n  \"base\",\n  \"avalanche-fuji\",\n  \"avalanche\",\n  \"iotex\",\n  \"sei\",\n  \"sei-testnet\",\n  \"polygon\",\n  \"polygon-amoy\",\n  \"peaq\",\n  \"story\",\n  \"educhain\",\n  \"skale-base-sepolia\"\n];\n\n\n//# sourceMappingURL=chunk-QLXM7BIB.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2NodW5rLVFMWE03QklCLm1qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUlFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmFuc2FjdGlvbmFsX2FnZW50Ly4vbm9kZV9tb2R1bGVzL0B4NDAyL2V2bS9kaXN0L2VzbS9jaHVuay1RTFhNN0JJQi5tanM/ZGU5NiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvdjEvaW5kZXgudHNcbnZhciBORVRXT1JLUyA9IFtcbiAgXCJhYnN0cmFjdFwiLFxuICBcImFic3RyYWN0LXRlc3RuZXRcIixcbiAgXCJiYXNlLXNlcG9saWFcIixcbiAgXCJiYXNlXCIsXG4gIFwiYXZhbGFuY2hlLWZ1amlcIixcbiAgXCJhdmFsYW5jaGVcIixcbiAgXCJpb3RleFwiLFxuICBcInNlaVwiLFxuICBcInNlaS10ZXN0bmV0XCIsXG4gIFwicG9seWdvblwiLFxuICBcInBvbHlnb24tYW1veVwiLFxuICBcInBlYXFcIixcbiAgXCJzdG9yeVwiLFxuICBcImVkdWNoYWluXCIsXG4gIFwic2thbGUtYmFzZS1zZXBvbGlhXCJcbl07XG5cbmV4cG9ydCB7XG4gIE5FVFdPUktTXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2h1bmstUUxYTTdCSUIubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/evm/dist/esm/chunk-QLXM7BIB.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/evm/dist/esm/chunk-ZYXTTU74.mjs":
/*!************************************************************!*\
  !*** ./node_modules/@x402/evm/dist/esm/chunk-ZYXTTU74.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authorizationTypes: () => (/* binding */ authorizationTypes),\n/* harmony export */   createNonce: () => (/* binding */ createNonce),\n/* harmony export */   eip3009ABI: () => (/* binding */ eip3009ABI),\n/* harmony export */   getEvmChainId: () => (/* binding */ getEvmChainId)\n/* harmony export */ });\n/* harmony import */ var viem__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! viem */ \"(rsc)/./node_modules/viem/_esm/utils/encoding/toHex.js\");\n// src/constants.ts\nvar authorizationTypes = {\n  TransferWithAuthorization: [\n    { name: \"from\", type: \"address\" },\n    { name: \"to\", type: \"address\" },\n    { name: \"value\", type: \"uint256\" },\n    { name: \"validAfter\", type: \"uint256\" },\n    { name: \"validBefore\", type: \"uint256\" },\n    { name: \"nonce\", type: \"bytes32\" }\n  ]\n};\nvar eip3009ABI = [\n  {\n    inputs: [\n      { name: \"from\", type: \"address\" },\n      { name: \"to\", type: \"address\" },\n      { name: \"value\", type: \"uint256\" },\n      { name: \"validAfter\", type: \"uint256\" },\n      { name: \"validBefore\", type: \"uint256\" },\n      { name: \"nonce\", type: \"bytes32\" },\n      { name: \"v\", type: \"uint8\" },\n      { name: \"r\", type: \"bytes32\" },\n      { name: \"s\", type: \"bytes32\" }\n    ],\n    name: \"transferWithAuthorization\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\"\n  },\n  {\n    inputs: [\n      { name: \"from\", type: \"address\" },\n      { name: \"to\", type: \"address\" },\n      { name: \"value\", type: \"uint256\" },\n      { name: \"validAfter\", type: \"uint256\" },\n      { name: \"validBefore\", type: \"uint256\" },\n      { name: \"nonce\", type: \"bytes32\" },\n      { name: \"signature\", type: \"bytes\" }\n    ],\n    name: \"transferWithAuthorization\",\n    outputs: [],\n    stateMutability: \"nonpayable\",\n    type: \"function\"\n  },\n  {\n    inputs: [{ name: \"account\", type: \"address\" }],\n    name: \"balanceOf\",\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n    type: \"function\"\n  },\n  {\n    inputs: [],\n    name: \"version\",\n    outputs: [{ name: \"\", type: \"string\" }],\n    stateMutability: \"view\",\n    type: \"function\"\n  }\n];\n\n// src/utils.ts\n\nfunction getEvmChainId(network) {\n  const networkMap = {\n    base: 8453,\n    \"base-sepolia\": 84532,\n    ethereum: 1,\n    sepolia: 11155111,\n    polygon: 137,\n    \"polygon-amoy\": 80002\n  };\n  return networkMap[network] || 1;\n}\nfunction createNonce() {\n  const cryptoObj = typeof globalThis.crypto !== \"undefined\" ? globalThis.crypto : globalThis.crypto;\n  if (!cryptoObj) {\n    throw new Error(\"Crypto API not available\");\n  }\n  return (0,viem__WEBPACK_IMPORTED_MODULE_0__.toHex)(cryptoObj.getRandomValues(new Uint8Array(32)));\n}\n\n\n//# sourceMappingURL=chunk-ZYXTTU74.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2NodW5rLVpZWFRUVTc0Lm1qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sK0JBQStCO0FBQ3JDLE1BQU0sNkJBQTZCO0FBQ25DLE1BQU0sZ0NBQWdDO0FBQ3RDLE1BQU0scUNBQXFDO0FBQzNDLE1BQU0sc0NBQXNDO0FBQzVDLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUSwrQkFBK0I7QUFDdkMsUUFBUSw2QkFBNkI7QUFDckMsUUFBUSxnQ0FBZ0M7QUFDeEMsUUFBUSxxQ0FBcUM7QUFDN0MsUUFBUSxzQ0FBc0M7QUFDOUMsUUFBUSxnQ0FBZ0M7QUFDeEMsUUFBUSwwQkFBMEI7QUFDbEMsUUFBUSw0QkFBNEI7QUFDcEMsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBLFFBQVEsK0JBQStCO0FBQ3ZDLFFBQVEsNkJBQTZCO0FBQ3JDLFFBQVEsZ0NBQWdDO0FBQ3hDLFFBQVEscUNBQXFDO0FBQzdDLFFBQVEsc0NBQXNDO0FBQzlDLFFBQVEsZ0NBQWdDO0FBQ3hDLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EsZUFBZSxrQ0FBa0M7QUFDakQ7QUFDQSxnQkFBZ0IsMkJBQTJCO0FBQzNDO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLDBCQUEwQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUM2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVMsMkNBQUs7QUFDZDs7QUFPRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHJhbnNhY3Rpb25hbF9hZ2VudC8uL25vZGVfbW9kdWxlcy9AeDQwMi9ldm0vZGlzdC9lc20vY2h1bmstWllYVFRVNzQubWpzP2MzZGYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gc3JjL2NvbnN0YW50cy50c1xudmFyIGF1dGhvcml6YXRpb25UeXBlcyA9IHtcbiAgVHJhbnNmZXJXaXRoQXV0aG9yaXphdGlvbjogW1xuICAgIHsgbmFtZTogXCJmcm9tXCIsIHR5cGU6IFwiYWRkcmVzc1wiIH0sXG4gICAgeyBuYW1lOiBcInRvXCIsIHR5cGU6IFwiYWRkcmVzc1wiIH0sXG4gICAgeyBuYW1lOiBcInZhbHVlXCIsIHR5cGU6IFwidWludDI1NlwiIH0sXG4gICAgeyBuYW1lOiBcInZhbGlkQWZ0ZXJcIiwgdHlwZTogXCJ1aW50MjU2XCIgfSxcbiAgICB7IG5hbWU6IFwidmFsaWRCZWZvcmVcIiwgdHlwZTogXCJ1aW50MjU2XCIgfSxcbiAgICB7IG5hbWU6IFwibm9uY2VcIiwgdHlwZTogXCJieXRlczMyXCIgfVxuICBdXG59O1xudmFyIGVpcDMwMDlBQkkgPSBbXG4gIHtcbiAgICBpbnB1dHM6IFtcbiAgICAgIHsgbmFtZTogXCJmcm9tXCIsIHR5cGU6IFwiYWRkcmVzc1wiIH0sXG4gICAgICB7IG5hbWU6IFwidG9cIiwgdHlwZTogXCJhZGRyZXNzXCIgfSxcbiAgICAgIHsgbmFtZTogXCJ2YWx1ZVwiLCB0eXBlOiBcInVpbnQyNTZcIiB9LFxuICAgICAgeyBuYW1lOiBcInZhbGlkQWZ0ZXJcIiwgdHlwZTogXCJ1aW50MjU2XCIgfSxcbiAgICAgIHsgbmFtZTogXCJ2YWxpZEJlZm9yZVwiLCB0eXBlOiBcInVpbnQyNTZcIiB9LFxuICAgICAgeyBuYW1lOiBcIm5vbmNlXCIsIHR5cGU6IFwiYnl0ZXMzMlwiIH0sXG4gICAgICB7IG5hbWU6IFwidlwiLCB0eXBlOiBcInVpbnQ4XCIgfSxcbiAgICAgIHsgbmFtZTogXCJyXCIsIHR5cGU6IFwiYnl0ZXMzMlwiIH0sXG4gICAgICB7IG5hbWU6IFwic1wiLCB0eXBlOiBcImJ5dGVzMzJcIiB9XG4gICAgXSxcbiAgICBuYW1lOiBcInRyYW5zZmVyV2l0aEF1dGhvcml6YXRpb25cIixcbiAgICBvdXRwdXRzOiBbXSxcbiAgICBzdGF0ZU11dGFiaWxpdHk6IFwibm9ucGF5YWJsZVwiLFxuICAgIHR5cGU6IFwiZnVuY3Rpb25cIlxuICB9LFxuICB7XG4gICAgaW5wdXRzOiBbXG4gICAgICB7IG5hbWU6IFwiZnJvbVwiLCB0eXBlOiBcImFkZHJlc3NcIiB9LFxuICAgICAgeyBuYW1lOiBcInRvXCIsIHR5cGU6IFwiYWRkcmVzc1wiIH0sXG4gICAgICB7IG5hbWU6IFwidmFsdWVcIiwgdHlwZTogXCJ1aW50MjU2XCIgfSxcbiAgICAgIHsgbmFtZTogXCJ2YWxpZEFmdGVyXCIsIHR5cGU6IFwidWludDI1NlwiIH0sXG4gICAgICB7IG5hbWU6IFwidmFsaWRCZWZvcmVcIiwgdHlwZTogXCJ1aW50MjU2XCIgfSxcbiAgICAgIHsgbmFtZTogXCJub25jZVwiLCB0eXBlOiBcImJ5dGVzMzJcIiB9LFxuICAgICAgeyBuYW1lOiBcInNpZ25hdHVyZVwiLCB0eXBlOiBcImJ5dGVzXCIgfVxuICAgIF0sXG4gICAgbmFtZTogXCJ0cmFuc2ZlcldpdGhBdXRob3JpemF0aW9uXCIsXG4gICAgb3V0cHV0czogW10sXG4gICAgc3RhdGVNdXRhYmlsaXR5OiBcIm5vbnBheWFibGVcIixcbiAgICB0eXBlOiBcImZ1bmN0aW9uXCJcbiAgfSxcbiAge1xuICAgIGlucHV0czogW3sgbmFtZTogXCJhY2NvdW50XCIsIHR5cGU6IFwiYWRkcmVzc1wiIH1dLFxuICAgIG5hbWU6IFwiYmFsYW5jZU9mXCIsXG4gICAgb3V0cHV0czogW3sgbmFtZTogXCJcIiwgdHlwZTogXCJ1aW50MjU2XCIgfV0sXG4gICAgc3RhdGVNdXRhYmlsaXR5OiBcInZpZXdcIixcbiAgICB0eXBlOiBcImZ1bmN0aW9uXCJcbiAgfSxcbiAge1xuICAgIGlucHV0czogW10sXG4gICAgbmFtZTogXCJ2ZXJzaW9uXCIsXG4gICAgb3V0cHV0czogW3sgbmFtZTogXCJcIiwgdHlwZTogXCJzdHJpbmdcIiB9XSxcbiAgICBzdGF0ZU11dGFiaWxpdHk6IFwidmlld1wiLFxuICAgIHR5cGU6IFwiZnVuY3Rpb25cIlxuICB9XG5dO1xuXG4vLyBzcmMvdXRpbHMudHNcbmltcG9ydCB7IHRvSGV4IH0gZnJvbSBcInZpZW1cIjtcbmZ1bmN0aW9uIGdldEV2bUNoYWluSWQobmV0d29yaykge1xuICBjb25zdCBuZXR3b3JrTWFwID0ge1xuICAgIGJhc2U6IDg0NTMsXG4gICAgXCJiYXNlLXNlcG9saWFcIjogODQ1MzIsXG4gICAgZXRoZXJldW06IDEsXG4gICAgc2Vwb2xpYTogMTExNTUxMTEsXG4gICAgcG9seWdvbjogMTM3LFxuICAgIFwicG9seWdvbi1hbW95XCI6IDgwMDAyXG4gIH07XG4gIHJldHVybiBuZXR3b3JrTWFwW25ldHdvcmtdIHx8IDE7XG59XG5mdW5jdGlvbiBjcmVhdGVOb25jZSgpIHtcbiAgY29uc3QgY3J5cHRvT2JqID0gdHlwZW9mIGdsb2JhbFRoaXMuY3J5cHRvICE9PSBcInVuZGVmaW5lZFwiID8gZ2xvYmFsVGhpcy5jcnlwdG8gOiBnbG9iYWxUaGlzLmNyeXB0bztcbiAgaWYgKCFjcnlwdG9PYmopIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDcnlwdG8gQVBJIG5vdCBhdmFpbGFibGVcIik7XG4gIH1cbiAgcmV0dXJuIHRvSGV4KGNyeXB0b09iai5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQ4QXJyYXkoMzIpKSk7XG59XG5cbmV4cG9ydCB7XG4gIGF1dGhvcml6YXRpb25UeXBlcyxcbiAgZWlwMzAwOUFCSSxcbiAgZ2V0RXZtQ2hhaW5JZCxcbiAgY3JlYXRlTm9uY2Vcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jaHVuay1aWVhUVFU3NC5tanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/evm/dist/esm/chunk-ZYXTTU74.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/evm/dist/esm/exact/client/index.mjs":
/*!****************************************************************!*\
  !*** ./node_modules/@x402/evm/dist/esm/exact/client/index.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ExactEvmScheme: () => (/* reexport safe */ _chunk_FOUXRQAV_mjs__WEBPACK_IMPORTED_MODULE_0__.ExactEvmScheme),\n/* harmony export */   registerExactEvmScheme: () => (/* binding */ registerExactEvmScheme)\n/* harmony export */ });\n/* harmony import */ var _chunk_FOUXRQAV_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../chunk-FOUXRQAV.mjs */ \"(rsc)/./node_modules/@x402/evm/dist/esm/chunk-FOUXRQAV.mjs\");\n/* harmony import */ var _chunk_QLXM7BIB_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../chunk-QLXM7BIB.mjs */ \"(rsc)/./node_modules/@x402/evm/dist/esm/chunk-QLXM7BIB.mjs\");\n/* harmony import */ var _chunk_PSA4YVU2_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../chunk-PSA4YVU2.mjs */ \"(rsc)/./node_modules/@x402/evm/dist/esm/chunk-PSA4YVU2.mjs\");\n/* harmony import */ var _chunk_JYZWCLMP_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../chunk-JYZWCLMP.mjs */ \"(rsc)/./node_modules/@x402/evm/dist/esm/chunk-JYZWCLMP.mjs\");\n/* harmony import */ var _chunk_ZYXTTU74_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../chunk-ZYXTTU74.mjs */ \"(rsc)/./node_modules/@x402/evm/dist/esm/chunk-ZYXTTU74.mjs\");\n\n\n\n\n\n\n// src/exact/client/register.ts\nfunction registerExactEvmScheme(client, config) {\n  if (config.networks && config.networks.length > 0) {\n    config.networks.forEach((network) => {\n      client.register(network, new _chunk_FOUXRQAV_mjs__WEBPACK_IMPORTED_MODULE_0__.ExactEvmScheme(config.signer));\n    });\n  } else {\n    client.register(\"eip155:*\", new _chunk_FOUXRQAV_mjs__WEBPACK_IMPORTED_MODULE_0__.ExactEvmScheme(config.signer));\n  }\n  _chunk_QLXM7BIB_mjs__WEBPACK_IMPORTED_MODULE_1__.NETWORKS.forEach((network) => {\n    client.registerV1(network, new _chunk_PSA4YVU2_mjs__WEBPACK_IMPORTED_MODULE_2__.ExactEvmSchemeV1(config.signer));\n  });\n  if (config.policies) {\n    config.policies.forEach((policy) => {\n      client.registerPolicy(policy);\n    });\n  }\n  return client;\n}\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2V4YWN0L2NsaWVudC9pbmRleC5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUVrQztBQUdBO0FBR0E7QUFDQTtBQUNBOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQywrREFBYztBQUNqRCxLQUFLO0FBQ0wsSUFBSTtBQUNKLG9DQUFvQywrREFBYztBQUNsRDtBQUNBLEVBQUUseURBQVE7QUFDVixtQ0FBbUMsaUVBQWdCO0FBQ25ELEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBSUU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL3RyYW5zYWN0aW9uYWxfYWdlbnQvLi9ub2RlX21vZHVsZXMvQHg0MDIvZXZtL2Rpc3QvZXNtL2V4YWN0L2NsaWVudC9pbmRleC5tanM/MzYwNiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBFeGFjdEV2bVNjaGVtZVxufSBmcm9tIFwiLi4vLi4vY2h1bmstRk9VWFJRQVYubWpzXCI7XG5pbXBvcnQge1xuICBORVRXT1JLU1xufSBmcm9tIFwiLi4vLi4vY2h1bmstUUxYTTdCSUIubWpzXCI7XG5pbXBvcnQge1xuICBFeGFjdEV2bVNjaGVtZVYxXG59IGZyb20gXCIuLi8uLi9jaHVuay1QU0E0WVZVMi5tanNcIjtcbmltcG9ydCBcIi4uLy4uL2NodW5rLUpZWldDTE1QLm1qc1wiO1xuaW1wb3J0IFwiLi4vLi4vY2h1bmstWllYVFRVNzQubWpzXCI7XG5cbi8vIHNyYy9leGFjdC9jbGllbnQvcmVnaXN0ZXIudHNcbmZ1bmN0aW9uIHJlZ2lzdGVyRXhhY3RFdm1TY2hlbWUoY2xpZW50LCBjb25maWcpIHtcbiAgaWYgKGNvbmZpZy5uZXR3b3JrcyAmJiBjb25maWcubmV0d29ya3MubGVuZ3RoID4gMCkge1xuICAgIGNvbmZpZy5uZXR3b3Jrcy5mb3JFYWNoKChuZXR3b3JrKSA9PiB7XG4gICAgICBjbGllbnQucmVnaXN0ZXIobmV0d29yaywgbmV3IEV4YWN0RXZtU2NoZW1lKGNvbmZpZy5zaWduZXIpKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBjbGllbnQucmVnaXN0ZXIoXCJlaXAxNTU6KlwiLCBuZXcgRXhhY3RFdm1TY2hlbWUoY29uZmlnLnNpZ25lcikpO1xuICB9XG4gIE5FVFdPUktTLmZvckVhY2goKG5ldHdvcmspID0+IHtcbiAgICBjbGllbnQucmVnaXN0ZXJWMShuZXR3b3JrLCBuZXcgRXhhY3RFdm1TY2hlbWVWMShjb25maWcuc2lnbmVyKSk7XG4gIH0pO1xuICBpZiAoY29uZmlnLnBvbGljaWVzKSB7XG4gICAgY29uZmlnLnBvbGljaWVzLmZvckVhY2goKHBvbGljeSkgPT4ge1xuICAgICAgY2xpZW50LnJlZ2lzdGVyUG9saWN5KHBvbGljeSk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGNsaWVudDtcbn1cbmV4cG9ydCB7XG4gIEV4YWN0RXZtU2NoZW1lLFxuICByZWdpc3RlckV4YWN0RXZtU2NoZW1lXG59O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXgubWpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/evm/dist/esm/exact/client/index.mjs\n");

/***/ }),

/***/ "(rsc)/./node_modules/@x402/fetch/dist/esm/index.mjs":
/*!*****************************************************!*\
  !*** ./node_modules/@x402/fetch/dist/esm/index.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   decodePaymentResponseHeader: () => (/* reexport safe */ _x402_core_http__WEBPACK_IMPORTED_MODULE_1__.decodePaymentResponseHeader),\n/* harmony export */   wrapFetchWithPayment: () => (/* binding */ wrapFetchWithPayment),\n/* harmony export */   wrapFetchWithPaymentFromConfig: () => (/* binding */ wrapFetchWithPaymentFromConfig),\n/* harmony export */   x402Client: () => (/* reexport safe */ _x402_core_client__WEBPACK_IMPORTED_MODULE_0__.x402Client),\n/* harmony export */   x402HTTPClient: () => (/* reexport safe */ _x402_core_client__WEBPACK_IMPORTED_MODULE_0__.x402HTTPClient)\n/* harmony export */ });\n/* harmony import */ var _x402_core_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @x402/core/client */ \"(rsc)/./node_modules/@x402/core/dist/esm/client/index.mjs\");\n/* harmony import */ var _x402_core_http__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @x402/core/http */ \"(rsc)/./node_modules/@x402/core/dist/esm/http/index.mjs\");\n// src/index.ts\n\n\n\nfunction wrapFetchWithPayment(fetch, client) {\n  const httpClient = client instanceof _x402_core_client__WEBPACK_IMPORTED_MODULE_0__.x402HTTPClient ? client : new _x402_core_client__WEBPACK_IMPORTED_MODULE_0__.x402HTTPClient(client);\n  return async (input, init) => {\n    const request = new Request(input, init);\n    const clonedRequest = request.clone();\n    const response = await fetch(request);\n    if (response.status !== 402) {\n      return response;\n    }\n    let paymentRequired;\n    try {\n      const getHeader = (name) => response.headers.get(name);\n      let body;\n      try {\n        const responseText = await response.text();\n        if (responseText) {\n          body = JSON.parse(responseText);\n        }\n      } catch {\n      }\n      paymentRequired = httpClient.getPaymentRequiredResponse(getHeader, body);\n    } catch (error) {\n      throw new Error(\n        `Failed to parse payment requirements: ${error instanceof Error ? error.message : \"Unknown error\"}`\n      );\n    }\n    let paymentPayload;\n    try {\n      paymentPayload = await client.createPaymentPayload(paymentRequired);\n    } catch (error) {\n      throw new Error(\n        `Failed to create payment payload: ${error instanceof Error ? error.message : \"Unknown error\"}`\n      );\n    }\n    const paymentHeaders = httpClient.encodePaymentSignatureHeader(paymentPayload);\n    if (clonedRequest.headers.has(\"PAYMENT-SIGNATURE\") || clonedRequest.headers.has(\"X-PAYMENT\")) {\n      throw new Error(\"Payment already attempted\");\n    }\n    for (const [key, value] of Object.entries(paymentHeaders)) {\n      clonedRequest.headers.set(key, value);\n    }\n    clonedRequest.headers.set(\n      \"Access-Control-Expose-Headers\",\n      \"PAYMENT-RESPONSE,X-PAYMENT-RESPONSE\"\n    );\n    const secondResponse = await fetch(clonedRequest);\n    return secondResponse;\n  };\n}\nfunction wrapFetchWithPaymentFromConfig(fetch, config) {\n  const client = _x402_core_client__WEBPACK_IMPORTED_MODULE_0__.x402Client.fromConfig(config);\n  return wrapFetchWithPayment(fetch, client);\n}\n\n//# sourceMappingURL=index.mjs.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvQHg0MDIvZmV0Y2gvZGlzdC9lc20vaW5kZXgubWpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQTtBQUMrRDtBQUNrQztBQUNuQztBQUM5RDtBQUNBLHVDQUF1Qyw2REFBYyxnQkFBZ0IsNkRBQWM7QUFDbkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLGlEQUFpRCx5REFBeUQ7QUFDMUc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLDZDQUE2Qyx5REFBeUQ7QUFDdEc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLHlEQUFVO0FBQzNCO0FBQ0E7QUFPRTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vdHJhbnNhY3Rpb25hbF9hZ2VudC8uL25vZGVfbW9kdWxlcy9AeDQwMi9mZXRjaC9kaXN0L2VzbS9pbmRleC5tanM/N2YxZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvaW5kZXgudHNcbmltcG9ydCB7IHg0MDJDbGllbnQsIHg0MDJIVFRQQ2xpZW50IH0gZnJvbSBcIkB4NDAyL2NvcmUvY2xpZW50XCI7XG5pbXBvcnQgeyB4NDAyQ2xpZW50IGFzIHg0MDJDbGllbnQyLCB4NDAySFRUUENsaWVudCBhcyB4NDAySFRUUENsaWVudDIgfSBmcm9tIFwiQHg0MDIvY29yZS9jbGllbnRcIjtcbmltcG9ydCB7IGRlY29kZVBheW1lbnRSZXNwb25zZUhlYWRlciB9IGZyb20gXCJAeDQwMi9jb3JlL2h0dHBcIjtcbmZ1bmN0aW9uIHdyYXBGZXRjaFdpdGhQYXltZW50KGZldGNoLCBjbGllbnQpIHtcbiAgY29uc3QgaHR0cENsaWVudCA9IGNsaWVudCBpbnN0YW5jZW9mIHg0MDJIVFRQQ2xpZW50ID8gY2xpZW50IDogbmV3IHg0MDJIVFRQQ2xpZW50KGNsaWVudCk7XG4gIHJldHVybiBhc3luYyAoaW5wdXQsIGluaXQpID0+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoaW5wdXQsIGluaXQpO1xuICAgIGNvbnN0IGNsb25lZFJlcXVlc3QgPSByZXF1ZXN0LmNsb25lKCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChyZXF1ZXN0KTtcbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSA0MDIpIHtcbiAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICB9XG4gICAgbGV0IHBheW1lbnRSZXF1aXJlZDtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZ2V0SGVhZGVyID0gKG5hbWUpID0+IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KG5hbWUpO1xuICAgICAgbGV0IGJvZHk7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZVRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIGlmIChyZXNwb25zZVRleHQpIHtcbiAgICAgICAgICBib2R5ID0gSlNPTi5wYXJzZShyZXNwb25zZVRleHQpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIHtcbiAgICAgIH1cbiAgICAgIHBheW1lbnRSZXF1aXJlZCA9IGh0dHBDbGllbnQuZ2V0UGF5bWVudFJlcXVpcmVkUmVzcG9uc2UoZ2V0SGVhZGVyLCBib2R5KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgRmFpbGVkIHRvIHBhcnNlIHBheW1lbnQgcmVxdWlyZW1lbnRzOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogXCJVbmtub3duIGVycm9yXCJ9YFxuICAgICAgKTtcbiAgICB9XG4gICAgbGV0IHBheW1lbnRQYXlsb2FkO1xuICAgIHRyeSB7XG4gICAgICBwYXltZW50UGF5bG9hZCA9IGF3YWl0IGNsaWVudC5jcmVhdGVQYXltZW50UGF5bG9hZChwYXltZW50UmVxdWlyZWQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgIGBGYWlsZWQgdG8gY3JlYXRlIHBheW1lbnQgcGF5bG9hZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwifWBcbiAgICAgICk7XG4gICAgfVxuICAgIGNvbnN0IHBheW1lbnRIZWFkZXJzID0gaHR0cENsaWVudC5lbmNvZGVQYXltZW50U2lnbmF0dXJlSGVhZGVyKHBheW1lbnRQYXlsb2FkKTtcbiAgICBpZiAoY2xvbmVkUmVxdWVzdC5oZWFkZXJzLmhhcyhcIlBBWU1FTlQtU0lHTkFUVVJFXCIpIHx8IGNsb25lZFJlcXVlc3QuaGVhZGVycy5oYXMoXCJYLVBBWU1FTlRcIikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlBheW1lbnQgYWxyZWFkeSBhdHRlbXB0ZWRcIik7XG4gICAgfVxuICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHBheW1lbnRIZWFkZXJzKSkge1xuICAgICAgY2xvbmVkUmVxdWVzdC5oZWFkZXJzLnNldChrZXksIHZhbHVlKTtcbiAgICB9XG4gICAgY2xvbmVkUmVxdWVzdC5oZWFkZXJzLnNldChcbiAgICAgIFwiQWNjZXNzLUNvbnRyb2wtRXhwb3NlLUhlYWRlcnNcIixcbiAgICAgIFwiUEFZTUVOVC1SRVNQT05TRSxYLVBBWU1FTlQtUkVTUE9OU0VcIlxuICAgICk7XG4gICAgY29uc3Qgc2Vjb25kUmVzcG9uc2UgPSBhd2FpdCBmZXRjaChjbG9uZWRSZXF1ZXN0KTtcbiAgICByZXR1cm4gc2Vjb25kUmVzcG9uc2U7XG4gIH07XG59XG5mdW5jdGlvbiB3cmFwRmV0Y2hXaXRoUGF5bWVudEZyb21Db25maWcoZmV0Y2gsIGNvbmZpZykge1xuICBjb25zdCBjbGllbnQgPSB4NDAyQ2xpZW50LmZyb21Db25maWcoY29uZmlnKTtcbiAgcmV0dXJuIHdyYXBGZXRjaFdpdGhQYXltZW50KGZldGNoLCBjbGllbnQpO1xufVxuZXhwb3J0IHtcbiAgZGVjb2RlUGF5bWVudFJlc3BvbnNlSGVhZGVyLFxuICB3cmFwRmV0Y2hXaXRoUGF5bWVudCxcbiAgd3JhcEZldGNoV2l0aFBheW1lbnRGcm9tQ29uZmlnLFxuICB4NDAyQ2xpZW50MiBhcyB4NDAyQ2xpZW50LFxuICB4NDAySFRUUENsaWVudDIgYXMgeDQwMkhUVFBDbGllbnRcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5tanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/@x402/fetch/dist/esm/index.mjs\n");

/***/ })

};
;