
> railbridge-facilitator@1.0.0 test:merchant-same-chain
> tsx src/merchant-server-same-chain.ts

ðŸ›’ Merchant server (same-chain only) listening at http://localhost:4021
Using facilitator at: http://localhost:4022
Merchant address: 0x1111111111111111111111111111111111111111
[2026-01-20T07:49:43.239Z] GET /api/premium
   IP: ::1
   User-Agent: node
[2026-01-20T07:49:43.239Z] GET /api/premium - 402 (8ms)
[2026-01-20T07:49:43.285Z] GET /api/premium
   IP: ::1
   User-Agent: node
   Payment: eyJ4NDAyVmVyc2lvbiI6MiwicGF5bG9hZCI6eyJhdXRob3Jpem...
âœ… Premium content accessed - Payment verified and settled
DEBUG: Response Headers: [Object: null prototype] { 'x-powered-by': 'Express' }
DEBUG: Intercepted settlePayment call
DEBUG: Args: [
  {
    "x402Version": 2,
    "payload": {
      "authorization": {
        "from": "0x7621106919A7485daF135C1EE0216AaFD1AD144D",
        "to": "0x1111111111111111111111111111111111111111",
        "value": "100000",
        "validAfter": "1768894783",
        "validBefore": "1768895683",
        "nonce": "0xf3054c32d9237d2b7c8481bd2d5c2489d41d9795245a4f9a0cdaa1bbfcafcc8a"
      },
      "signature": "0xc99f77f91e6ced607db81b97c91e1cd862b8135d4edf6e5dab3a73b32caddc53788c4686cbb90c4c3d4e6c5c7d71b309bb41e7cdf0974c12993967b6fade019c1b"
    },
    "resource": {
      "url": "http://localhost:4021/api/premium",
      "description": "Premium API endpoint",
      "mimeType": "application/json"
    },
    "accepted": {
      "scheme": "exact",
      "network": "eip155:84532",
      "amount": "100000",
      "asset": "0x036CbD53842c5426634e7929541eC2318f3dCF7e",
      "payTo": "0x1111111111111111111111111111111111111111",
      "maxTimeoutSeconds": 300,
      "extra": {
        "name": "USDC",
        "version": "2"
      }
    }
  },
  {
    "scheme": "exact",
    "network": "eip155:84532",
    "amount": "100000",
    "asset": "0x036CbD53842c5426634e7929541eC2318f3dCF7e",
    "payTo": "0x1111111111111111111111111111111111111111",
    "maxTimeoutSeconds": 300,
    "extra": {
      "name": "USDC",
      "version": "2"
    }
  }
]
DEBUG: Settle Result: {
  "success": true,
  "transaction": "0xda63b912df5e8ee5e127ea8b31d629096725f707997f26933f881736c3f91712",
  "network": "eip155:84532",
  "payer": "0x7621106919A7485daF135C1EE0216AaFD1AD144D"
}
DEBUG: Cached result for nonce 0xf3054c32d9237d2b7c8481bd2d5c2489d41d9795245a4f9a0cdaa1bbfcafcc8a
[2026-01-20T07:49:43.285Z] GET /api/premium - 200 (5398ms)
[2026-01-20T07:57:35.463Z] GET /api/premium
   IP: ::1
   User-Agent: node
[2026-01-20T07:57:35.463Z] GET /api/premium - 402 (3ms)
[2026-01-20T07:57:35.498Z] GET /api/premium
   IP: ::1
   User-Agent: node
   Payment: eyJ4NDAyVmVyc2lvbiI6MiwicGF5bG9hZCI6eyJhdXRob3Jpem...
âœ… Premium content accessed - Payment verified and settled
DEBUG: Response Headers: [Object: null prototype] { 'x-powered-by': 'Express' }
DEBUG: Intercepted settlePayment call
DEBUG: Args: [
  {
    "x402Version": 2,
    "payload": {
      "authorization": {
        "from": "0x7621106919A7485daF135C1EE0216AaFD1AD144D",
        "to": "0x1111111111111111111111111111111111111111",
        "value": "100000",
        "validAfter": "1768895255",
        "validBefore": "1768896155",
        "nonce": "0xa2a9b9dbb41e33640a2ca2c1a4de877be8a747ebcd31ecd0219b695374001b3c"
      },
      "signature": "0x710b647b9c4e61c7141222a5ea241075b241529cbb237cb0614926d2212a5fec1dbfc7fef97768dd8d526f81d78b535e394769255e5c41cc214a27626c43357f1b"
    },
    "resource": {
      "url": "http://localhost:4021/api/premium",
      "description": "Premium API endpoint",
      "mimeType": "application/json"
    },
    "accepted": {
      "scheme": "exact",
      "network": "eip155:84532",
      "amount": "100000",
      "asset": "0x036CbD53842c5426634e7929541eC2318f3dCF7e",
      "payTo": "0x1111111111111111111111111111111111111111",
      "maxTimeoutSeconds": 300,
      "extra": {
        "name": "USDC",
        "version": "2"
      }
    }
  },
  {
    "scheme": "exact",
    "network": "eip155:84532",
    "amount": "100000",
    "asset": "0x036CbD53842c5426634e7929541eC2318f3dCF7e",
    "payTo": "0x1111111111111111111111111111111111111111",
    "maxTimeoutSeconds": 300,
    "extra": {
      "name": "USDC",
      "version": "2"
    }
  }
]
DEBUG: Settle Result: {
  "success": true,
  "transaction": "0xe2318b11f42ff9a847240cbcf519449602ec7e392bdf0936bf361500d18046cb",
  "network": "eip155:84532",
  "payer": "0x7621106919A7485daF135C1EE0216AaFD1AD144D"
}
DEBUG: Cached result for nonce 0xa2a9b9dbb41e33640a2ca2c1a4de877be8a747ebcd31ecd0219b695374001b3c
[2026-01-20T07:57:35.498Z] GET /api/premium - 200 (5189ms)
